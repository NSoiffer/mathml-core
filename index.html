<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>MathML Core</title>
    <link rel="stylesheet" href="style.css" type="text/css"/>
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common"
            class="remove"></script>
    <script src="tables/sorttable.js"></script>
    <script class="remove">
      var respecConfig = {
          specStatus: "ED",
          editors: [{
              name: "David Carlisle",
              url: "https://davidcarlisle.github.io/dcarlisle/david/",
              company: "NAG"
          }, {
              name: "Frédéric Wang",
              url: "http://frederic-wang.fr",
              company: "Igalia"
          }],
          wg: "MathML Refresh Community Group",
          wgURI: "https://www.w3.org/community/mathml4/",
          edDraftURI: "https://mathml-refresh.github.io/mathml-core/",
          shortName: "mathml-core",
          testSuiteURI: "https://w3c-test.org/mathml/",
          issueBase: "https://github.com/mathml-refresh/mathml/issues/",
          implementationReportURI: "https://build-chromium.igalia.com/mathml/wpt/summary.html",
          otherLinks: [{
              key: "Participate",
              data: [{
                  value: 'MathML Refresh CG',
                  href: 'https://www.w3.org/community/mathml4/'
              }, {
                  value: 'GitHub mathml-refresh/mathml',
                  href: 'https://github.com/mathml-refresh/mathml/'
              }, {
                  value: 'GitHub mathml-refresh/mathml-core',
                  href: 'https://github.com/mathml-refresh/mathml-core/'
              }, {
                  value: 'File a bug',
                  href: 'https://github.com/mathml-refresh/mathml/issues'
              }, {
                  value: 'Commit History',
                  href: 'https://github.com/mathml-refresh/mathml-core/commits/gh-pages'
              }, {
                  value: 'Pull requests',
                  href: 'https://github.com/mathml-refresh/mathml-core/pulls/'
              }]
          }],
          localBiblio: {
              "MATHML4": {
                  title: "Mathematical Markup Language (MathML) Version 4.0",
                  authors: [
                      "David Carlisle et al."
                  ],
                  status: "WD",
                  href: "https://mathml-refresh.github.io/mathml/"
              },
              "TEXBOOK": {
                  title: "The TeXBook",
                  date: "1984",
                  authors: [
                      "Knuth, Donald E."
                  ],
                  publisher: "Addison-Wesley Professional",
                  id: "ISBN9780201134483"
              },
              "OPEN-TYPE-MATH-ILLUMINATED": {
                  title: "OpenType Math Illuminated",
                  date: "2009",
                  authors: [
                      "Ulrik Vieth"
                  ],
                  href: "http://www.tug.org/TUGboat/tb30-1/tb94vieth.pdf",
              },
              "VALIDATOR-SCHEMAS": {
                  title: "HTML5-SVG-MathML schema for Nu Html Checker",
                  authors: [
                      "Henri Sivonen et al."
                  ],
                  href: "https://github.com/validator/validator/blob/master/schema/.drivers/html5-svg-mathml.rnc"
              }
          },
          postProcess: [sorttable.init]
      };
    </script>
  </head>
  <body>
    <section id="abstract">
      <p>
        This specification defines a core subset of Mathematical Markup
        Language, or MathML, that is suitable for browser implementation.
        MathML is a markup language for describing mathematical notation
        and capturing both its structure and content. The goal of MathML is to
        enable mathematics to be served, received, and processed on the World
        Wide Web, just as HTML has enabled this functionality for text.
      </p>
    </section>
    <section id="sotd">
      <p>
        This is a public copy of the editors’ draft. It is provided for
        discussion only and may change at any moment. Its publication here does
        not imply endorsement of its contents by W3C. Don’t cite this document
        other than as work in progress.
      </p>
    </section>
    <section class="informative">
      <h2>Introduction</h2>
      <p>
        The [[MATHML3]] specification has several shortcomings that make it
        hard to implement consistently accross web rendering engines or to
        extend with user-defined constructions e.g.
      </p>
      <ul>
        <li>It is a huge and standalone specification.</li>
        <li>It does not contain any detailed rendering rules.</li>
        <li>It is not driven by browser-implementation.</li>
        <li>It lacks automated testing.</li>
      </ul>
      <p>
        This MathML Core specification intends to address these issues by
        being as accurate as possible on the visual rendering of mathematical
        formulas using additional rules from the TeXBook’s Appendix G
        [[?TEXBOOK]] and from the Open Font Format [[OPEN-FONT-FORMAT]],
        [[OPEN-TYPE-MATH-ILLUMINATED]]. It also relies on modern browser
        implementations and web technologies [[HTML]] clarifying interactions
        with them when needed or introducing new low-level primitives to
        improve the web platform layering. Parts of MathML 3 that do not
        fit well in this framework or are rarely used in practice have been
        omitted. Instead, they are described in a separate and larger
        [[MATHML4]] specification.
      </p>
      <p>
        By increasing the level of implementation details, focusing on a
        workable subset, following a browser-driven design and relying on
        automated web platform tests, this specification is expected to
        greatly improve MathML interoperability. Moreover, effort on MathML
        layering will enable users to implement the rest of the MathML 4
        specification, or more generally to extend MathML Core, using
        polyfills or converters.
      </p>
    </section>
    <section class="normative">
      <h2>MathML Fundamentals</h2>
      <section>
        <h3>Web Platform Integration</h3>
        <p>
          When
          <a data-cite="HTML#parsing">parsing HTML documents</a>
          user agents must treat any of the following
          <dfn data-dfn-type="dfn" id="element-mathml-core">MathML Core
          elements</dfn> as belonging to the
          <a data-cite="INFRA#mathml-namespace">MathML namespace</a>:
        </p>
        <ul>
          <li><a>&lt;annotation&gt;</a></li>
          <li><a>&lt;annotation-xml&gt;</a></li>
          <li><a>&lt;maction&gt;</a></li>
          <li><a>&lt;math&gt;</a></li>
          <li><a>&lt;menclose&gt;</a></li>
          <li><a>&lt;merror&gt;</a></li>
          <li><a>&lt;mfrac&gt;</a></li>
          <li><a>&lt;mi&gt;</a></li>
          <li><a>&lt;mmultiscripts&gt;</a></li>
          <li><a>&lt;mn&gt;</a></li>
          <li><a>&lt;mo&gt;</a></li>
          <li><a>&lt;mover&gt;</a></li>
          <li><a>&lt;mpadded&gt;</a></li>
          <li><a>&lt;mphantom&gt;</a></li>
          <li><a>&lt;mprescripts&gt;</a></li>
          <li><a>&lt;mroot&gt;</a></li>
          <li><a>&lt;mrow&gt;</a></li>
          <li><a>&lt;ms&gt;</a></li>
          <li><a>&lt;mspace&gt;</a></li>
          <li><a>&lt;msqrt&gt;</a></li>
          <li><a>&lt;mstyle&gt;</a></li>
          <li><a>&lt;msub&gt;</a></li>
          <li><a>&lt;msubsup&gt;</a></li>
          <li><a>&lt;msup&gt;</a></li>
          <li><a>&lt;mtable&gt;</a></li>
          <li><a>&lt;mtd&gt;</a></li>
          <li><a>&lt;mtext&gt;</a></li>
          <li><a>&lt;mtr&gt;</a></li>
          <li><a>&lt;munder&gt;</a></li>
          <li><a>&lt;munderover&gt;</a></li>
          <li><a>&lt;none&gt;</a></li>
          <li><a>&lt;semantics&gt;</a></li>
        </ul>
        <div class="issue" data-number="101">Improve description of
          integration points and refer to [[HTML]] instead of the validator
          schema.</div>
        <p>
          User agents must also take into account the following integration points
          between SVG, MathML and HTML as allowed by [[VALIDATOR-SCHEMAS]]:
        </p>
        <ol>
          <li>
            The <code>&lt;math&gt;</code> element can be used at any position
            permitted for phrasing content or inside SVG
            <code>&lt;foreignObject&gt;</code> elements.
          </li>
          <li>
            The <code>&lt;svg&gt;</code> element can be used inside
            <code>&lt;annotation-xml&gt;</code> elements with encoding
            <code>SVG1.1</code> or <code>image/svg+xml</code>.
          </li>
          <li>
            The <code>&lt;html&gt;</code> element and flow content can be used
            inside <code>&lt;annotation-xml&gt;</code> elements with encoding
            <code>application/xhtml+xml</code> or <code>text/html</code>.
          </li>
          <li>
            Any phrasing element can be used inside <code>&lt;mtext&gt;</code>
            elements.
          </li>
        </ol>
        <p>
          User agents supporting
          <a data-cite="HTML#webappapis">Web application APIs</a>
          must ensure that they keep the visual rendering of MathML
          in synchronization with the [[DOM]] tree.
        </p>
        <p>
          When evaluating the SVG
          <a data-cite="SVG#RequiredExtensionsAttribute"><code>requiredExtensions</code></a>
          attribute, user agents must claim support for the language extension
          identified by the
          <a data-cite="INFRA#mathml-namespace">MathML namespace</a>.
        </p>
        <p>
          All documents containing <a>MathML Core elements</a> must include
          CSS rules described in <a href="#user-agent-stylesheet"></a>
          as part of user-agent level style sheet defaults.
          Rules relying on universal selectors such as
          <code>mfrac > *</code> or <code>msub > :not(:first-child)</code> may
          be replaced with equivalent expanded rules listing all possible
          <a>MathML Core elements</a>.
        </p>
        <div class="issue" data-number="83">Properly define DOM/IDL relationships.</div>
      </section>
      <section>
        <h3>MathML Attribute Values</h3>
        <dl>
          <dt><dfn data-dfn-type="dfn" id="type-non-negative-integer">non-negative-integer</dfn></dt>
          <dd>A
            <a data-cite="HTML#non-negative-integers"><code>&lt;non-negative-integer&gt;</code></a>
            value as defined in
            [[HTML]]
          </dd>
        </dl>
        <dl>
          <dt><dfn data-dfn-type="dfn"
                   id="type-length-percentage">length-percentage</dfn></dt>
          <dd>A
            <a data-cite="CSS-VALUES-3#typedef-length-percentage"><code>&lt;length-percentage&gt;</code></a>
            value as defined in
            [[CSS-VALUES-3]]
          </dd>
        </dl>
        <dl>
          <dt><dfn data-dfn-type="dfn" id="type-color">color</dfn></dt>
          <dd>A
            <a data-cite="CSS-COLOR-3#colorunits"><code>&lt;color&gt;</code></a>
            value as defined in [[CSS-COLOR-3]]
          </dd>
        </dl>
        <dl>
          <dt><dfn data-dfn-type="boolean" id="type-boolean">boolean</dfn></dt>
          <dd>A string that is case-insensitively equal to <code>true</code> or
            <code>false</code>.
          </dd>
        </dl>
      </section>
      <section>
        <h3>Global Attributes</h3>
        <p>
          The following attributes are common to and may be specified on all MathML
          elements:
        </p>
        <ul>
          <li><a>id</a></li>
          <li><a>class</a></li>
          <li><a><code>style</code></a></li>
          <li><a><code>href</code></a></li>
          <li><a><code>dir</code></a></li>
          <li><a><code>mathbackground</code></a></li>
          <li><a><code>mathcolor</code></a></li>
          <li><a><code>mathsize</code></a></li>
          <li><a><code>mathvariant</code></a></li>
          <li><a><code>displaystyle</code></a></li>
          <li><a><code>scriptlevel</code></a></li>
        </ul>
        <section>
          <h4>Attributes common to HTML and MathML elements</h4>
        <p>
          The
          <dfn data-dfn-type="id" id="attribute-id"><code>id</code></dfn>,
          <dfn data-dfn-type="class" id="attribute-class"><code>class</code></dfn>,
          <dfn data-dfn-type="style" id="attribute-style"><code>style</code></dfn>,
          attributes have the same syntax and semantic as defined for
          <a data-cite="HTML#the-id-attribute">id</a>,
          <a data-cite="HTML#classes">class</a> and
          <a data-cite="HTML#the-style-attribute">style</a> attributes on
          HTML elements.
        </p>
        <p>
          The
          <dfn data-dfn-type="href" id="attribute-href"><code>href</code></dfn>
          attribute has the syntax and semantic as defined for
          the <a data-cite="HTML#attr-hyperlink-href">href</a> attribute on
          <code>&lt;a&gt;</code> element.
          To fully implement this attribute, the following CSS properties for
          links must be specified in the
          <a href="#user-agent-stylesheet">user agent stylesheet</a>:
        </p>
        <pre data-include="user-agent-stylesheet/links.css"></pre>
        <p>
          The
          <dfn data-dfn-type="dir" id="attribute-dir"><code>dir</code></dfn>
          attribute, if present,
          must be case-insensitively equal to the
          value <code>ltr</code> or <code>ltr</code>.
          It is mapped to the
          <a data-cite="CSS-WRITING-MODES-3#direction"><code>direction</code></a>
          CSS property.
          This attribute is used to set the directionality of math formulas, which is
          often <code>rtl</code> in Arabic speaking world.
        </p>
        </section>
       <section>
          <h4>Legacy MathML Style Attributes</h4>
        <p>
          The
          <dfn data-dfn-type="mathcolor" id="attribute-mathcolor"><code>mathcolor</code></dfn>
          and
          <dfn data-dfn-type="mathbackground" id="attribute-mathbackground"><code>mathbackground</code></dfn>
          attributes, if present, must
          have a value that is a <a>color</a>.
          The <code>mathcolor</code> property describes the foreground fill color of
          an MathML text, bars etc and the background color of an element.
          They are mapped to the
          <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a> and
          <a data-cite="CSS-BACKGROUNDS-3#the-background-color"><code>background-color</code></a> CSS properties.
        </p>
        <p>
          The
          <dfn data-dfn-type="mathsize" id="attribute-mathsize"><code>mathsize</code></dfn>
          attribute, if present, must
          have a value that is a valid <a>length-percentage</a>.
          The <code>mathsize</code> property indicates indicates the desired height
          of glyphs in math formulas but also scale other parts (spacing, shifts,
          line thickness of bars etc) accordingly.
          Is is mapped to the CSS property
          <a data-cite="CSS-FONTS-3#font-size-prop"><code>font-size</code></a>
          and the <code>mathsize</code> values are interpreted according to the
          definition in [[CSS-FONTS-3]].
        </p>
        <div class="note">
          The above attributes are not useful in CSS-aware
          environments, but are preserved for backward compatibility reasons.
        </div>
        </section>
        <section>
          <h4>The <code>mathvariant</code> attribute</h4>
        <p>
          The
          <dfn data-dfn-type="mathvariant" id="attribute-mathvariant"><code>mathvariant</code></dfn>
          attribute,
          if present, must have a value that is one of:
        </p>
        <ul>
          <li><code>normal</code></li>
          <li><code>bold</code></li>
          <li><code>italic</code></li>
          <li><code>bold-italic</code></li>
          <li><code>double-struck</code></li>
          <li><code>bold-fraktur</code></li>
          <li><code>script</code></li>
          <li><code>bold-script</code></li>
          <li><code>fraktur</code></li>
          <li><code>sans-serif</code></li>
          <li><code>bold-sans-serif</code></li>
          <li><code>sans-serif-italic</code></li>
          <li><code>sans-serif-bold-italic</code></li>
          <li><code>monospace</code></li>
          <li><code>initial</code></li>
          <li><code>tailed</code></li>
          <li><code>looped</code></li>
          <li><code>stretched</code></li>
        </ul>
        <p>
          The <code>mathvariant</code> attribute defines logical classes of token
          elements. Each class provides a collection of typographically-related
          symbolic tokens with specific meaning within a given mathematical
          expression.
          For <code>mathvariant</code> values other than <code>normal</code>,
          this is done by using glyphs of
          Unicode's Mathematical Alphanumeric Symbols.
        </p>
        <p>
          Hence, the <code>mathvariant</code> attribute
          is mapped to new values of the CSS property
          <a><code>text-transform</code></a>.
          More precisely, <code>normal</code> is mapped to <code>none</code>
          while all the other values the corresponding CSS value with the extra
          <code>math-</code> prefix.
        </p>
        <div class="note">
          For <code>mathvariant</code> values other than <code>normal</code>,
          one can just directly use the corresponding Unicode
          characters. However, they are preserved for backward compatibility reasons.
          The <code>normal</code> value is still important to cancel automatic
          italic of the
          <a><code>&lt;mi&gt;</code></a> element.
        </div>
        </section>
        <section>
          <h4>The <code>displaystyle</code> and <code>scriptlevel</code> attributes</h4>
        <p>
          The
          <dfn data-dfn-type="displaystyle" id="attribute-displaystyle"><code>displaystyle</code></dfn>
          attribute, if present, must be a <a>boolean</a>.
          It is mapped to the CSS property <a><code>math-style</code></a>.
          More precisely,  <code>true</code> is mapped to <code>display</code> and
          <code>false</code> to  <code>inline</code>.
          This attribute indicate whether formulas should try to minimize
          the logical height (value is <code>false</code>) or not
          (value is <code>true</code>) e.g. by changing the size of content or
          the layout of scripts.
        </p>
        <p>
          The
          <dfn data-dfn-type="scriptlevel" id="attribute-scriptlevel"><code>scriptlevel</code></dfn>
          attribute, if present, must have value
          <code>+&lt;U&gt;</code>, <code>-&lt;U&gt;</code> or <code>&lt;U&gt;</code>
          where <code>&lt;U&gt;</code> is a
          <a>non-negative-integer</a>.
          It is mapped to the <a><code>math-script-level</code></a>.
          More precisely,
          <code>+&lt;U&gt;</code>, <code>-&lt;U&gt;</code> and
          <code>&lt;U&gt;</code>
          are respectively mapped to
          <code>add(&lt;U&gt;)</code>
          <code>add(&lt;-U&gt;)</code>
          and <code>&lt;U&gt;</code>.
        </p>
        <p>
          <code>displaystyle</code> and <code>scriptlevel</code> values
          are automatically adjusted within MathML elements.
          To fully implement these attributes, additional CSS properties must be
          specified in the user agent stylesheet
          as described in <a href="#user-agent-stylesheet"></a>.
        </p>
        <div class="note">
          T<sub>E</sub>X's <code>\displaystyle</code>, <code>\textstyle</code>,
          <code>\scriptstyle</code>, and <code>\scriptscriptstyle</code> correspond
          to <code>displaystyle</code> and <code>scriptlevel</code> as
          <code>true</code> and <code>0</code>,
          <code>false</code> and <code>0</code>,
          <code>false</code> and <code>1</code>,
          and <code>false</code> and 2, respectively.
        </div>
      </section>
      </section>
      <section>
        <h3>The Top-Level <code>&lt;math&gt;</code> Element</h3>
        <p>
          The
          <dfn data-dfn-type="math" id="element-math"><code>&lt;math&gt;</code></dfn>
          element accepts the attributes described
          in <a href="#global-attributes"></a> as well as the
          following attribute:
        </p>
        <ul>
          <li><a>display</a></li>
        </ul>
        <p>
          The
          <dfn data-dfn-type="display" id="attribute-display"><code>display</code></dfn>
          attribute, if present,
          must have value <code>block</code> or <code>inline</code>.
          To fully implement this attribute, additional CSS properties must be
          specified in the user agent stylesheet
          as described in <a href="#user-agent-stylesheet"></a>.
        </p>
        <p>
          The layout algorithm of the <code>&lt;math&gt;</code> element
          is the same as the <code>&lt;mrow&gt;</code> element. User agents must
          ensure correct baseline alignment, centering, sizing etc of the
          <code>&lt;math&gt;</code> element.
        </p>
        <div class="note">
          T<sub>E</sub>X's display mode <code>$...$</code>
          and inline mode <code>$...$</code> correspond to
          <code>display="block"</code> and <code>display="inline"</code>
          respectively.
        </div>
      </section>
      <section>
        <h3>Text and Math layout</h3>
        <p data-tests="relations/text-and-math/use-typo-metrics-1.html">
          Because math fonts generally contain very tall glyphs such as big integrals,
          using typographic metrics is important to avoid excessive line spacing of text.
          This behavior is specified in math fonts using the USE_TYPO_METRICS flag from
          the OS/2 table
          [[OPEN-FONT-FORMAT]] and user agents must honor that flag.
        </p>
        <p>
          Mathematical formulas can be viewed as an extension of standard text layout
          and thus user agents must be able to perfom
          complex text layout using fonts under the Open Font Format
          [[OPEN-FONT-FORMAT]]. In particular, they must implement bidirectional
          rendering and shaping of Arabic scripts.
        </p>
        <p>
          Mathematical formulas may mix standard text with other graphical outlines
          (e.g. fraction or top radical bars). For consistency, these outlines should
          be rendered the same way as normal text. In particular, user agents must be
          able to apply <code>visibility</code> and <code>color</code> CSS properties to them. They may
          also support similar CSS properties for text such as <code>text-shadow</code> or
          <code>opacity</code>.
        </p>
        <p>
          Good mathematical rendering requires use of non-Unicode glyphs. Mathematical
          fonts may only provide these glyphs when the <code class="MATH">math</code>
          script tag is enabled and so user agents must ensure that the text within
          MathML token elements is rendered with that script tag. Some characters like
          primes already have script size by default and hence would be too small when
          used in a script position.
          Hence user agents must support glyph selections via the OpenType font feature
          <code class="MATH">ssty</code> (Script Style) in order to display such
          “prescripted” characters with the appropriate size.
          For bidirectional layout, Unicode defines character-level mirroring
          to transform a character into its mirrored form,
          for example U+0028 LEFT PARENTHESIS into U+0029 RIGHT PARENTHESIS.
          User agents must also support the OpenType font feature
          <code>rtlm</code> (Right-to-left mirrored forms)
          to allow glyph-level mirroring in cases where character-level is not enough
          [[OPEN-FONT-FORMAT]].
          At the time of writing, Unicode does not distinguish between Chancery and
          Spencerian style for the Unicode MATHEMATICAL SCRIPT characters. Some
          mathematical fonts rely on <code class="MATH">salt</code> or <code>ssXY</code> properties to provide
          both styles. User agents may support the CSS <code>font-variant-alternates</code>
          property and corresponding OpenType font features to enable page authors
          to get access to these styles [[CSS-FONTS-3]]
          [[OPEN-FONT-FORMAT]].
        </p>
        <p>
          User agents must be able to read information from the
          OpenType MATH table [[OPEN-FONT-FORMAT]].
          In particular they must be able to read the values from the
          <code class="MATH">MathConstants</code> subtable.
          They must also be able to use the <code class="MATH">MathVariants</code> subtable
          to solve the following problem: given a particular default glyph shape and a
          certain width or height, find a variant shape glyph (or a construct created by
          putting several glyphs together) that has the required measurement.
          More information are provided in
          <a href="operator-fence-separator-or-accent-mo"></a>.
        </p>
      </section>
      <section>
        <h3>Cramped Elements</h3>
        <p>
          A MathML element is
          <dfn data-dfn-type="cramped" id="property-cramped">cramped</dfn> if
          any of the following conditions is true:
        </p>
        <ol>
          <li>Its parent is <a>cramped</a>.</li>
          <li>Its parent is a <a><code>&lt;msqrt&gt;</code></a> or
              <a><code>&lt;mroot&gt;</code></a> element.
          </li>
          <li>It is the denominator of a <a><code>&lt;mfrac&gt;</code></a>
            element.</li>
          <li>
            It is the subscript of a
            <a><code>&lt;msub&gt;</code></a> or
            <a><code>&lt;msubsup&gt;</code></a> element.
          </li>
          <li>
            It is the underscript of a
            <a><code>&lt;munder&gt;</code></a> or
            <a><code>&lt;munderover&gt;</code></a> element.
          </li>
          <li>It is the overscript of the
            <code>&lt;mover&gt;</code> and <code>&lt;munderover&gt;</code>
            elements and
            is an <a>embellished operator</a> with
            the <a>accent</a> property.
          </li>
        </ol>
      </section>
    </section>
    <section>
      <h2>Presentation Markup</h2>
      <section>
        <h2>Introduction</h2>
        <section>
          <h3>Box Model</h3>
          <div class="issue" data-number="15">Interoperable handling of invalid markup</div>
          <p>
            User agents must also follow the rules described in section 4.7.14
            Embedded content, MathML of [[HTML]], in particular the equivalence with
            implicit <code>&lt;mtext&gt;</code> and <code>&lt;merror&gt;</code> to handle non-conforming MathML markup.
          </p>
          <p>
            MathML elements have the following box model. The <code>&lt;math&gt;</code> root may have
            inline or block display, as suggested in
            <a href="#user-agent-stylesheet"></a>.
            Tabular MathML elements have table, table-row and
            table-cell display as discussed in
            <a href="#tabular-math"></a>.
            The <code>&lt;math&gt;</code> and <code>&lt;mtd&gt;</code> elements
            generate an anonymous <code>&lt;mrow&gt;</code> MathML box child that contains the boxes of
            their children and use the box parameters below to layout this anonymous
            <code>&lt;mrow&gt;</code> box.
            No line breaking can happen within MathML boxes and the min-content width is
            equal to the max-content width, these are simply called the intrinsic width.
            Each MathML box has the following parameters:
          </p>
          <ol>
            <li>intrinsic width W.</li>
            <li>logical width w, ascent above the origin a and descent below the origin b. The height is then a + b.</li>
            <li>ink ascent A and descent B, corresponding to the exact box enclosing ink of text and bars within the MathML box.</li>
          </ol>
          <figure id="box-model-generic">
            <img src="figures/boxmodel.svg"/>
            <figcaption>Generic Box Model for MathML elements</figcaption>
          </figure>
          <p>
            For MathML element containing only text nodes or foreign elements, we assume
            that the content is simple enough to determine these values. For example,
            in most case, this is just a single text node and w = W.
            A MathML element containing only other MathML elements follow special rules to
            layout their children at position
            (x<sub>i</sub>, y<sub>i</sub>) with parameters
            W<sub>i</sub>, w<sub>i</sub>, a<sub>i</sub>, b<sub>i</sub>, A<sub>i</sub>,
            B<sub>i</sub>. Then as a general rule, its box parameters are given
            by taking the union of child boxes, that is:
          </p>
          <p>
            w = max<sub>1 ≤ i ≤ n</sub> (x<sub>i</sub> + w<sub>i</sub>) −
            max<sub>1 ≤ i ≤ n</sub> x<sub>i</sub>
          </p>
          <p>
            W = max<sub>1 ≤ i ≤ n</sub> (x<sub>i</sub> + W<sub>i</sub>) −
            max<sub>1 ≤ i ≤ n</sub> x<sub>i</sub>
          </p>
          <p>
            a = max<sub>1 ≤ i ≤ n</sub> (a<sub>i</sub> − y<sub>i</sub>)
          </p>
          <p>
            b = max<sub>1 ≤ i ≤ n</sub> (b<sub>i</sub> + y<sub>i</sub>)
          </p>
          <p>
            A = max<sub>1 ≤ i ≤ n</sub> (A<sub>i</sub> − y<sub>i</sub>)
          </p>
          <p>
            B = max<sub>1 ≤ i ≤ n</sub> (B<sub>i</sub> + y<sub>i</sub>)
          </p>
          <p>
            Note that the schemas in this document are drawn assuming left-to-right
            directionality. If the CSS <code>direction</code> is set to right-to-left, then the
            elements should be layout by making the x-axis pointing from right-to-left.
            In this document, we use the terminology of
            [[MATHML3]]: “leading”
            means “left” in right-to-left and “right” in right-to-left mode, while
            “trailing” means “right” in right-to-left and “left” in right-to-left
            mode.
          </p>
          <p>
            The <code class="MATH">MathItalicsCorrectionInfo</code> table contains the italic
            correction of some glyphs, which provides a measure of how slanted the
            glyphs are (see <a href="#figure-italic-correction"></a>). The
            <code class="MATH">MathTopAccentAttachment</code> table also contains a reference
            points that is used for the horizontal positioning of glyphs as an accent
            (see <a href="#figure-top-accent-attachment"></a>). In later sections, we
            generalize this by claiming that all MathML boxes have italic correction
            and top accent attachment values. The values for glyphs are used to try and
            extend to token elements or to special boxes that do not change child metrics.
            Otherwise fallback values are used: 0 for italic correction and half
            the width of the box for top accent attachment.
          </p>
          <figure id="figure-italic-correction">
            <img src="figures/italcorr.svg"/>
            <figcaption>Examples of italic correction for italic f and large integral</figcaption>
          </figure>
          <figure id="figure-top-accent-attachment">
            <img src="figures/topaccent.svg"/>
            <figcaption>Example of top accent attachment for a circumflex accent</figcaption>
          </figure>
          <p>
            The present document assumes that W, w, a, b, A, B, italic correction
            and top accent attachment are nonnegative values. If computations result
            in negative values, then they must be interpreted as being zero.
            Note that some MathML elements such as <code>&lt;mspace&gt;</code> or <code>&lt;mpadded&gt;</code> may set box
            dimensions to negative values.
          </p>
        </section>
        <section>
          <h3>Layout Steps</h3>
          <p>
            For compatibility with HTML5 rendering, the MathML layout is performed in two
            independent steps:
          </p>
          <ol
            <li>In the first step, we determine the intrinsic width W of MathML boxes.
              To do so we just follow the description given in this document for each
              MathML box. We rely on vertical positions x as well as values for
              italic correction and top accent attachment. However, we ignore any vertical
              positioning or metrics.
            <li>
              In the second step, we do the final layout of MathML boxes following
              the description given in this document. We obtain all the box metrics,
              including the actual width w, vertical metrics a, b, A, B and
              vertical positions y.
            </li>
</ol>
<p>
  In order to perform the first step independently of the second one, the
  horizontal metrics must not depend on the vertical metrics.
  As described in
  <a href="#adjust-space-around-content-mpadded"></a>,
  this adds some restrictions on the possible pseudo-units
  of the <code>&lt;mpadded&gt;</code> element. As indicated in
  <a href="#operator-fence-separator-or-accent-mo"></a>,
  the width of size variants or of the glyph assembly used for vertical stretchy
  operators may depend on the target size to cover. Taking the maximum widths
  for all these size variants or for the glyph assembly during the first step
  makes the intrinsic width independent of the target size but may lead to a
  small over-estimation.
</p>
<p>
  Each of this step is done recursively: the metrics of a given MathML box
  are determined from those of the child boxes. User agents must implement
  the “Exception for embellished operators” described in [[MATHML3]].
  This means that the actual stretching of operators described in
  <a href="#operator-fence-separator-or-accent-mo"></a>
  may be “delayed” until we reach the top of its embellished
  operator subtree. We then have to apply the current operation again
  to this embellished operator (intrinsic width determination or layout).
  Fortunately, such embellished operator subtrees are not deep in practice.
</p>
<p>
  This document does not require support for operator stretching in table cells.
  The “delayed” stretching of all operators must then be performed when we
  arrive at the anonymous <code>&lt;mrow&gt;</code> child of <code>&lt;math&gt;</code> and <code>&lt;mtd&gt;</code>
  elements.
  That way, the intrinsic width of this anonymous <code>&lt;mrow&gt;</code> is well-defined
  for the layout of <code>&lt;mtable&gt;</code> elements and of the containers of the
  <code>&lt;math&gt;</code> element. Similarly, the final layout of this anonymous
  <code>&lt;mrow&gt;</code> is already done when we want to perform the one of its ancestors.
</p>
</section>
</section>
<section>
  <h2>Token Elements</h2>
  <section>
    <h3>Identifier <code>&lt;mi&gt;</code></h3>
    <p>
      The
      <dfn data-dfn-type="mi" id="element-mi"><code>&lt;mi&gt;</code></dfn>
      element represents a symbolic name or
      arbitrary text
      that should be rendered as an identifier. Identifiers can include
      variables, function names, and symbolic constants.
    </p>
    <p>
      The <code>&lt;mi&gt;</code> element accepts the attributes described
      in <a href="#global-attributes"></a>. Its layout algorithm is
      the same as the <a>&lt;mtext&gt;</a> element.
      The
      <a href="#user-agent-stylesheet">user agent stylesheet</a>
      must contain the following property in order to implement automatic
      italic:
    </p>
    <pre data-include="user-agent-stylesheet/mi.css"></pre>
  </section>
  <section>
    <h3>Number <code>&lt;mn&gt;</code></h3>
    <p>
      The
      <dfn data-dfn-type="mn" id="element-mn"><code>&lt;mn&gt;</code></dfn>
      element represents a "numeric literal" or
      other data that should be rendered as a numeric literal. Generally
      speaking, a numeric literal is a sequence of digits, perhaps including a
      decimal point, representing an unsigned integer or real number.
    </p>
    <p>
      The <code>&lt;mn&gt;</code> element accepts the attributes described
      in <a href="#global-attributes"></a>. Its layout algorithm is
      the same as the
      <a><code>&lt;mtext&gt;</code></a> element.
    </p>
  </section>
  <section>
    <h3>Operator, Fence, Separator or Accent <code>&lt;mo&gt;</code></h3>
    <p>
      The
      <dfn data-dfn-type="mo" id="element-mo"><code>&lt;mo&gt;</code></dfn>
      element represents an
      operator or anything that should be rendered as an operator. In general,
      the notational conventions for mathematical operators are quite
      complicated, and therefore MathML provides a relatively sophisticated
      mechanism for specifying the rendering behavior of an
      <code>&lt;mo&gt;</code> element. As a consequence, in MathML the list of
      things that should "render as an operator" includes a number of notations
      that are not mathematical operators in the ordinary sense. Besides
      ordinary operators with infix, prefix, or postfix forms, these include
      fence characters such as braces, parentheses, and "absolute value" bars;
      separators such as comma and semicolon; and mathematical accents such as
      a bar or tilde over a symbol. We will use the term "operator" in this
      chapter to refer to operators in this broad sense.
    </p>
    <p>
      The <code>&lt;mo&gt;</code> element accepts the attributes described
      in <a href="#global-attributes"></a> as well as the following
      attributes:
    </p>
    <ul>
      <li><code>form</code></li>
      <li><code>fence</code></li>
      <li><code>separator</code></li>
      <li><code>lspace</code></li>
      <li><code>rspace</code></li>
      <li><code>stretchy</code></li>
      <li><code>symmetric</code></li>
      <li><code>maxsize</code></li>
      <li><code>minsize</code></li>
      <li><code>largeop</code></li>
      <li><code>movablelimits</code></li>
      <li><code>accent</code></li>
    </ul>
    <p>
      Many properties of an <code>&lt;mo&gt;</code> element can be specified
      via attribute on that element. The default value of the <code>form</code>
      of an <code>&lt;mo&gt;</code> element is obtained as described in section
      “Default value of the form attribute” of
      [[MATHML3]]. From the
      <code>form</code> and the text content, we can deduce other
      default values from the operator dictionary or use the fallback values
      given in “Dictionary-based attributes” of
      [[MATHML3]].
    </p>
    <p>
      The leading space <code>lspace</code> and trailing space
      <code>rspace</code> must be added on each side of the
      <code>&lt;mo&gt;</code> element (or its outermost embellished ancestor).
    </p>
    <p>
      In most cases, the <code>&lt;mo&gt;</code> element is treated as an
      <a>&lt;mtext&gt;</a> element.
      However, when an <code>&lt;mo&gt;</code> element with a single character must be
      displayed as a large operator then instead we use the
      <code class="MATH">MathVariants</code>
      table to try and find a glyph of height at least
      <code class="MATH">DisplayOperatorMinHeight</code>
      (<a href="#figure-sum-base-and-displastyle-sizes"></a>). If none is found, we fallback to the
      largest one. Because this parameter does not always give
      the best size, user agents may also use the following heuristic: ensure
      that the large variant height is at least 2 times as large as the base
      height for integrals and √2 times as large as the base height for other
      operators.
    </p>
    <figure id="figure-sum-base-and-displastyle-sizes">
      <img src="figures/sumsize.svg"/>
      <figcaption>Base and displaystyle sizes of the summation symbol</figcaption>
    </figure>
    <p>
      When an <code>&lt;mo&gt;</code> element with a single character must be
      displayed as a horizontal or vertical operator then instead of displaying
      the normal character we use the <code class="MATH">MathVariants</code>
      table to try and find a glyph that has at least the desired size or an
      assembly from several glyphs to cover at least the desired size
      (<a href="#figure-base-variants-and-assembly"></a>). The rules for vertical stretching
      are a bit more complicated and are described in section
      “Vertical Stretching Rules” of
      [[MATHML3]].
      If the operator has property <code>symmetric="true"</code>, it must be
      stretched symmetrically with respect to the math axis, which is given by
      the <code class="MATH">AxisHeight</code> value.
      <a href="#symmetric-and-non-symmetric-vertical-stretching"></a>
      compares the symmetric and non-symmetric stretching.
    </p>
    <p>
      The size variant or construction used for vertical stretchy operators
      will depend on the target size to cover. To determine the intrinsic
      width W of the operator, we consider the maximum of all possible widths
      for the base size, size variants and construction available for the given
      operator. It is assumed that the width of the
      operator is almost independent of the stretch size, which is the case in
      practice for most math fonts and operators.
    </p>
    <figure id="figure-base-variants-and-assembly">
      <img src="figures/bracesize.svg"/>
      <figcaption>Base size, size variants and glyph assembly for the
        left brace</figcaption>
    </figure>
    <figure id="symmetric-and-non-symmetric-vertical-stretching">
      <img src="figures/vstretch.svg"/>
      <figcaption>Symmetric and non-symmetric stretching of vertical
        operators</figcaption>
    </figure>
    <p>
      See
      <a href="#horizontally-group-sub-expressions-mrow"></a>
      for details about how to treat
      “embellished ancestor”, and how decide when to display operators larger
      or when to stretch them vertically &amp; horizontally.
    </p>
  </section>
  <section>
    <h3>Text <code>&lt;mtext&gt;</code></h3>
    <p>
      The
      <dfn data-dfn-type="mtext" id="element-mtext"><code>&lt;mtext&gt;</code></dfn>
      element is used to represent arbitrary text
      that should be rendered as itself. In general, the
      <code>&lt;mtext&gt;</code> element is intended to denote commentary text.
    </p>
    <p>
      The <code>&lt;mtext&gt;</code> element accepts the attributes described
      in <a href="#global-attributes"></a>.
    </p>
    <p>
      In most cases the <code>&lt;mtext&gt;</code> element contains some text
      that is laid out without line breaks using complex text layout. It is assumed that we
      can measure the ink ascent &amp; descent, logical ascent &amp; descent and
      advance width of the text frame and use these values for the MathML box of
      the <code>&lt;mtext&gt;</code> element.
    </p>
    <p>
      If the trailing glyph of the text content has an entry in the
      <code class="MATH">MathItalicsCorrectionInfo</code> table then the specified
      value is used as the italic correction.
      User agents may subtract the advance width from the abscissa of the trailing
      ink edge as a heuristic value for the italic correction of the
      <code>&lt;mtext&gt;</code> element when it is not specified in the
      <code class="MATH">MathItalicsCorrectionInfo</code> table.
    </p>
    <p>
      If the text content is made of a single glyph and this glyph
      has an entry in the <code class="MATH">MathTopAccentAttachment</code> table
      then the specified value is used as the top accent attachment of the
      <code>&lt;mtext&gt;</code> element.
    </p>
    <p>
      If the CSS <code>direction</code> on the <code>&lt;mtext&gt;</code> element
      is set to right-to-left then user agents must enable the <code>rtlm</code>
      OpenType feature on text nodes unless it contradicts what the page author
      has specified with the <code>font-feature-settings</code> CSS property.
    </p>
    <div class="issue"  data-number="19">Add detailed rules for the ssty OpenType feature</div>
    <p>
      If <code>&lt;mtext&gt;</code> is used at a non-zero scriptlevel then user
      agents must enable the <code class="MATH">ssty</code> OpenType feature on
      text nodes unless it contradicts what the page author has specified with
      the <code>font-feature-settings</code> CSS property.
    </p>
    <p>
      In the most general case, the <code>&lt;mtext&gt;</code> element may contain
      text with line breaks or arbitrary HTML5 phrasing elements. We assume that
      we can still determine logical dimensions and max-content width of the text
      content and use it for both the logical and ink values of the
      <code>&lt;mtext&gt;</code> element. The italic correction and
      top accent attachment are assigned the fallback values indicated in
      <a href="#operator-fence-separator-or-accent-mo"></a>.
    </p>
  </section>
  <section>
    <h3>Space <code>&lt;mspace&gt;</code></h3>
    <p>
      The
      <dfn data-dfn-type="mspace" id="element-mspace"><code>&lt;mspace&gt;</code></dfn>
      empty element represents a blank space of any
      desired size, as set by its attributes.
    </p>
    <p>
      The <code>&lt;mspace&gt;</code> element accepts the attributes described
      in <a href="#global-attributes"></a> as well as the following
      attributes:
    </p>
    <ul>
      <li><a data-lt="attribute-mspace-width">width</a></li>
      <li><a data-lt="attribute-mspace-height">height</a></li>
      <li><a data-lt="attribute-mspace-depth">depth</a></li>
    </ul>
    <p>The
      <dfn data-dfn-type="attribute-mspace-width" id="attribute-mspace-width"><code>width</code></dfn>,
      <dfn data-dfn-type="attribute-mspace-height" id="attribute-mspace-height"><code>height</code></dfn>,
      <dfn data-dfn-type="attribute-mspace-depth" id="attribute-mspace-depth"><code>depth</code></dfn>, if present, must
      have a value that is a valid <a>length-percentage</a>.
      They indicate the requested width, ascent and descent of the blank space.
      An unspecified attribute, a percentage  value, or an invalid value is
      interpreted as <code>0</code>.
    </p>
    <p>
      The <code>&lt;mspace&gt;</code> element is laid out as shown on
      <a href="#figure-box-mspace"></a>. The logical box is determined by the
      requested width, ascent and descent. The ink box matches the logical box.
    </p>
    <figure id="figure-box-mspace">
      <img src="figures/mspacebox.svg"/>
      <figcaption>Box model for the <code>&lt;mspace&gt;</code> element</figcaption>
    </figure>
    <div class="note">
      The terminology height/depth comes from [[MATHML3]], itself inspired
      from [[TEXBOOK]].
    </div>
  </section>
  <section>
    <h3>String Literal <code>&lt;ms&gt;</code></h3>
    <p>
      <dfn data-dfn-type="ms" id="element-ms"><code>&lt;ms&gt;</code></dfn>
      element is used to represent
      "string literals" in expressions meant to be interpreted by computer
      algebra systems or other systems containing "programming languages".
    </p>
    <p>
      The <code>&lt;mn&gt;</code> element accepts the attributes described
      in <a href="#global-attributes"></a> as well as the following
      attributes:
    </p>
    <ul>
      <li><a><code>lquote</code></a></li>
      <li><a><code>rquote</code></a></li>
    </ul>
    <p>The
      <dfn data-dfn-type="attribute-lquote" id="attribute-lquote"><code>lquote</code></dfn>,
      <dfn data-dfn-type="attribute-rquote" id="attribute-rquote"><code>rquote</code></dfn> attributes respectively specify the strings to use as opening and
      closing quotes. An unspecified attribute is
      interpreted as the character U+0022 QUOTATION MARK.
    </p>
    <p>
      The layout algorithm is the same as the
      <a><code>&lt;mtext&gt;</code></a> element.
      The <a href="#user-agent-stylesheet">user agent stylesheet</a>
      must contain the following rules in order to enclose the content with
      quotes:
    </p>
    <pre data-include="user-agent-stylesheet/ms.css"></pre>
  </section>
</section>
<section>
  <h2>General Layout Schemata</h2>
  <section>
    <h3>Horizontally Group Sub-Expressions <code>&lt;mrow&gt;</code></h3>
    <p>
      The
      <dfn data-dfn-type="mrow" id="element-mrow"><code>&lt;mrow&gt;</code></dfn>
      element is used to group together any number of sub-expressions, usually
      consisting of one or more <code>&lt;mo&gt;</code> elements acting as
      "operators" on one or more other expressions that are their "operands".
    </p>
    <p>
      The <code>&lt;mrow&gt;</code> element accepts the attributes described
      in <a href="#global-attributes"></a>. An <code>&lt;mrow&gt;</code>
      element with children
      child<sub>1</sub>, child<sub>2</sub>, … child<sub>N</sub>
      is laid out as show on <a href="#figure-box-mrow"></a>. The child boxes
      are put in a horizontal row one after the other with all their baselines
      aligned. As a consequence of this and of child box models, graphical
      elements such as fraction bars or symmetric stretchy operators will also
      be aligned along the math axis when the
      <code class="MATH">AxisHeight</code> is unchanged (e.g. in the typical case
      where the math font is unchanged).
    </p>
    <p>
      We generally do not add special spacing
      around the children. For example, the leading and trailing spacing is already
      included in the box metrics of embellished operators. The only exception is
      for the italic correction: when a “slanted” child is
      followed by a “straight” child, then an horizontal
      space corresponding to the italic correction of the “slanted” child is added
      between the two children [[OPEN-FONT-FORMAT]]. The italic correction of the
      last child is also added after that child when it is “slanted” and when
      the <code>&lt;mrow&gt;</code> has more than one child. In this document, we interpret
      “slanted” as a child that is not an operator with
      <code>largeop="true"</code> (or an embellished operator whose <code>&lt;mo&gt;</code> element core
      has <code>largeop="true"</code>) and has nonzero italic correction and “straight”
      as “non-slanted”.
    </p>
    <p>
      When the <code>&lt;mrow&gt;</code> element contains only one child then the previous
      description implies that the box metrics of the <code>&lt;mrow&gt;</code> is the same as
      the one of its unique child. As indicated in
      <a href="#operator-fence-separator-or-accent-mo"></a>, we thus
      use the italic correction and top accent attachment of the child as the
      corresponding values of the <code>&lt;mrow&gt;</code> box.
    </p>
    <figure id="figure-box-mrow">
      <img src="figures/mrowbox.svg"/>
      <figcaption>Box model for the <code>&lt;mrow&gt;</code> element</figcaption>
    </figure>
  </section>
  <section>
    <h3>Fractions <code>&lt;mfrac&gt;</code></h3>
    <p>
      The
      <dfn data-dfn-type="mfrac" id="element-mfrac"><code>&lt;mfrac&gt;</code></dfn>
      element is used for fractions. It can also be used to mark up
      fraction-like objects such as binomial coefficients and Legendre symbols.
    </p>
    <p>
      The <code>&lt;mfrac&gt;</code> element accepts the attributes described
      in <a href="#global-attributes"></a> as well as the
      following attribute:
    </p>
    <ul>
      <li><a>linethickness</a></li>
    </ul>
    <p>
      The
      <dfn data-dfn-type="linethickness" id="attribute-linethickness"><code>linethickness</code></dfn>
      attribute indicates the thickness to use for the fraction bar.
      If present, it must
      have a value that is a valid <a>length-percentage</a>.
      If the attribute is absent or has an invalid value,
      <code class="MATH">FractionRuleThickness</code> is used as the default
      value. A percentage is interpreted relative to that default value.
    </p>
    <p>
      The <code>mfrac</code> element sets
      <code>displaystyle</code> to <code>false</code>,
      or if it was already <code>false</code> increments
      <code>scriptlevel</code> by 1, within its children.
      The <a href="#user-agent-stylesheet">user agent stylesheet</a>
      must contain the following rule in order to implement that behavior:
    </p>
    <pre data-include="user-agent-stylesheet/mfrac.css"></pre>
    <div class="issue" data-number="15">Decide how to handle invalid
      fraction.</div>
    <p>
      If the fraction has less or more than two children, its layout algorithm
      is the same as the <a><code>&lt;mrow&gt;</code></a> element.
      Otherwise, the first child is called
      <dfn data-dfn-type="numerator" id="mfrac-numerator">numerator</dfn> and
      the second child is called
      <dfn data-dfn-type="denominator" id="mfrac-denominator">denominator</dfn>
      and its layout algorithm is explained below.
    </p>


    <section>
      <h4>Fraction with nonzero line thickeness</h4>
    <p>
      If the actual line thickness is nonzero, the <code>&lt;mfrac&gt;</code>
      element is laid out as shown on <a href="#figure-box-mfrac"></a>.
      The fraction bar must only be painted if the
      <a data-cite="CSS2#visibility"><code>visibility</code></a> of
      the <code>&lt;mfrac&gt;</code> element is <code>visible</code>.
      In that case, the fraction bar must be painted with the
      <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a>
      of the <code>&lt;mfrac&gt;</code> element.
      The middle of the fraction bar is shifted by
      <code class="MATH">AxisHeight</code> above the baseline.
    </p>
    <p>
      The width is given by the maximum width of the
      numerator and denominator. The numerator and denominator are
      horizontally centered. A fraction bar with the actual thickness is drawn
      centered on the
      axis height. The numerator and denominator are shifted
      up and down using the values <code class="MATH">FractionNumeratorShiftUp</code>,
      <code class="MATH">FractionDenominatorShiftDown</code> in inline style and
      <code class="MATH">FractionNumeratorDisplayStyleShiftUp</code>,
      <code class="MATH">FractionDenominatorDisplayStyleShiftDown</code>
      in display style.
      If necessary, these shift values are increased to ensure that the gaps between
      the numerator/denominator and fraction bar satisfy the minimal values provided
      by <code class="MATH">FractionDenominatorGapMin</code> and
      <code class="MATH">FractionNumeratorGapMin</code> in inline style and
      <code class="MATH">FractionDenominatorDisplayStyleGapMin</code> and
      <code class="MATH">FractionNumeratorDisplayStyleGapMin</code>
      in display style.
    </p>
    <figure id="figure-box-mfrac">
      <img src="figures/mfracbox.svg"/>
      <figcaption>Box model for the <code>&lt;mfrac&gt;</code> element</figcaption>
    </figure>
    </section>
    <section>
      <h4>Fraction with zero line thickeness</h4>
      <p>
      If the actual line thickness is zero,
      the <code>&lt;mfrac&gt;</code> element is instead laid out as
      shown on <a href="#figure-box-mfrac-without-bar"></a>.
      The gap between the top and bottom boxes
      is equally split around the math axis, which is
      <code class="MATH">AxisHeight</code> above the baseline.
      The relevant shift values are now
      <code class="MATH">StackTopShiftUp</code>,
      <code class="MATH">StackBottomShiftDown</code> in inline style and
      <code class="MATH">StackTopDisplayStyleShiftUp</code>,
  <code class="MATH">StackBottomDisplayStyleShiftDown</code> in display style.
  If necessary, the two shift values are increased by a same value to ensure
  the gap between the top and bottom boxes satisfy the values provided by
  by <code class="MATH">StackGapMin</code> in inline style and
  <code class="MATH">StackDisplayStyleGapMin</code> in display style.
</p>
<figure id="figure-box-mfrac-without-bar">
  <img src="figures/mfracnobarbox.svg"/>
  <figcaption>Box model for the <code>&lt;mfrac&gt;</code> element without bar</figcaption>
</figure>
    </section>
    <section>
      <h4>Spacing around the fraction</h4>
    <p>
  In order to prevent the fraction bar to be confused with other items around
  the fraction (e.g. minus sign or the bar of another fraction), a 1 pixel space
  must actually be added on each side of the <code>&lt;mfrac&gt;</code> element.
</p>
<p>
  If the numerator is an embellished operator and the <code>&lt;mfrac&gt;</code> element is the
  outermost element in this embellished operator hierarchy then the operator
  leading and trailing spaces must be added around the fraction.
</p>
    </section>
  </section>
  <section>
    <h3>Radicals <code>&lt;msqrt&gt;</code>, <code>&lt;mroot&gt;</code></h3>
    <p>
      The
      <dfn data-dfn-type="msqrt" id="element-msqrt"><code>&lt;msqrt&gt;</code></dfn>
      and
      <dfn data-dfn-type="mroot" id="element-mroot"><code>&lt;mroot&gt;</code></dfn>
      elements construct radicals. The <code>&lt;msqrt&gt;</code> element is
      used for square roots, while the <code>&lt;mroot&gt;</code> element is
      used to draw radicals with indices, e.g. a cube root.
    </p>
    <p>
    </p>
    <p>
      The <code>&lt;msqrt&gt;</code> and <code>&lt;mroot&gt;</code>
      elements accept the attributes described
      in <a href="#global-attributes"></a>.
    </p>
    <p>
      The <code>&lt;mroot&gt;</code> element sets
      increments scriptlevel by 2, and sets displaystyle to "false" in all
      but its first child.
      The <a href="#user-agent-stylesheet">user agent stylesheet</a>
      must contain the following rule in order to implement that behavior:
    </p>
    <pre data-include="user-agent-stylesheet/mroot.css"></pre>
    <div class="issue" data-number="15">Decide how to handle invalid
      mroot.</div>
    <p>
      If the <code>&lt;mroot&gt;</code> has less or more than two children,
      its layout algorithm
      is the same as the <a><code>&lt;mrow&gt;</code></a> element.
      Otherwise, the first child is called
      <dfn data-dfn-type="base" id="mroot-base">base</dfn> and
      the second child is called
      <dfn data-dfn-type="index" id="mroot-index">index</dfn>
      and its layout algorithm is explained below.
      The children of the <code>&lt;msqrt&gt;</code> element are laid out
      using the algorithm of the <a><code>&lt;mrow&gt;</code></a> element
      to produce a box that we will also call the base.
    </p>
    <section>
      <h4>Radical symbol</h4>
      <p>
        The radical symbol must only be painted if the
        <a data-cite="CSS2#visibility"><code>visibility</code></a> of
        the <code>&lt;msqrt&gt;</code> or <code>&lt;mroot&gt;</code>
        element is <code>visible</code>.
        In that case, the radical symbol must be painted with the
        <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a>
        of that element.
      </p>
      <p>
        The line thickness of the overbar is given by
        <code class="MATH">RadicalRuleThickness</code>.
        The gap between the overbar and base is given by
        <code class="MATH">RadicalVerticalGap</code>
        in inline style and
        <code class="MATH">RadicalDisplayStyleVerticalGap</code>
        in display style.
        The ascent above the overbase is given by
        <code class="MATH">RadicalExtraAscender</code>.
      </p>
      <p>
        The surd is drawn by trying to vertically stretch the character
        U+221A SQUARE ROOT
        to at least the sum of the ink height of the base, the radical gap and
        the radical rule thickness. If the CSS <code>direction</code> is set to
        right-to-left,
        then the surd is actually drawn from the glyph obtained by mirroring
        U+221A SQUARE ROOT via the <code>rtlm</code> OpenType feature.
      </p>
    </section>
    <section>
      <h4>Square root</h4>
      <p>
        The <code>&lt;msqrt&gt;</code> element is laid out as shown on
        <a href="#figure-box-msqrt"></a>.
        The width is given by the sum of the width of the surd and of the
        base.
        The baseline of the square root matches the baseline of the base.
        The ink box is determined from the ink boxes of the surd and base
        while the logical box takes into account the extra ascender.
      </p>
      <figure id="figure-box-msqrt">
        <img src="figures/msqrtbox.svg"/>
        <figcaption>Box model for the <code>&lt;msqrt&gt;</code> element</figcaption>
        </figure>
    </section>
    <section>
      <h4>Root with index</h4>
      <p>
        The <code>&lt;mroot&gt;</code> element is laid out as shown on
        <a href="#figure-box-mroot"></a>.
        We start by ignoring the root index and we layout the base and surd as
        shown on figure <a href="#figure-box-msqrt"></a> to obtain a box B.
        The horizontal metrics of the <code>&lt;mroot&gt;</code> element are
        obtained by putting
        <code class="MATH">RadicalKernBeforeDegree</code>
        before the root index, then placing the root index, then a kerning
        of <code class="MATH">RadicalKernAfterDegree</code>
        after the root index and finally placing B. In general
        the kerning before the root index is positive while the kerning after
        it is negative,
        which means that the root element will have some space before it and
        that the root index will overlap the surd.
        For the vertical metrics of the <code>&lt;mroot&gt;</code> element, we
        first take the baseline
        of B as the baseline. We graduate the ink height of B with a linear
        scale going from the bottom at coordinate 0 to the top at coordinate
        1. Then the ink bottom of the root index will
        be vertically positioned at coordinate
        <code class="MATH">RadicalDegreeBottomRaisePercent</code>.
        Finally, we take into consideration the box of the root index and B to
        deduce the metrics for the whole box of the <code>&lt;mroot&gt;</code>
        element.
      </p>
      <figure id="figure-box-mroot">
        <img src="figures/mrootbox.svg"/>
        <figcaption>Box model for the <code>&lt;mroot&gt;</code> element</figcaption>
      </figure>
    </section>
  </section>
  <section>
  <h3>Style Change <code>&lt;mstyle&gt;</code></h3>
  <p>
    Historically, the
    <dfn data-dfn-type="mstyle" id="element-mstyle"><code>&lt;mstyle&gt;</code></dfn>
    element was introduced to make
    style changes that affect the rendering of its contents.
  </p>
  <p>
    The <code>&lt;mstyle&gt;</code> element accepts the attributes described in
    <a href="#global-attributes"></a>. Its layout algorithm is the
    same as the <a><code>&lt;mrow&gt;</code></a> element.
  </p>
  <div class="note">
    Although <code>&lt;mstyle&gt;</code> is not really useful in modern web
    environments, it is preserved for backward compatibility reasons.
  </div>
</section>
<section>
  <h3>Error Message <code>&lt;merror&gt;</code></h3>
  <p>
    The
    <dfn data-dfn-type="merror" id="element-merror"><code>&lt;merror&gt;</code></dfn>
    element displays its contents as an
    ”error message”. The intent of this element is to provide a standard way
    for programs that generate MathML from other input to report syntax errors
    in their input.
  </p>
  <p>
    The <code>&lt;merror&gt;</code> element accepts the attributes described in
    <a href="#global-attributes"></a>. Its layout algorithm is the
    same as the <a><code>&lt;mrow&gt;</code></a> element.
    The <a href="#user-agent-stylesheet">user agent stylesheet</a>
    must contain the following rule in order to visually highlight the error
    message:
  </p>
  <pre data-include="user-agent-stylesheet/merror.css"></pre>
</section>
<section>
  <h3>Adjust Space Around Content <code>&lt;mpadded&gt;</code></h3>
  <p>
    The
    <dfn data-dfn-type="mpadded" id="element-mpadded"><code>&lt;mpadded&gt;</code></dfn>
    element renders the same as its child content, but with the
    size of the child’s bounding box and the relative positioning point of its
    content modified according to <code>&lt;mpadded&gt;</code>’s attributes.
  </p>
  <p>
    See [[MATHML3]] for how the metrics of <code>&lt;mpadded&gt;</code> element are determined.
    Note that pseudo-units allows horizontal metrics to depend on vertical metrics,
    for example <code>width="2height"</code> which can be problematic to determine
    intrinsic widths. Hence in the present document, if
    the value of the <code>width</code> and <code>lspace</code> attributes contains
    ”height” or ”depth” pseudo-units, then they must be ignored.
  </p>
  <p>
    The <code>&lt;mpadded&gt;</code> element is laid out as shown on
    <a href="#figure-box-mpadded"></a>.
    The height, depth and width of the content in [[MATHML3]] corresponds to
    the logical box of the content. The content of the <code>&lt;mpadded&gt;</code> element is
    positioned from the origin of the <code>&lt;mpadded&gt;</code> element as follows: We shift
    the content
    forward by a distance of <code>lspace</code> and shift it upward by a distance of
    <code>voffset</code>. The logical metrics of the <code>&lt;mpadded&gt;</code> element are given by the
    height, depth and width of the <code>&lt;mpadded&gt;</code> element described in
    [[MATHML3]]. The ink metrics of the <code>&lt;mpadded&gt;</code> element match their logical
    metrics.
  </p>
  <figure id="figure-box-mpadded">
    <img src="figures/mpaddedbox.svg"/>
    <figcaption>Box model for the <code>&lt;mpadded&gt;</code> element</figcaption>
  </figure>
</section>
<section>
  <h3>Making Sub-Expressions Invisible <code>&lt;mphantom&gt;</code></h3>
  <p>
    Historically, the
    <dfn data-dfn-type="mphantom" id="element-mphantom"><code>&lt;mphantom&gt;</code></dfn>
    element was introduced to render
    its content invisibly, but with the same size and other dimensions,
    including baseline position, that its contents would have if they were
    rendered normally.
  </p>
  <p>
    The <code>&lt;mphantom&gt;</code> element accepts the attributes described
    in <a href="#global-attributes"></a>. Its layout algorithm is
    the same as the <a><code>&lt;mrow&gt;</code></a> element.
    The <a href="#user-agent-stylesheet">user agent stylesheet</a>
    must contain the following rule in order to hide the content:
  </p>
  <pre data-include="user-agent-stylesheet/mphantom.css"></pre>
  <div class="note">
    Although <code>&lt;mphantom&gt;</code> is not really useful in modern web
    environments, it is preserved for backward compatibility reasons.
  </div>
</section>
<section>
  <h3>Enclose Expression Inside Notation <code>&lt;menclose&gt;</code></h3>
  <p>
    The
    <dfn data-dfn-type="menclose" id="element-menclose"><code>&lt;menclose&gt;</code></dfn>
    element renders its content inside the enclosing notation specified by its notation attribute.
  </p>
  <p>
    The color and visibility of the <code>&lt;menclose&gt;</code> notations must honor the values
    given by the <code>color</code> and <code>visibility</code> CSS properties on the
    <code>&lt;menclose&gt;</code> element.
  </p>
  <p>
    Based on [[OPEN-FONT-FORMAT]] [[?TEXBOOK]], we use the notation ξ<sub>8</sub>
    from the TeXBook to denote the default rule thickness and use
    3ξ<sub>8</sub> for gaps.
    We actually let ξ<sub>8</sub> be <code class="MATH">OverbarRuleThickness</code>.
    Note that contrary to what is done in general and unless specified otherwise,
    the x-axis direction of notations is assumed to be independent of the CSS
    <code>direction</code>.
    In order to determine the metrics of the <code>&lt;menclose&gt;</code> notation, we
    compute each notation individually and take the union of the metrics:
  </p>
  <ol>
    <li>
      <p>
        The <code>left</code> notation is drawn by putting a vertical bar of thickness
        ξ<sub>8</sub> on the left of the content of the <code>&lt;menclose&gt;</code> element.
        The length of the bar is obtained by extending the height of the content
        with <code class="MATH">OverbarVerticalGap</code> plus
        <code class="MATH">OverbarRuleThickness</code> above
        and <code class="MATH">UnderbarVerticalGap</code> plus
        <code class="MATH">UnderbarRuleThickness</code> below.
        The gap between the bar and the content is 3ξ<sub>8</sub>.
        The logical box is obtained by adding some space of width
        ξ<sub>8</sub> on the left of the bar. See
        <a href="#figure-box-menclose-left"></a>.
      </p>
      <figure id="figure-box-menclose-left">
        <img src="figures/leftbox.svg"/>
        <figcaption>Box model for the <code>left</code>
          notation of the <code>&lt;menclose&gt;</code> element</figcaption>
      </figure>
    </li>
    <li>
      <p>
        The <code>right</code> notation is drawn the same as the <code>left</code> notation,
        but with the vertical bar placed on the right.
      </p>
    </li>
    <li>
      <p>
        The <code>top</code> notation is drawn by putting an overbar of thickness
        <code class="MATH">OverbarRuleThickness</code>
        over the content of the <code>&lt;menclose&gt;</code> element.
        The length of the bar is obtained by extending the width of the content
        with 4ξ<sub>8</sub> on each side.
        The gap between the overbar and the content is
        <code class="MATH">OverbarVerticalGap</code>.
        The logical box is obtained by adding some space of height
        <code class="MATH">OverbarExtraAscender</code> above the bar.
        See <a href="#figure-box-menclose-top"></a>.
      </p>
      <figure id="figure-box-menclose-top">
        <img src="figures/topbox.svg"/>
        <figcaption>Box model for the <code>top</code>
          notation of the <code>&lt;menclose&gt;</code> element</figcaption>
      </figure>
    </li>
    <li>
      <p>
        The <code>bottom</code> notation is drawn the same as the <code>top</code> notation,
        but with the vertical bar placed below the content and using parameters
        <code class="MATH">UnderbarRuleThickness</code>,
        <code class="MATH">UnderbarVerticalGap</code>.
        and <code class="MATH">UnderExtraDescender</code>.
      </p>
    </li>
    <li>
      The <code>box</code> notation is treated as equivalent to
      <code>left right top bottom</code>.
    </li>
    <li>
      <p>
        To draw the <code>roundedbox</code> notation, we consider the box
        obtained by expanding the ink box by 7ξ<sub>8</sub> / 2 on each side.
        Using terminology from [[SVG]],
        we draw a rounded rectangle on this expanded box
        with parameters <code>rx</code>, <code>ry</code> and <code>stroke-width</code> set to 3ξ<sub>8</sub>.
        To obtain the logical box we again add a space of ξ<sub>8</sub> on
        each side of the ink box. See <a href="#figure-box-menclose-roundedbox"></a>.
      </p>
      <figure id="figure-box-menclose-roundedbox">
        <img src="figures/roundedbox.svg"/>
        <figcaption>Box model for the <code>roundedbox</code>
          notation of the <code>&lt;menclose&gt;</code> element</figcaption>
      </figure>
    </li>
    <li>The <code>actuarial</code> notation is treated as equivalent to <code>right top</code>.</li>
    <li>
      <p>
        The <code>madruwb</code> notation is treated as equivalent to
        <code>right bottom</code>.
    </li>
    <li>
      <p>
        The <code>horizontalstrike</code> notation is drawn with an horizontal bar
        of thickness ξ<sub>8</sub> and
        vertically centered inside the <code>&lt;menclose&gt;</code> content.
        This does not change the box metrics.
        See <a href="#figure-box-horizontal-strike"></a>.
      </p>
      <figure id="figure-box-horizontal-strike">
        <img src="figures/horizstrikebox.svg"/>
        <figcaption>Box model for the <code>horizontalstrike</code>
          notation of the <code>&lt;menclose&gt;</code> element</figcaption>
      </figure>
    </li>
    <li>
      <p>
        The <code>verticalstrike</code> notation is drawn the same as
        <code>horizontalstrike</code> but with a vertical bar
        of thickness ξ<sub>8</sub> and horizontally centered inside the <code>&lt;menclose&gt;</code>
        content.
      </p>
    </li>
    <li>
      <p>
        The <code>updiagonalstrike</code> notation is drawn with a line
        of thickness ξ<sub>8</sub> going from the bottom left corner of the <code>&lt;menclose&gt;</code>
        content to its top right corner. Using terminology from [[SVG]], the
        <code>stroke-linecap</code> of the line is <code>butt</code>.
        As an approximation, the ink box
        is set equal to the logical box and obtained by increasing the original box
        from each side by ξ<sub>8</sub> / 2.
        See <a href="#figure-box-menclose-up-diagonal-strike"></a>.
      </p>
      <figure id="figure-box-menclose-up-diagonal-strike">
        <img src="figures/updiagstrikebox.svg"/>
        <figcaption>Box model for the <code>updiagonalstrike</code>
          notation of the <code>&lt;menclose&gt;</code> element</figcaption>
      </figure>
    </li>
    <li>
      <p>
        The <code>downdiagonalstrike</code> notation is drawn as an
        <code>updiagonalstrike</code>
        but the line strike goes from the top left corner to the bottom right corner.
        Using terminology from [[SVG]], the
        <code>stroke-linecap</code> of the line is <code>butt</code>.
      </p>
    </li>
    <li>
      <p>
        The <code>longdiv</code> notation is drawn similarly to the <code>&lt;msqrt&gt;</code> element
        (<a href="#figure-box-msqrt"></a>). It is independent of CSS
        <code>direction</code> and U+221A SQUARE ROOT is replaced with
        U+0029 RIGHT PARENTHESIS. The rule thickness is ξ<sub>8</sub>,
        the gap between content and overbar is 3ξ<sub>8</sub> and the extra ascender
        is ξ<sub>8</sub>.
      </p>
    </li>
    <li>
      <p>
        To draw the <code>circle</code> notation, we first consider the ink box of
        width w and height h. We draw the ellipse
        of axes the axes of symmetry of this ink box, of radii
        w * √2 / 2
        and
        h * √2 / 2
        and of thickness ξ<sub>8</sub>.
        We ensure that the logical box also has space ξ<sub>8</sub> around each side
        of the ellipse ink box.
      </p>
      <figure id="figure-box-menclose-circle">
        <img src="figures/circlebox.svg"/>
        <figcaption>Box model for the <code>circle</code>
          notation of the <code>&lt;menclose&gt;</code> element</figcaption>
      </figure>
    </li>
    <li>
      <p>
        This document does define any layout algorithm for other <code>&lt;menclose&gt;</code>
        notations. User agents may ignore them.
      </p>
    </li>
  </ol>
</section>
</section>
<section>
  <h2>Script and Limit Schemata</h2>
  <section>
    <h3>Subscripts and Superscripts <code>&lt;msub&gt;</code>, <code>&lt;msup&gt;</code>, <code>&lt;msubsup&gt;</code></h3>
    <p>
      The
      <dfn data-dfn-type="msub" id="element-msub"><code>&lt;msub&gt;</code></dfn>
      element attaches a subscript to a base using the syntax
      <br/>
      <code>&lt;msub&gt;</code> base subscript <code>&lt;/msub&gt;</code>
    </p>
    <p>
      The
      <dfn data-dfn-type="msup" id="element-msup"><code>&lt;msup&gt;</code></dfn>
      element attaches a superscript to a base using the syntax
      <br/>
      <code>&lt;msup&gt;</code> base superscript <code>&lt;/msup&gt;</code>
    </p>
    <p>
      The
      <dfn data-dfn-type="msubsup" id="element-msubsup"><code>&lt;msubsup&gt;</code></dfn>
      element is used to attach both a subscript and superscript to
      a base expression.
      <br/>
      <code>&lt;msubsup&gt;</code> base subscript superscript <code>&lt;/msubsup&gt;</code>
    </p>
    <p>
      The <a><code>displaystyle</code></a> and <a><code>scriptlevel</code></a>
      changes must be achieved with rules described in
      <a href="#user-agent-stylesheet"></a>.
    </p>
    <p>
      The <code>&lt;msub&gt;</code> element is laid out as shown on <a href="#figure-box-msub"></a>.
      The baseline is the baseline of the base while the baseline of the script is
      shifted down by <code>SubShift</code>, which is the minimal value honoring the
      following conditions:
    </p>
    <ol>
      <li>
        <p>
          <code>SubShift</code> is at least <code class="MATH">SubscriptShiftDown</code>.
        </p>
      </li>
      <li>
        <p>
          The top of the subscript <code>SubTop</code> with respect to the baseline
          is not above <code class="MATH">SubscriptTopMax</code>.
        </p>
      </li>
      <li>
        <p>
          The drop <code>SubscriptBaselineDrop</code> from the bottom of the base to
          the baseline of the script is at least
          <code class="MATH">SubscriptBaselineDropMin</code>.
        </p>
      </li>
    </ol>
    <p>
      When determining
      the logical box, a space of width <code class="MATH">SpaceAfterScript</code>
      is added after
      the subscript. By default, the leading edge of the subscript is aligned with
      the trailing edge of the base. However, if the base is an operator with
      <code>largeop="true"</code> (or an embellished operator whose <code>&lt;mo&gt;</code> element core
      has <code>largeop="true"</code>) the subscript is horizontally shifted backward
      by the italic correction of the base.
    </p>
    <figure id="figure-box-msub">
      <img src="figures/msubbox.svg"/>
      <figcaption>Box model for the <code>&lt;msub&gt;</code> element</figcaption>
    </figure>
    <p>
      The <code>&lt;msup&gt;</code> element is laid out as shown on <a href="#figure-box-msup"></a>.
      The baseline is the baseline of the base while the baseline of the script is
      shifted up by <code>SuperShift</code>, which is the minimal value honoring the
      following conditions:
    </p>
    <ol>
      <li><code>SuperShift</code> is at least
        <code class="MATH">SuperscriptShiftUpCramped</code> if the <code>&lt;msup&gt;</code> element is
        <a>cramped</a> or at least
        <code class="MATH">SuperscriptShiftUp</code> otherwise.
      </li>
      <li>
        <p>
          The bottom of the superscript <code>SuperBottom</code> with respect to the
          baseline is not below <code class="MATH">SuperscriptBottomMin</code>.
      </li>
      <li>
        <p>
          The drop <code class="MATH">SuperscriptBaselineDrop</code> from the top of the base to
          the baseline of the script is at most <code class="MATH">SuperscriptBaselineDropMax</code>.
      </li>
    </ol>
    <p>
      When determining
      the logical box, a space of width <code class="MATH">SpaceAfterScript</code>
      is added after
      the superscript. By default, the leading edge of the superscript is aligned with
      the trailing edge of the base and shifted forward by the italic correction
      of the base, except if the base is an operator with
      <code>largeop="true"</code> (or an embellished operator whose <code>&lt;mo&gt;</code> element core
      has <code>largeop="true"</code>).
    </p>
    <figure id="figure-box-msup">
      <img src="figures/msupbox.svg"/>
      <figcaption>Box model for the <code>&lt;msup&gt;</code> element</figcaption>
    </figure>
    <p>
      The <code>&lt;msubsup&gt;</code> element is laid out as shown on
      <a href="#figure-box-msup"></a>.
      The baseline is the baseline of the base while the baseline of the script is
      shifted down by <code>SubShift</code> and the superscript is shifted up by
      <code>SuperShift</code> which is initially set to the minimal values honoring the
      following conditions:
    </p>
    <ol>
      <li><code>SubShift</code> is at least
        <code class="MATH">SuperscriptShiftUpCramped</code> if the <code>&lt;msup&gt;</code> element is
        <a>cramped</a> or at least
        <code class="MATH">SuperscriptShiftUp</code> otherwise.
      </li>
      <li>
        The top of the subscript <code>SubTop</code> with respect to the baseline
        is not above <code class="MATH">SubscriptTopMax</code>.
      </li>
      <li><p>
          The drop <code class="MATH">SuperscriptBaselineDrop</code> from the top of the base to
          the baseline of the superscript is at most <code class="MATH">SuperscriptBaselineDropMax</code>.</li>
      <li><code>SubShift</code> is at least
        <code class="MATH">SuperscriptShiftUpCramped</code> if the <code>&lt;msup&gt;</code> element is
        <a>cramped</a> or at least
        <code class="MATH">SuperscriptShiftUp</code> otherwise.
      </li>
      <li>The bottom of the superscript <code>SuperBottom</code> with respect to the
        baseline is not below <code class="MATH">SuperscriptBottomMin</code>.
      </li>
      <li>The drop <code class="MATH">SubscriptBaselineDrop</code> from
        the bottom of the base to the the baseline of the subscript is at least
        <code class="MATH">SubscriptBaselineDropMin</code>.
      </li>
    </ol>
    <p>
      We then increase the gap <code>SubSuperGap</code> between the bottom of the superscript
      and the top of the subscript to ensure it is at least
      <code class="MATH">SubSuperscriptGapMin</code>:
      This is first done by continuing to shift the superscript up as long as the
      <code>SuperBottom</code> does not exceed
      <code class="MATH">SuperscriptBottomMaxWithSubscript</code>
      and next by continuing to shift the subscript down.
    </p>
    <p>
      When determining
      the logical box, a space of width <code class="MATH">SpaceAfterScript</code>
      is added after
      each script. By default the leading edges of the scripts are aligned with
      the trailing edge and either the superscript is shifted forward by the italic
      correction of the base. However, if the base is an operator with
      <code>largeop="true"</code> (or an embellished operator whose <code>&lt;mo&gt;</code> element core
      has <code>largeop="true"</code>) then instead the subscript is shifted forward by the
      italic correction of the base.
    </p>
    <figure id="figure-box-msubsup">
      <img src="figures/msubsupbox.svg"/>
      <figcaption>Box model for the <code>&lt;msubsup&gt;</code> element</figcaption>
    </figure>
  </section>
  <section>
    <h3>Underscripts and Overscripts <code>&lt;munder&gt;</code>, <code>&lt;mover&gt;</code>, <code>&lt;munderover&gt;</code></h3>
    <p>
      The
      <dfn data-dfn-type="munder" id="element-munder"><code>&lt;munder&gt;</code></dfn>
      element attaches an accent or limit placed under a base using
      the syntax
      <br/>
      <code>&lt;munder&gt;</code> base underscript <code>&lt;/munder&gt;</code>
      <br/>
      If base is an operator with <code>movablelimits="true"</code> (or an embellished
      operator whose <code>&lt;mo&gt;</code> element core has <code>movablelimits="true"</code>), and
      <code>displaystyle="false"</code>, then underscript is drawn in a subscript position.
      In this case, the <code>accentunder</code> attribute is ignored. […]
    </p>
    <p>
      The
      <dfn data-dfn-type="mover" id="element-mover"><code>&lt;mover&gt;</code></dfn>
      element attaches an accent or limit placed over a base using
      the syntax
      <br/>
      <code>&lt;mover&gt; base overscript &lt;/mover&gt;</code>
      <br/>
      If base is an operator with <code>movablelimits="true"</code> (or an embellished
      operator whose <code>&lt;mo&gt;</code> element core has <code>movablelimits="true"</code>), and
      <code>displaystyle="false"</code>, then overscript is drawn in a superscript position.
      In this case, the <code>accent</code> attribute is ignored.
    </p>
    <p>
      The
      <dfn data-dfn-type="munderover" id="element-munderover"><code>&lt;munderover&gt;</code></dfn>
      element attaches accents or limits placed both over and
      under a base using the syntax
      <br/>
      <code>&lt;munderover&gt; base underscript overscript &lt;/munderover&gt;</code>
      <br/>
      If base is an operator with <code>movablelimits="true"</code> (or an embellished
      operator whose <code>&lt;mo&gt;</code> element core has <code>movablelimits="true"</code>), and
      <code>displaystyle="false"</code>, then underscript and overscript are drawn in a
      subscript and superscript position, respectively. In this case, the
      <code>accentunder</code> and <code>accent</code> attributes are ignored.
    </p>
    <p>
      User Agents must perform the <code>scriptlevel</code> increment by checking
      the appropriate <code>accent</code> or <code>accentunder</code> value, which can not be done
      using only CSS. However, <code>displaystyle</code> changes can be achieved with the
      following style in the user agent stylesheet, as suggested in
      <a href="#user-agent-stylesheet"></a>:
    </p>
    <p>
      In cases where underscript and overscript are drawn as subscript and
      superscript position then the layout algorithm is the same as
      <a href="#subscripts-and-superscripts-msub-msup-msubsup"></a>.
      Note that in that case,
      <code>accent</code> or <code>accentunder</code> are ignored so the scriptlevel increment is
      always performed.
    </p>
    <p>
      The general layout of <code>&lt;munderover&gt;</code> is shown on
      <a href="figure-box-munderover"></a>.
      The overscript is placed above the base, the underscript below the base
      and by default are aligned with respect to their geometrical center.
      If the overscript is an accent and has a <code class="MATH">TopAccentAttachment</code>
      value, then this value may be used to horizontally align the accent instead
      of its geometrical center.
      <code>OverShift</code> is the distance between the top ink
      of the base and the baseline of the overscript, <code>OverGap</code> is the distance
      between the top ink of the base and the bottom ink of the overscript,
      <code class="MATH">OverExtraAscender</code> is extra space to add above the overscript when
      determining the logical box. <code>UnderShift</code>, <code>UnderGap</code> and
      <code class="MATH">UnderExtraDescender</code> are defined similarly for the underscripts.
      We distinguish three cases:
    </p>
    <ol>
      <li>If the base is an operator with <code>largeop="true"</code>
        (or an embellished operator whose <code>&lt;mo&gt;</code> element core has
        <code>largeop="true"</code>) then ensure that <code>OverGap</code> is at least
        <code class="MATH">UpperLimitGapMin</code>, that <code>OverShift</code> is at least
        <code class="MATH">UpperLimitBaselineRiseMin</code> that <code>UnderGap</code> is at
        least
        <code class="MATH">LowerLimitGapMin</code>, that <code>UnderShift</code> is at least
        <code class="MATH">LowerLimitBaselineDropMin</code>.
        <code class="MATH">OverExtraAscender</code> and
        <code class="MATH">UnderExtraDescender</code> are zero. The
        underscript is shifted backward by half the italic correction of the base.
        The overscript is shifted forward by half the italic correction of the base.</li>
      <li>If the base is a horizontal operator with <code>stretchy="true"</code>
        (or a horizontal embellished operator whose <code>&lt;mo&gt;</code> element core has
        <code>stretchy="true"</code>). Then ensure that <code>OverGap</code> is at least
        <code class="MATH">StretchStackGapBelowMin</code>, that <code>OverShift</code> is at
        least
        <code class="MATH">StretchStackTopShiftUp</code> that <code>UnderGap</code> is at least
        <code class="MATH">StretchStackGapAboveMin</code>,
        that <code>UnderShift</code> is at least
        <code class="MATH">StretchStackBottomShiftDown</code>.
        <code class="MATH">OverExtraAscender</code> and
        <code class="MATH">UnderExtraDescender</code> are zero.
      </li>
      <li>In other cases we proceed as follows.
        There are not any specific conditions to satisfy on <code>OverShift</code> or
        <code>UnderShift</code>.
        <code>OverExtraAscender</code> and
        <code>OverExtraAscender</code> are respectively set to
        <code class="MATH">OverbarExtraAscender</code>
        and <code class="MATH">UnderExtraDescender</code>.
        We set <code>UnderGap</code> to <code class="MATH">UnderbarVerticalGap</code>
        if the underscript is not an accent and to zero otherwise.
        We set <code>OverGap</code> to <code class="MATH">OverbarVerticalGap</code>
        if the overscript is not an accent and generally to zero otherwise.
        However, if overscript is an accent and if the base ascent is at most
        <code class="MATH">AccentBaseHeight</code> then we actually set <code>OverGap</code> to
        their nonnegative difference.
      </li>
    </ol>
    <p>
      Remark: For accent overscripts and bases with ascents that are at most
      <code class="MATH">AccentBaseHeight</code>, the rule from
      [[OPEN-FONT-FORMAT]] [[?TEXBOOK]] is actually to align the baselines of the
      overscripts and of the bases. This assumes that accent glyphs are designed in
      such a way that their ink bottoms are more or less
      <code class="MATH">AccentBaseHeight</code> above their baselines. Hence, the
      previous rule will guarantee that all the overscript bottoms are aligned while
      still avoiding collision with the bases. However, MathML can have arbitrary
      accent overscripts so we provide a more general and simpler rule above: Ensure
      that the bottom of overscript is at least
      <code class="MATH">AccentBaseHeight</code> above the baseline of the base.
    </p>
    <figure id="figure-box-munderover">
      <img src="figures/munderoverbox.svg"/>
      <figcaption>Box model for the <code>&lt;munderover&gt;</code> element</figcaption>
    </figure>
    <p>
      The layout of <code>&lt;munder&gt;</code> and <code>&lt;mover&gt;</code> is the same as the one of
      <code>&lt;munderover&gt;</code> except that one script and its corresponding extra space
      are ignored.
    </p>
  </section>
  <section>
    <h3>Prescripts and Tensor Indices <code>&lt;mmultiscripts&gt;</code></h3>
    <p>
      Presubscripts and tensor notations are represented by a single element,
      <dfn data-dfn-type="mmultiscripts" id="element-mmultiscripts"><code>&lt;mmultiscripts&gt;</code></dfn>, using the syntax:</p>
    <pre>&lt;mmultiscripts&gt;
  base
  (subscript superscript)*
  [ &lt;mprescripts/&gt; (presubscript presuperscript)* ]
&lt;/mmultiscripts&gt;</pre>
    <p>
      This element allows the representation of any number of vertically-aligned
      pairs of subscripts and superscripts, attached to one base expression. It
      supports both postscripts and prescripts
      separated by
      the empty element
      <dfn data-dfn-type="mprescripts" id="element-mprescripts"><code>&lt;mprescripts&gt;</code></dfn>. Missing scripts can be represented
      by the empty element
      <dfn data-dfn-type="none" id="element-none"><code>&lt;none&gt;</code></dfn>.
    </p>
    <p>
      The <a><code>displaystyle</code></a> and <a><code>scriptlevel</code></a>
      changes must be achieved with rules described in
      <a href="#user-agent-stylesheet"></a>.
    </p>
    <p>
      Any layout for <code>&lt;mmultiscripts&gt;</code> is acceptable as long as it follows
      the condition of the MathML 3 specification [[MATHML3]] and is consistent
      with
      <a href="#subscripts-and-superscripts-msub-msup-msubsup"></a>
      for <code>&lt;mmultiscripts&gt;</code>
      contructions that are equivalent to <code>&lt;msubsup&gt;</code>. Here is a possible algorithm
      that is represented on <a href="#figure-box-mmultiscripts"></a>.
    </p>
    <ol>
      <li>
        Determine the vertical shifts for each subscript/superscript pair
        using the algorithm for <code>&lt;msub&gt;</code> (if the superscript is <code>&lt;none&gt;</code>),
        <code>&lt;msup&gt;</code> (if the subscript is <code>&lt;none&gt;</code>) or <code>&lt;msubsup&gt;</code>
        (if none of the scripts are <code>&lt;none&gt;</code>) or otherwise use shifts of zero
        (if both scripts of the pair are <code>&lt;none&gt;</code>). When placing the scripts,
        use the maximum of the subscript shift for all subscript and
        the maximum of the superscript shift for all superscripts.
      </li>
      <li>
        For the horizontal layout of postscripts, use the trailing edge of the
        base or of the previous pair as the leading edge of the current pair.
        For each pair, apply the same italic correction described for
        <code>&lt;msubsup&gt;</code> in
        <a href="#subscripts-and-superscripts-msub-msup-msubsup"></a>.
        Apply the same italic corrections for all these postscripts.
      </li>
      <li>For the horizontal layout of prescripts, use the leading edge of the
        base or of next pair as the trailing edge of the current pair. Do not apply
        any italic correction for prescripts.
      </li>
    </ol>
    <figure id="figure-box-mmultiscripts">
      <img src="figures/mmultiscriptsbox.svg"/>
      <figcaption>Box model for the <code>&lt;mmultiscripts&gt;</code> element</figcaption>
    </figure>
  </section>
</section>
<section>
  <h2>Tabular Math</h2>
  <p>
    Matrices, arrays and other table-like mathematical notation are marked up using
    <dfn data-dfn-type="mtable" id="element-mtable"><code>&lt;mtable&gt;</code></dfn>
    <dfn data-dfn-type="mtr" id="element-mtr"><code>&lt;mtr&gt;</code></dfn>
    <dfn data-dfn-type="mtd" id="element-mtd"><code>&lt;mtd&gt;</code></dfn>
    elements. These
    elements are similar to the table, tr and td elements of HTML, except that they
    provide specialized attributes for the fine layout control necessary for
    commutative diagrams, block matrices and so on.
  </p>
  <p>
    In the present document, we restrict ourselves to a minimal implementation
    compatible with HTML tables. First the <code>&lt;mtable&gt;</code> element must be treated as
    a HTML table and by [[MATHML3]], <code>&lt;mtable&gt;</code> must accept a
    <code>displaystyle</code> attribute with default value <code>false</code>.
  </p>
  <p>
    The <a><code>displaystyle</code></a> and
    <a><code>scriptlevel</code></a> changes must be achieved by the rules
    described in <a href="#user-agent-stylesheet"></a>.
  </p>
  <p>
    In addition, user agents may use the following rules to emulate the <code>frame</code>
    attribute:
  </p>
  <pre class="css">mtable[frame="none"] {
  border: none;
  }
mtable[frame="solid"] {
  border: solid thin;
  }
mtable[frame="dashed"] {
  border: dashed thin;
}</pre>
  <p>
    By default, user agents must align the vertical center of the table on the
    math axis, which is provided by the <code class="MATH">AxisHeight</code> value.
    User agents may also support non-default <code>align</code> attribute values.
  </p>
  <p>
    The <code>&lt;mtr&gt;</code> and <code>&lt;mlabeledtr&gt;</code> elements must be treated as HTML table rows
    and the label of <code>&lt;mlabeledtr&gt;</code> element must be hidden by default.
    The default value of <code>rowalign</code> must be <code>baseline</code>.
    One may rely on the following rules for the user agent stylesheet
    as suggested in
    <a href="#user-agent-stylesheet"></a>:
  </p>
  <pre class="css">mtr, mlabeledtr {
  display: table-row;
  vertical-align: baseline;
}
mlabeledtr > mtd:first-child {
  display: none;
}</pre>
  <p>
    Finally, the <code>&lt;mtd&gt;</code> elements must be treated as a HTML table cell.
    The default value of <code>rowalign</code> must be <code>baseline</code> and
    the default value of <code>colulmnalign</code> must be <code>center</code>.
    User agents may also try to approximate the default <code>rowspacing</code> and
    <code>columnspacing</code> between cells. This can be achieved with the following CSS:
  </p>
<pre class="css">mtd {
  display: table-cell;
  vertical-align: inherit;
  text-align: center;
  padding: 0.5ex 0.4em;
}</pre>
  <p>
    The <code>&lt;mtd&gt;</code> element must also support the <code>columnspan</code> (sic) and
    <code>rowspan</code> attributes. This can be implemented the same way as
    the HTML <code>colspan</code> and <code>rowspan</code> attributes.
  </p>
</section>
<section>
  <h2>Enlivening Expressions</h2>
  <p>
    Historically, the
    <dfn data-dfn-type="maction" id="element-maction"><code>&lt;maction&gt;</code></dfn>
    element provides a mechanism
    for binding actions to expressions.
  </p>
  <p>
    The <code>&lt;maction&gt;</code> element accepts the attributes described
    in <a href="#global-attributes"></a>.
    The <code>actiontype</code> and <code>selection</code> attributes are
    also accepted but they do not have any effect.
  </p>
  <p>
    The layout algorithm of the <code>&lt;maction&gt;</code> element
    the same as the <code>&lt;mrow&gt;</code> element.
    The <a href="#user-agent-stylesheet">user agent stylesheet</a>
    must contain the following rules in order to hide all but
    its first child, which is the default behavior for the legacy actiontype
    values:
  </p>
  <pre data-include="user-agent-stylesheet/maction.css"></pre>
  <div class="note">
    Although <code>&lt;maction&gt;</code> is not really useful in modern web
    environments, it is preserved for backward compatibility reasons.
  </div>
</section>
<section>
  <h2>Semantics and Presentation</h2>
  <p>
    The
    <dfn data-dfn-type="semantics" id="element-semantics"><code>&lt;semantics&gt;</code></dfn>
    element is the container element that associates
    annotations with a MathML expression. The semantics element has as its first
    child the expression to be annotated. Any MathML expression may appear as the
    first child of the semantics element. Subsequent annotation and annotation-xml
    children enclose the annotations. An annotation represented in XML is enclosed
    in an
    <dfn data-dfn-type="annotation-xml" id="element-annotation-xml"><code>&lt;annotation-xml&gt;</code></dfn>
    element. An annotation represented in character data
    is enclosed in an
    <dfn data-dfn-type="annotation" id="element-annotation"><code>&lt;annotation&gt;</code></dfn>
    element.
  </p>
  <p>
    User agents must display at most one of the child of a <code>&lt;semantics&gt;</code> element.
    For example, they may always display the first child (if any) or may use this
    more advanced algorithm to determine a visible child:
  </p>
  <ol>
    <li>
      <p>
        If the <code>&lt;semantics&gt;</code> element has a first child that is any of the
        MathML elements (other than <code>&lt;annotation&gt;</code> and <code>&lt;annotation-xml&gt;</code>)
        whose rendering is described in this document then use it as the visible
        child and stop.
      </p>
    </li>
    <li>
      <p>
        Otherwise, check the children of the <code>&lt;semantics&gt;</code> element in the DOM
        order to try and find the first child that is
      </p>
      <ol>
        <li>
          <p>
            Either an <code>&lt;annotation&gt;</code> without any <code>src</code> attribute.
          </p>
        </li>
        <li>
          <p>
            Or an <code>&lt;annotation-xml&gt;</code> without any <code>src</code> attribute and
            with an <code>encoding</code> attribute that has value
            <code>"application/mathml-presentation+xml"</code>,
            <code>"MathML-Presentation"</code>,
            <code>"image/svg+xml"</code>,
            <code>"SVG1.1"</code>,
            <code>"application/xhtml+xml"</code> or
            <code>"text/html"</code>.
          </p>
        </li>
      </ol>
    </li>
    <li>Otherwise, fallback to the first child (if any).</li>
    <li>Otherwise, the <code>&lt;semantics&gt;</code> element is empty and the visible child is
      undetermined.
    </li>
  </ol>
  <p>
    For the layout algorithm described in this document, the
    <code>&lt;annotation-xml&gt;</code> element must be treated the same as the <code>&lt;mrow&gt;</code> element,
    the <code>&lt;annotation&gt;</code> element must be treated the same as the <code>&lt;mtext&gt;</code>
    element. The <code>&lt;semantics&gt;</code> element must be treated the same as an
    <code>&lt;mrow&gt;</code> element containing only its visible child. If it is undetermined,
    the user agent may treat the <code>&lt;semantics&gt;</code> element as an
    empty <code>&lt;mrow&gt;</code> element or as an <code>&lt;merror&gt;</code> element with some error message
    indicating invalid markup.
  </p>
</section>
</section>
</section>
<section class="normative">
  <h2>CSS Extensions for Math Layout</h2>
  <section>
    <h3>New <code>text-transform</code> values</h3>
    <p>The <dfn data-dfn-type="text-transform" id="property-text-transform"><code>text-transform</code></dfn> property
      from
        is extended with new values:
    </p>
    <code><a data-cite="CSS-TEXT-3#text-transform-property">&lttext-transform-old&gt;</a> <a data-cite="CSS-VALUES-3#comb-one">|</a> math-auto | math-bold | math-italic | math-bold-italic | math-double-struck | math-bold-fraktur | math-script | math-bold-script | math-fraktur | math-sans-serif | math-bold-sans-serif | math-sans-serif-italic | math-sans-serif-bold-italic | math-monospace | math-initial | math-tailed | math-looped | math-stretched</code>
    </ul>
    <p>
      On text nodes containing a unique character, <code>math-auto</code> has
      the same effect as <code>math-italic</code>, otherwise it has no effects.
    </p>
    <p>
      For all the other <code>math-...</code> values, the transformed text is
      obtained by performing conversion of each character that have
      <a href="#mathvariant-mappings">a mapping for the specified
        <code>math-variant</code> value</a>.
    </p>
    <p>
      User agents may decide to rely on italic, bold and bold-italic
      font-level properties when available fonts lack the proper glyphs to
      perform <code>math-auto</code>, <code>math-italic</code>,
      <code>math-bold</code>, <code>math-bold-italic</code> character-level
      transforms.
    </p>
    </section>
  <section>
  <h3>The <code>math-style</code> property</h3>
  <table>
    <tbody>
      <tr>
        <th>Name:</th>
        <td>
          <dfn data-dfn-type="math-style" id="property-math-style"><code>math-style</code></dfn>
        </td>
      </tr>
      <tr><th>Value:</th><td><code>display | inline</code></td></tr>
      <tr><th>Initial:</th><td><code>inline</code></td></tr>
      <tr><th>Applies to:</th><td>All elements</td></tr>
      <tr><th>Inherited:</th><td>yes</td></tr>
      <tr><th>Percentages:</th><td>n/a</td></tr>
      <tr><th>Media:</th><td>visual</td></tr>
      <tr><th>Computed value:</th><td>specified keyword</td></tr>
      <tr><th>Canonical order:</th><td>n/a</td></tr>
      <tr><th>Animation type:</th><td>not animatable</td></tr>
    </tbody>
  </table>
  <p>
    If the value of <code>math-style</code> is <code>inline</code>, the math
    layout on descendants should try to minimize the
    <a data-cite="CSS-WRITING-MODES-3#extent">logical height</a>.
    This includes how
    <a data-cite="CSS-FONTS-3#font-size-prop"><code>font-size</code></a>
    is changed when <a><code>math-script-level</code></a> is
    <code>auto</code> as well
    miscelleanous layout rules described in details in
    <a href="#presentation-markup"></a>.
    If the value of <code>math-style</code> is <code>display</code>, the math
    layout should not take such constraints into consideration.
  </p>
  </section>
  <section>
    <h3>The <code>math-script-level</code> property</h3>
    <table>
      <tbody>
        <tr>
          <th>Name:</th>
          <td>
            <dfn data-dfn-type="math-script-level" id="property-math-script-level"><code>math-script-level</code></dfn>
          </td>
        </tr>
        <tr><th>Value:</th><td><code>auto | add(&lt;integer&gt;) | &lt;integer&gt;</code></td></tr>
        <tr><th>Initial:</th><td><code>0</code></td></tr>
        <tr><th>Applies to:</th><td>All elements</td></tr>
        <tr><th>Inherited:</th><td>yes</td></tr>
        <tr><th>Percentages:</th><td>n/a</td></tr>
        <tr><th>Media:</th><td>visual</td></tr>
        <tr><th>Computed value:</th><td>see individual properties</td></tr>
        <tr><th>Canonical order:</th><td>n/a</td></tr>
        <tr><th>Animation type:</th><td>not animatable</td></tr>
      </tbody>
    </table>
    <p>
      If the specified value of <code>math-script-level</code> is
      <code>auto</code> and the inherited value of <code>math-style</code> is
      <code>display</code> then the computed value of
      <code>math-script-level</code> is the inherited value.
    </p>
    <p>If the specified value of <code>math-script-level</code> is
      <code>auto</code> and the inherited value of <code>math-style</code> is
      <code>inline</code> then the computed value of
      <code>math-script-level</code> is the inherited value plus one.
    </p>
    <p>
      If the specified value of <code>math-script-level</code> is of the form
      <code>add(&lt;integer&gt;)</code> then the computed value of
      <code>math-script-level</code> is the inherited value plus the specified
      integer.
    </p>
    <p>
      If the specified value of <code>math-script-level</code> is of the form
      <code>&lt;integer&gt;</code> then the computed value of
      <code>math-script-level</code> is set to the specified integer.
    </p>
    <p>
      If
      <a data-cite="CSS-FONTS-3#font-size-prop"><code>font-size</code></a>
      is specified or if the specified value of
      <code>math-script-level</code> is <code>initial</code> then
      <code>math-script-level</code> does not affect the computed value of
      <code>font-size</code>. Otherwise, the computed value of
      <code>font-size</code> is obtained by multiplying the inherited value of
      <code>font-size</code> by a nonzero scale factor calculated by the
      following procedure:
    </p>
    <ol>
      <li>Let A be the inherited <code>math-script-level</code>, B the computed
        <code>math-script-level</code>, C be 0.71 and S be 1.0</li>
      <li>
        <ul>
          <li>If A = B then return S.</li>
          <li>If B &lt; A, swap A and B and set <code>InvertScaleFactor</code> to true.</li>
          <li>Otherwise B &gt; A and set <code>InvertScaleFactor</code> to false.</li>
        </ul>
      </li>
      <li>Let E be B - A &gt; 0.</li>
      <li>If the inherited font has an OpenType MATH table:
        <ul>
          <li>Read <code class="MATH">scriptPercentScaleDown</code> and fallback to C if the MathVariants table is absent or provides a null value.</li>
          <li>Read <code class="MATH">scriptScriptPercentScaleDown</code> and fallback to C<sup>2</sup> if the MathVariants table is absent or provides a null value.</li>
          <li>If A ≤ 0 and B ≥ 2 then multiply S by <code class="MATH">scriptScriptPercentScaleDown</code> and
            decrement E by 2.</li>
          <li>Otherwise if A = 1 then multiply S by
            <code class="MATH">scriptScriptPercentScaleDown</code> / <code class="MATH">scriptPercentScaleDown</code> and
            decrement E by 1.</li>
          <li>Otherwise if B = 1 then multiply S by <code class="MATH">scriptPercentScaleDown</code>
            and decrement E by 1.</li>
        </ul>
      </li>
      <li>Multiply S by C<sup>E</sup></li>
      <li>Return S if <code>InvertScaleFactor</code> is false and 1/S otherwise.</li>
    </ol>
  </section>
</section>
</section>
<section class="appendix informative">
  <h2>RelaxNG</h2>
  <p>
    This section displays a non-normative Relax NG Schema which
    details the elements and attributes defined by this specification.
    Note that MathML does not need to be expressed in XML syntax, in
    particular the syntax defined by HTML may be used. However this
    schema may be taken as an informal specification of the structure,
    whatever syntax is used.
  </p>
  <pre data-include="mathml-core.rnc"></pre>
</section>
<section class="appendix">
  <h2>User Agent Stylesheet</h2>
<pre>@namespace url(http://www.w3.org/1998/Math/MathML);

/* Links */
<span data-include="user-agent-stylesheet/links.css"></span>
/* The &lt;math&gt; element */
<span data-include="user-agent-stylesheet/math.css"></span>
/* &lt;mrow&gt;-like elements */
<span data-include="user-agent-stylesheet/maction.css"></span><span data-include="user-agent-stylesheet/merror.css"></span><span data-include="user-agent-stylesheet/mphantom.css"></span>
/* Tables */
<span data-include="user-agent-stylesheet/tables.css"></span>
/* Other rules for scriptlevel and displastyle */
<span data-include="user-agent-stylesheet/mfrac.css"></span>
<span data-include="user-agent-stylesheet/mroot.css"></span>
<span data-include="user-agent-stylesheet/other.css"></span>
</pre>
</section>
<section>
  <h1>Operator Dictionary</h1>
  <p>
    The following table gives the suggested dictionary of rendering
    properties for operators, fences, separators, and accents in MathML, all of
    which are represented by <code>&lt;mo&gt;</code> elements. For brevity,
    all such elements will be called simply <q>operators</q> in this
    Appendix.
  </p>
  <section><h2>Indexing of the operator dictionary</h2>
    <p>
      Note that the dictionary is indexed not just by the element
      content, but by the element content and <code>form</code> attribute
      value, together. Operators with more than one possible form have more
      than one entry. The MathML specification describes how the renderer
      chooses (<q>infers</q>) which form to use when no <code>form</code>
      attribute is given; see <specref ref="presm_formdefval"/>.
    </p>
    <p>
      Having made that choice, or with the <code>form</code> attribute
      explicitly specified in the <code>&lt;mo&gt;</code> element's start
      tag, the MathML renderer uses the remaining attributes from the
      dictionary entry for the appropriate single form of that operator,
      ignoring the entries for the other possible forms.
    </p>
    <p>
      In the table below, all non-ASCII characters are represented by
      XML-style hexadecimal numeric character references.
      The choice of markup (character data, numeric character reference or named entity reference)
      for a given character in MathML has no effect on its rendering.
    </p>
  </section>
  <section><h2>Format of operator dictionary entries</h2>
    <p>
      Each row of the table is indexed as described above by the both the character
      (given by code point and Unicode Name) and the value of the form attribute.
      The fourth column gives the <kw>priority</kw> which as described in
      ??),
      is significant for the proper grouping of sub-expressions using <code>&lt;mrow&gt;</code>.
      The rule described
      there is especially relevant to the automatic generation of MathML by
      conversion from other formats for displayed mathematics, such as T<sub>E</sub>X,
      which do not always specify how sub-expressions nest.
    </p>
    <p>
      The length valued attributes such as <code>lspace</code> are given explicitly in the following columns.
      Boolean valued attributes such as <code>stretchy</code> are specified together in the final <kw>Properties</kw>
      column by listing the attribute name if its value should be set to <kw>true</kw> by the dictionary.
      Finally some rarely used non-boolean properties are shown in the Properties column together with a value,
      for example <code>linebreakstyle</code>=after.
    </p>
    <p>
      Any attribute not listed for some entry has its default value,
      which is given in parentheses in the table of attributes in
      ??.
    </p>
    <table>
      <tbody>
        <tr>
          <th>(</th>
          <th>(</th>
          <th role="uname">left parenthesis</th>
          <th>prefix</th>
          <td>1</td>
          <td>0</td>
          <td>0</td>
          <td/>
          <td>fence<phrase>,</phrase> stretchy</td>
        </tr>
      </tbody>
    </table>
    <p>
      could be expressed as an <code>&lt;mo&gt;</code> element by:
      <pre>&lt;mo form="prefix" fence="true" stretchy="true" lspace="0em" rspace="0em"&gt; ( &lt;/mo&gt;</pre>
      (note the whitespace added around the content for readability;
      Such whitespace will be ignored by a MathML system,
      as described in <specref ref="fund_collapse" />.
    </p>
    <p>
      This entry means that, for MathML renderers which use this
      suggested operator dictionary, giving the element
      <code>&lt;mo form="prefix"> ( &lt;/mo></code>
      alone, or simply
      <code>&lt;mo> ( &lt;/mo></code>
      in a position for which
      <code>form="prefix"</code>
      would be inferred (see below), is equivalent to giving the element
      with all attributes as shown above.
    </p>
    <p>
      In some versions of this specification,
      the rows of the table may be reordered by clicking on a h2ing in the top row,
      to cause the table to be ordered by that column.
    </p>
  </section>
  <section><h2>Notes on <code>lspace</code> and
      <code>rspace</code> attributes</h2>
    <p>
      The values for <code>lspace</code> and <code>rspace</code> given here range from 0 to 7,
      they are given numerically in order to save space in the table,
      the values should be taken as referring to the named mathematical spaces, as follows.
    </p>
    <table>
      <thead>
        <tr><td>Table Entry</td><td>Named Space</td><td>Default Length</td></tr>
      </thead>
      <tbody>
        <tr><td>0</td><td/><td>0 em</td></tr>
        <tr>
          <td>1</td>
          <td>veryverythinmathspace</td>
          <td>1/18 em</td>
        </tr>
        <tr>
          <td>2</td>
          <td>verythinmathspace</td>
          <td>2/18 em</td>
        </tr>
        <tr>
          <td>3</td>
          <td>thinmathspace</td>
          <td>3/18 em</td>
        </tr>
        <tr>
          <td>4</td>
          <td>mediummathspace</td>
          <td>4/18 em</td>
        </tr>
        <tr>
          <td>5</td>
          <td>thickmathspace</td>
          <td>5/18 em</td>
        </tr>
        <tr>
          <td>6</td>
          <td>verythickmathspace</td>
          <td>6/18 em</td>
        </tr>
        <tr>
          <td>7</td>
          <td>veryverythickmathspace</td>
          <td>7/18 em</td>
        </tr>
      </tbody>
    </table>
    <p>
      For the invisible operators whose content is <code>&amp;InvisibleTimes;</code>
      or <code>&amp;ApplyFunction;</code>,
      it is suggested that MathML renderers choose spacing in a context-sensitive
      way (which is an exception to the static values given in the following
      table). For <code>&lt;mo>&amp;ApplyFunction;&lt;/mo></code>, the total
      spacing (<attval>lspace</attval>+<attval>rspace</attval>) in
      expressions such as <q>sin <i>x</i></q> (where the right operand
      doesn't start with a fence) should be greater than zero; for
      <code>&lt;mo>&amp;InvisibleTimes;&lt;/mo></code>, the total spacing
      should be greater than zero when both operands (or the nearest tokens on
      either side, if on the baseline) are identifiers displayed in a non-slanted
      font (i.e.. under the suggested rules, when both operands are
      multi-character identifiers).
    </p>
  </section>
  <section>
    <h3>Operator dictionary entries</h3>
    <div data-include="tables/operator-dictionary.html"></div>
  </section>
</section>
<section>
  <h2>MathML Combining Character Equivalences</h2>
  <p>
    The following table gives mappings between spacing and non spacing
    characters when used in MathML accent constructs.
  </p>
  <div data-include="tables/combining-operators.html"></div>
</section>
<section>
  <h3>Mathvariant Mappings</h3>
  <div data-include="tables/mathvariants.html"></div>
</section>
<section class="appendix">
  <h2>Conformance</h2>
  <section>
    <h3>Document conventions</h3>
    <p>
      Conformance requirements are expressed with a combination of
      descriptive assertions and RFC 2119 terminology. The key words “MUST”,
      “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
      “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
      document are to be interpreted as described in RFC 2119.
      However, for readability, these words do not appear in all uppercase
      letters in this specification.
    </p>
    <p>
      All of the text of this specification is normative except sections
      explicitly marked as non-normative, examples, and notes.
      [[RFC2119]].
    </p>
    <p>
      Examples in this specification are introduced with the words
      “for example” or are set apart from the normative text with
      <code>class="example"</code>, like this:
    </p>
    <div class="example">
      <p>
        This is an example of an informative example.
      </p>
    </div>
    <p>
      Informative notes begin with the word “Note” and are set apart from
      the normative text with <code>class="note"</code>, like this:
    </p>
    <p class="note">
      Note, this is an informative note.
    </p>
    <p>
      Advisements are normative sections styled to evoke special attention
      and are set apart from other normative text with
      <code>&lt;strong class="advisement"&gt;</code>, like this:
      <strong class="advisement">UAs MUST provide an accessible alternative. </strong>
    </p>
    <p>
      Definitions taken the MATH specification of [[OPEN-FONT-FORMAT]]
      are written with the following style:
      <code class="MATH">MyMathTableParameter</code>.
    </p>
  </section>
</section>
</body>
</html>
