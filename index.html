<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>MathML Core</title>
    <link rel="stylesheet" href="style.css" type="text/css"/>
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common"
            class="remove"></script>
    <script src="tables/sorttable.js"></script>
    <script class="remove">
      var respecConfig = {
          specStatus: "ED",
          editors: [{
              name: "David Carlisle",
              url: "https://davidcarlisle.github.io/dcarlisle/david/",
              company: "NAG"
          }, {
              name: "Frédéric Wang",
              url: "http://frederic-wang.fr",
              company: "Igalia"
          }],
          wg: "MathML Refresh Community Group",
          wgURI: "https://www.w3.org/community/mathml4/",
          edDraftURI: "https://mathml-refresh.github.io/mathml-core/",
          shortName: "mathml-core",
          testSuiteURI: "https://w3c-test.org/mathml/",
          issueBase: "https://github.com/mathml-refresh/mathml/issues/",
          implementationReportURI: "https://build-chromium.igalia.com/mathml/wpt/summary.html",
          otherLinks: [{
              key: "Participate",
              data: [{
                  value: 'MathML Refresh CG',
                  href: 'https://www.w3.org/community/mathml4/'
              }, {
                  value: 'GitHub mathml-refresh/mathml',
                  href: 'https://github.com/mathml-refresh/mathml/'
              }, {
                  value: 'GitHub mathml-refresh/mathml-core',
                  href: 'https://github.com/mathml-refresh/mathml-core/'
              }, {
                  value: 'File a bug',
                  href: 'https://github.com/mathml-refresh/mathml/issues'
              }, {
                  value: 'Commit History',
                  href: 'https://github.com/mathml-refresh/mathml-core/commits/gh-pages'
              }, {
                  value: 'Pull requests',
                  href: 'https://github.com/mathml-refresh/mathml-core/pulls/'
              }]
          }],
          localBiblio: {
              "MATHML4": {
                  title: "Mathematical Markup Language (MathML) Version 4.0",
                  authors: [
                      "David Carlisle et al."
                  ],
                  status: "WD",
                  href: "https://mathml-refresh.github.io/mathml/"
              },
              "TEXBOOK": {
                  title: "The TeXBook",
                  date: "1984",
                  authors: [
                      "Knuth, Donald E."
                  ],
                  publisher: "Addison-Wesley Professional",
                  id: "ISBN9780201134483"
              },
              "OPEN-TYPE-MATH-ILLUMINATED": {
                  title: "OpenType Math Illuminated",
                  date: "2009",
                  authors: [
                      "Ulrik Vieth"
                  ],
                  href: "http://www.tug.org/TUGboat/tb30-1/tb94vieth.pdf",
              },
              "VALIDATOR-SCHEMAS": {
                  title: "HTML5-SVG-MathML schema for Nu Html Checker",
                  authors: [
                      "Henri Sivonen et al."
                  ],
                  href: "https://github.com/validator/validator/blob/master/schema/.drivers/html5-svg-mathml.rnc"
              }
          },
          postProcess: [sorttable.init]
      };
    </script>
  </head>
  <body>
    <section id="abstract">
      <p>
        This specification defines a core subset of Mathematical Markup
        Language, or MathML, that is suitable for browser implementation.
        MathML is a markup language for describing mathematical notation
        and capturing both its structure and content. The goal of MathML is to
        enable mathematics to be served, received, and processed on the World
        Wide Web, just as HTML has enabled this functionality for text.
      </p>
    </section>
    <section id="sotd">
      <p>
        This is a public copy of the editors’ draft. It is provided for
        discussion only and may change at any moment. Its publication here does
        not imply endorsement of its contents by W3C. Don’t cite this document
        other than as work in progress.
      </p>
    </section>
    <section class="informative">
      <h2>Introduction</h2>
      <p>
        The [[MATHML3]] specification has several shortcomings that make it
        hard to implement consistently across web rendering engines or to
        extend with user-defined constructions e.g.
      </p>
      <ul>
        <li>It is a huge and standalone specification.</li>
        <li>It does not contain any detailed rendering rules.</li>
        <li>It is not driven by browser-implementation.</li>
        <li>It lacks automated testing.</li>
      </ul>
      <p>
        This MathML Core specification intends to address these issues by
        being as accurate as possible on the visual rendering of mathematical
        formulas using additional rules from the TeXBook’s Appendix G
        [[?TEXBOOK]] and from the Open Font Format [[OPEN-FONT-FORMAT]],
        [[OPEN-TYPE-MATH-ILLUMINATED]]. It also relies on modern browser
        implementations and web technologies [[HTML]] clarifying interactions
        with them when needed or introducing new low-level primitives to
        improve the web platform layering. Parts of MathML 3 that do not
        fit well in this framework or are rarely used in practice have been
        omitted. Instead, they are described in a separate and larger
        [[MATHML4]] specification.
      </p>
      <p>
        By increasing the level of implementation details, focusing on a
        workable subset, following a browser-driven design and relying on
        automated web platform tests, this specification is expected to
        greatly improve MathML interoperability. Moreover, effort on MathML
        layering will enable users to implement the rest of the MathML 4
        specification, or more generally to extend MathML Core, using
        polyfills or converters.
      </p>
    </section>
    <section class="normative">
      <h2>MathML Fundamentals</h2>
      <section>
        <h3>Integration in the Web Platform</h3>
        <section>
          <h4>HTML and SVG</h4>
          <p>
            When
            <a data-cite="HTML#parsing">parsing HTML documents</a>
            user agents must treat any of the following
            <dfn>MathML Core elements</dfn> as belonging to the
            <a data-cite="INFRA#mathml-namespace">MathML namespace</a>:
          </p>
          <ul>
            <li><a>&lt;annotation&gt;</a></li>
            <li><a>&lt;annotation-xml&gt;</a></li>
            <li><a>&lt;maction&gt;</a></li>
            <li><a>&lt;math&gt;</a></li>
            <li><a>&lt;menclose&gt;</a></li>
            <li><a>&lt;merror&gt;</a></li>
            <li><a>&lt;mfrac&gt;</a></li>
            <li><a>&lt;mi&gt;</a></li>
            <li><a>&lt;mmultiscripts&gt;</a></li>
            <li><a>&lt;mn&gt;</a></li>
            <li><a>&lt;mo&gt;</a></li>
            <li><a>&lt;mover&gt;</a></li>
            <li><a>&lt;mpadded&gt;</a></li>
            <li><a>&lt;mphantom&gt;</a></li>
            <li><a>&lt;mprescripts&gt;</a></li>
            <li><a>&lt;mroot&gt;</a></li>
            <li><a>&lt;mrow&gt;</a></li>
            <li><a>&lt;ms&gt;</a></li>
            <li><a>&lt;mspace&gt;</a></li>
            <li><a>&lt;msqrt&gt;</a></li>
            <li><a>&lt;mstyle&gt;</a></li>
            <li><a>&lt;msub&gt;</a></li>
            <li><a>&lt;msubsup&gt;</a></li>
            <li><a>&lt;msup&gt;</a></li>
            <li><a>&lt;mtable&gt;</a></li>
            <li><a>&lt;mtd&gt;</a></li>
            <li><a>&lt;mtext&gt;</a></li>
            <li><a>&lt;mtr&gt;</a></li>
            <li><a>&lt;munder&gt;</a></li>
            <li><a>&lt;munderover&gt;</a></li>
            <li><a>&lt;none&gt;</a></li>
            <li><a>&lt;semantics&gt;</a></li>
          </ul>
          <p>
            Users agents must allow mixing HTML, SVG and MathML elements
            as allowed by sections
            <a data-cite="HTML#html-integration-point">HTML integration point</a>,
            <a data-cite="HTML#mathml-text-integration-point">MathML integration point</a>,
            <a data-cite="HTML#tree-construction-dispatcher">tree construction
              dispatcher</a>,
            <a data-cite="HTML#mathml">MathML</a> and
            <a data-cite="HTML#svg-0">SVG</a>
            from [[HTML]].
          </p>
          <p>
            When evaluating the SVG
            <a data-cite="SVG#RequiredExtensionsAttribute"><code>requiredExtensions</code></a>
            attribute, user agents must claim support for the language extension
            identified by the
            <a data-cite="INFRA#mathml-namespace">MathML namespace</a>.
          </p>
          <div class="note">
            <ul>
              <li>
                The <code>&lt;math&gt;</code> element can be used at
                position permitted for
                <a data-cite="HTML#flow-content-2">flow content</a>
                (e.g. a
                <a data-cite="SVG#ForeignObjectElement"><code>&lt;foreignObject&gt;</code></a> element)
                or <a data-cite="HTML#phrasing-content-2">phrasing content</a>.
              </li>
              <li>
                Any
                <a data-cite="HTML#phrasing-content-2">phrasing content</a>
                can be used inside
                <a><code>&lt;mi&gt;</code></a>,
                <a><code>&lt;mo&gt;</code></a>,
                <a><code>&lt;mn&gt;</code></a>,
                <a><code>&lt;ms&gt;</code></a> and
                <a><code>&lt;mtext&gt;</code></a>
                elements.
              </li>
              <li>
                The <code>&lt;svg&gt;</code> element can be used inside
                <a><code>&lt;annotation-xml&gt;</code></a> elements.
              </li>
              <li>
                Any <a data-cite="HTML#flow-content-2">flow content</a>
                can be used inside
                <a><code>&lt;annotation-xml&gt;</code></a> elements with
                encoding
                <code>application/xhtml+xml</code> or <code>text/html</code>.
              </li>
            </ul>
          </div>
        </section>
        <section>
          <h4>CSS styling</h4>
          <p>User agents must support various CSS features mentioned in this
            specification, including new ones described in
            <a href="#css-extensions-for-math-layout"></a>.</p>
          <p>
            All documents containing <a>MathML Core elements</a> must include
            CSS rules described in <a href="#user-agent-stylesheet"></a>
            as part of user-agent level style sheet defaults.
            Rules relying on universal selectors such as
            <code>mfrac > *</code> or <code>msub > :not(:first-child)</code> may
            be replaced with equivalent expanded rules listing all possible
            <a>MathML Core elements</a>.
          </p>
        </section>
        <section>
          <h4>DOM and Javascript</h4>
          <p>
            User agents supporting
            <a data-cite="HTML#webappapis">Web application APIs</a>
            must ensure that they keep the visual rendering of MathML
            in synchronization with the [[DOM]] tree.
          </p>
          <div class="issue" data-number="83">Properly define DOM/IDL relationships.</div>
          <p>
            All the nodes representing <a>MathML Core elements</a> in the DOM
            must and expose to scripts, the following
            <dfn><code>MathMLElement</code></dfn> interface.
          </p>
          <pre class="idl" data-include="webidl/MathMLElement.idl"></pre>
          <p>The
            <dfn data-cite="HTML#globaleventhandlers"><code>GlobalEventHandlers</code></dfn>,
            <dfn data-cite="HTML#documentandelementeventhandlers"><code>DocumentAndElementEventHandlers</code></dfn> and
            <dfn data-cite="HTML#htmlorsvgelement"><code>HTMLOrSVGElement</code></dfn> interfaces are defined in
            [[HTML]].</p>
          <p>The
            <dfn data-cite="CSSOM#elementcssinlinestyle"><code>ElementCSSInlineStyle</code></dfn>
            interface is defined in [[CSSOM]].
          </p>
        </section>
      </section>
      <section>
        <h3>Types for MathML Attribute Values</h3>
        <dl>
          <dt><dfn>unsigned-integer</dfn></dt>
          <dd>An
            <a data-cite="CSS-VALUES-3#integer-value"><code>&lt;integer-value&gt;</code></a> value as defined in
            [[CSS-VALUES-3]], whose first character is neither
            U+002D HYPHEN-MINUS character (-) nor
            U+002B PLUS SIGN (+).
          </dd>
        </dl>
        <dl>
          <dt><dfn>unsigned-number</dfn></dt>
          <dd>A
            <a data-cite="CSS-VALUES-3#number-value"><code>&lt;number-value&gt;</code></a> value as defined in
            [[CSS-VALUES-3]], whose first character is neither
            U+002D HYPHEN-MINUS character (-) nor
            U+002B PLUS SIGN (+).
          </dd>
        </dl>
        <dl>
          <dt><dfn>length-percentage</dfn></dt>
          <dd>A
            <a data-cite="CSS-VALUES-3#typedef-length-percentage"><code>&lt;length-percentage&gt;</code></a>
            value as defined in
            [[CSS-VALUES-3]]
          </dd>
        </dl>
        <dl>
          <dt><dfn>unsigned-length-percentage</dfn></dt>
          <dd>A
            <a><code>length-percentage</code></a>
            whose first character is neither
            U+002D HYPHEN-MINUS character (-) nor
            U+002B PLUS SIGN (+).
          </dd>
        </dl>
        <dl>
          <dt><dfn>color</dfn></dt>
          <dd>A
            <a data-cite="CSS-COLOR-3#colorunits"><code>&lt;color&gt;</code></a>
            value as defined in [[CSS-COLOR-3]]
          </dd>
        </dl>
        <dl>
          <dt><dfn>boolean</dfn></dt>
          <dd>A string that is case-insensitively equal to <code>true</code> or
            <code>false</code>.
          </dd>
        </dl>
      </section>
      <section>
        <h3>Global Attributes</h3>
        <p>
          The following attributes are common to and may be specified on all MathML
          elements:
        </p>
        <ul>
          <li><a>id</a></li>
          <li><a>class</a></li>
          <li><a><code>style</code></a></li>
          <li><a><code>href</code></a></li>
          <li><a><code>dir</code></a></li>
          <li><a><code>mathbackground</code></a></li>
          <li><a><code>mathcolor</code></a></li>
          <li><a><code>mathsize</code></a></li>
          <li><a><code>mathvariant</code></a></li>
          <li><a><code>displaystyle</code></a></li>
          <li><a><code>scriptlevel</code></a></li>
        </ul>
        <section>
          <h4>Attributes common to HTML and MathML elements</h4>
          <p>
            The
            <dfn><code>id</code></dfn>,
            <dfn><code>class</code></dfn>,
            <dfn><code>style</code></dfn>,
            attributes have the same syntax and semantic as defined for
            <a data-cite="HTML#the-id-attribute">id</a>,
            <a data-cite="HTML#classes">class</a> and
            <a data-cite="HTML#the-style-attribute">style</a> attributes on
            HTML elements.
          </p>
          <p>
            The
            <dfn><code>href</code></dfn>
            attribute has the syntax and semantic as defined for
            the <a data-cite="HTML#attr-hyperlink-href">href</a> attribute on
            <code>&lt;a&gt;</code> element.
            To fully implement this attribute, the following CSS properties for
            links must be specified in the
            <a href="#user-agent-stylesheet">user agent stylesheet</a>:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/links.css"></pre>
          <p>
            The
            <dfn><code>dir</code></dfn>
            attribute, if present,
            must be case-insensitively equal to the
            value <code>ltr</code> or <code>ltr</code>.
            It is mapped to the
            <a data-cite="CSS-WRITING-MODES-3#direction"><code>direction</code></a>
            CSS property.
            This attribute is used to set the directionality of math formulas, which is
            often <code>rtl</code> in Arabic speaking world.
          </p>
        </section>
        <section>
          <h4>Legacy MathML Style Attributes</h4>
          <p>
            The
            <dfn><code>mathcolor</code></dfn>
            and
            <dfn><code>mathbackground</code></dfn>
            attributes, if present, must
            have a value that is a <a>color</a>.
            The <code>mathcolor</code> property describes the foreground fill color of
            an MathML text, bars etc and the background color of an element.
            They are mapped to the
            <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a> and
            <a data-cite="CSS-BACKGROUNDS-3#the-background-color"><code>background-color</code></a> CSS properties.
          </p>
          <p>
            The
            <dfn><code>mathsize</code></dfn>
            attribute, if present, must
            have a value that is a valid <a>length-percentage</a>.
            The <code>mathsize</code> property indicates indicates the desired height
            of glyphs in math formulas but also scale other parts (spacing, shifts,
            line thickness of bars etc) accordingly.
            Is is mapped to the CSS property
            <a data-cite="CSS-FONTS-3#font-size-prop"><code>font-size</code></a>
            and the <code>mathsize</code> values are interpreted according to the
            definition in [[CSS-FONTS-3]].
          </p>
          <div class="note">
            While the above attributes are preserved for backward compatibility reasons
            with legacy documents and existing tools, modern authors and tools are strongly
            encouraged to use CSS for styling.
          </div>
        </section>
        <section>
          <h4>The <code>mathvariant</code> attribute</h4>
          <p>
            The
            <dfn><code>mathvariant</code></dfn>
            attribute,
            if present, must have a value that is case-insensitively equal to
            one of
            <code>normal</code>,
            <code>bold</code>,
            <code>italic</code>,
            <code>bold-italic</code>,
            <code>double-struck</code>,
            <code>bold-fraktur</code>,
            <code>script</code>,
            <code>bold-script</code>,
            <code>fraktur</code>,
            <code>sans-serif</code>,
            <code>bold-sans-serif</code>,
            <code>sans-serif-italic</code>,
            <code>sans-serif-bold-italic</code>,
            <code>monospace</code>,
            <code>initial</code>,
            <code>tailed</code>,
            <code>looped</code>,
            <code>stretched</code>.
          </p>
          <p>
            The <code>mathvariant</code> attribute defines logical classes of token
            elements. Each class provides a collection of typographically-related
            symbolic tokens with specific meaning within a given mathematical
            expression.
            For <code>mathvariant</code> values other than <code>normal</code>,
            this is done by using glyphs of
            Unicode's Mathematical Alphanumeric Symbols.
          </p>
          <p>
            Hence, the <code>mathvariant</code> attribute
            is mapped to new values of the CSS property
            <a><code>text-transform</code></a>.
            More precisely, <code>normal</code> is mapped to <code>none</code>
            while all the other values the corresponding CSS value with the extra
            <code>math-</code> prefix.
          </p>
          <div class="note">
            While <code>mathvariant</code> values other than <code>normal</code>
            are preserved for backward compatibility reasons with legacy
            documents and existing tools, modern authors and tools are strongly
            encouraged to just use the corresponding Unicode characters.
            The <code>normal</code> value is still important to cancel automatic
            italic of the <a><code>&lt;mi&gt;</code></a> element.
          </div>
          <div class="issue" data-number="61">
            Consider a new script style to distinguish Chancery and Spencerian?
          </div>
          <div class="note">
            Unicode does not distinguish between Chancery and Spencerian style
            for the Unicode MATHEMATICAL SCRIPT characters. However, some
            mathematical fonts rely on <code class="MATH">salt</code> or
            <code>ssXY</code> properties from [[OPEN-FONT-FORMAT]]
            to provide both styles. Page authors may use the
            <a data-cite="CSS-FONTS-4#font-variant-alternates-prop"><code>font-variant-alternates</code></a> property with corresponding OpenType font features
            to access these glyphs.
          </div>
        </section>
        <section>
          <h4>The <code>displaystyle</code> and <code>scriptlevel</code> attributes</h4>
          <p>
            The
            <dfn><code>displaystyle</code></dfn>
            attribute, if present, must be a <a>boolean</a>.
            It is mapped to the CSS property <a><code>math-style</code></a>.
            More precisely,  <code>true</code> is mapped to <code>display</code> and
            <code>false</code> to  <code>inline</code>.
            This attribute indicate whether formulas should try to minimize
            the logical height (value is <code>false</code>) or not
            (value is <code>true</code>) e.g. by changing the size of content or
            the layout of scripts.
          </p>
          <p>
            The
            <dfn><code>scriptlevel</code></dfn>
            attribute, if present, must have value
            <code>+&lt;U&gt;</code>, <code>-&lt;U&gt;</code> or <code>&lt;U&gt;</code>
            where <code>&lt;U&gt;</code> is an
            <a>unsigned-integer</a>.
            It is mapped to the <a><code>math-script-level</code></a>.
            More precisely,
            <code>+&lt;U&gt;</code>, <code>-&lt;U&gt;</code> and
            <code>&lt;U&gt;</code>
            are respectively mapped to
            <code>add(&lt;U&gt;)</code>
            <code>add(&lt;-U&gt;)</code>
            and <code>&lt;U&gt;</code>.
          </p>
          <p>
            <code>displaystyle</code> and <code>scriptlevel</code> values
            are automatically adjusted within MathML elements.
            To fully implement these attributes, additional CSS properties must be
            specified in the user agent stylesheet
            as described in <a href="#user-agent-stylesheet"></a>.
          </p>
          <div class="note">
            T<sub>E</sub>X's <code>\displaystyle</code>, <code>\textstyle</code>,
            <code>\scriptstyle</code>, and <code>\scriptscriptstyle</code> correspond
            to <code>displaystyle</code> and <code>scriptlevel</code> as
            <code>true</code> and <code>0</code>,
            <code>false</code> and <code>0</code>,
            <code>false</code> and <code>1</code>,
            and <code>false</code> and 2, respectively.
          </div>
          <div class="issue">
            Do we actually need these rules?
            What about <code>scriptlevel</code>?
            <pre class="css" data-include="user-agent-stylesheet/displaystyle.css"></pre>
          </div>
        </section>
      </section>
      <section>
        <h3>The Top-Level <code>&lt;math&gt;</code> Element</h3>
        <p>MathML specifies a single top-level or root
          <dfn><code>&lt;math&gt;</code></dfn> element, which encapsulates each
          instance of MathML markup within a document. All other MathML content
          must be contained in a <code>&lt;math&gt;</code> element.
        </p>
        <p>
          The <code>&lt;math&gt;</code>
          element accepts the attributes described
          in <a href="#global-attributes"></a> as well as the
          following attribute:
        </p>
        <ul>
          <li><a>display</a></li>
        </ul>
        <p>
          The
          <dfn><code>display</code></dfn>
          attribute, if present,
          must have value <code>block</code> or <code>inline</code>.
          To fully implement this attribute, additional CSS properties must be
          specified in the user agent stylesheet
          as described in <a href="#user-agent-stylesheet"></a>.
        </p>
        <p>
          The layout algorithm of the <code>&lt;math&gt;</code> element
          is the same as the <code>&lt;mrow&gt;</code> element. User agents must
          ensure correct baseline alignment, centering, sizing etc of the
          <code>&lt;math&gt;</code> element.
        </p>
        <div class="note">
          T<sub>E</sub>X's display mode <code>$...$</code>
          and inline mode <code>$...$</code> correspond to
          <code>display="block"</code> and <code>display="inline"</code>
          respectively.
        </div>
      </section>
    </section>
    <section class="normative">
      <h2>Presentation Markup</h2>
      <section>
        <h3>Introduction</h3>
        <section>
          <h4>Box Model</h4>
          <div class="issue" data-number="15">Interoperable handling of invalid markup</div>
          <p>
            User agents must also follow the rules described in section 4.7.14
            Embedded content, MathML of [[HTML]], in particular the equivalence with
            implicit <code>&lt;mtext&gt;</code> and <code>&lt;merror&gt;</code> to handle non-conforming MathML markup.
          </p>
          <p>
            MathML elements have the following box model. The <code>&lt;math&gt;</code> root may have
            inline or block display, as suggested in
            <a href="#user-agent-stylesheet"></a>.
            Tabular MathML elements have table, table-row and
            table-cell display as discussed in
            <a href="#tabular-math"></a>.
            The <code>&lt;math&gt;</code> and <code>&lt;mtd&gt;</code> elements
            generate an anonymous <code>&lt;mrow&gt;</code> MathML box child that contains the boxes of
            their children and use the box parameters below to layout this anonymous
            <code>&lt;mrow&gt;</code> box.
            No line breaking can happen within MathML boxes and the min-content width is
            equal to the max-content width, these are simply called the intrinsic width.
            Each MathML box has the following parameters:
          </p>
          <ol>
            <li>intrinsic width W.</li>
            <li>logical width w, ascent above the origin a and descent below the origin b. The height is then a + b.</li>
            <li>ink ascent A and descent B, corresponding to the exact box enclosing ink of text and bars within the MathML box.</li>
          </ol>
          <figure id="box-model-generic">
            <img src="figures/boxmodel.svg"/>
            <figcaption>Generic Box Model for MathML elements</figcaption>
          </figure>
          <p>
            For a MathML element containing only text nodes or foreign elements,
            the content is simple enough to determine these values. For example,
            in most cases, this is just a single text node and w = W.
            A MathML element containing only other MathML elements follows special rules to
            layout their children at position
            (x<sub>i</sub>, y<sub>i</sub>) with parameters
            W<sub>i</sub>, w<sub>i</sub>, a<sub>i</sub>, b<sub>i</sub>, A<sub>i</sub>,
            B<sub>i</sub>. Then, as a general rule, its box parameters are given
            by taking the union of child boxes, that is:
          </p>
          <p>
            w = max<sub>1 ≤ i ≤ n</sub> (x<sub>i</sub> + w<sub>i</sub>) −
            max<sub>1 ≤ i ≤ n</sub> x<sub>i</sub>
          </p>
          <p>
            W = max<sub>1 ≤ i ≤ n</sub> (x<sub>i</sub> + W<sub>i</sub>) −
            max<sub>1 ≤ i ≤ n</sub> x<sub>i</sub>
          </p>
          <p>
            a = max<sub>1 ≤ i ≤ n</sub> (a<sub>i</sub> − y<sub>i</sub>)
          </p>
          <p>
            b = max<sub>1 ≤ i ≤ n</sub> (b<sub>i</sub> + y<sub>i</sub>)
          </p>
          <p>
            A = max<sub>1 ≤ i ≤ n</sub> (A<sub>i</sub> − y<sub>i</sub>)
          </p>
          <p>
            B = max<sub>1 ≤ i ≤ n</sub> (B<sub>i</sub> + y<sub>i</sub>)
          </p>
          <p>
            Note that the schemas in this document are drawn assuming left-to-right
            directionality. If the CSS <code>direction</code> is set to right-to-left, then the
            elements should layout by making the x-axis pointing from right-to-left.
            This document uses the terminology of
            [[MATHML3]]: “leading”
            means “left” in right-to-left and “right” in right-to-left mode, while
            “trailing” means “right” in right-to-left and “left” in right-to-left
            mode.
          </p>
          <p>
            The <code class="MATH">MathItalicsCorrectionInfo</code> table contains the italic
            correction of some glyphs, which provides a measure of how slanted the
            glyphs are (see <a href="#figure-italic-correction"></a>). The
            <code class="MATH">MathTopAccentAttachment</code> table also contains a reference
            points that are used for the horizontal positioning of glyphs as an accent
            (see <a href="#figure-top-accent-attachment"></a>). In later sections, this is
            generalized by claiming that all MathML boxes have <dfn>italic correction</dfn>
            and <dfn>top accent attachment</dfn> values. The values for glyphs are used to try and
            extend to token elements or to special boxes that do not change child metrics.
            Otherwise fallback values are used: 0 for italic correction and half
            the width of the box for top accent attachment.
          </p>
          <figure id="figure-italic-correction">
            <img src="figures/italcorr.svg"/>
            <figcaption>Examples of italic correction for italic f and large integral</figcaption>
          </figure>
          <figure id="figure-top-accent-attachment">
            <img src="figures/topaccent.svg"/>
            <figcaption>Example of top accent attachment for a circumflex accent</figcaption>
          </figure>
          <p>
            The present document assumes that W, w, a, b, A, B, italic correction
            and top accent attachment are nonnegative values. If computations result
            in negative values, then they must be interpreted as being zero.
            Note that some MathML elements such as <code>&lt;mspace&gt;</code> or <code>&lt;mpadded&gt;</code> may set box
            dimensions to negative values.
          </p>
        </section>
        <section>
          <h4>Layout Steps</h4>
          <p>
            For compatibility with HTML5 rendering, the MathML layout is performed in two
            independent steps:
          </p>
          <ol>
            <li>First, determine the intrinsic width W of MathML boxes following the description
              given in this document for each MathML box. This relies on vertical positions x as
              well as values for italic correction and top accent attachment, ignoring any vertical
              positioning or metrics.
            <li>
              Next, the final layout of MathML boxes is performed following
              the description given in this document, obtaining all the box metrics,
              including the actual width w, vertical metrics a, b, A, B and
              vertical positions y.
            </li>
          </ol>
          <p>
            In order to perform the first step independently of the second one, the
            horizontal metrics must not depend on the vertical metrics.
            As described in
            <a href="#adjust-space-around-content-mpadded"></a>,
            this adds some restrictions on the possible pseudo-units
            of the <code>&lt;mpadded&gt;</code> element. As indicated in
            <a href="#operator-fence-separator-or-accent-mo"></a>,
            the width of size variants or of the glyph assembly used for vertical stretchy
            operators may depend on the target size to cover. Taking the maximum widths
            for all these size variants or for the glyph assembly during the first step
            makes the intrinsic width independent of the target size but may lead to a
            small over-estimation.
          </p>
          <p>
            Each of these steps is done recursively: the metrics of a given MathML box
            are determined from those of the child boxes. User agents must implement
            the “Exception for embellished operators” described in [[MATHML3]].
            This means that the actual stretching of operators described in
            <a href="#operator-fence-separator-or-accent-mo"></a>
            may be “delayed” until processing reaches the top of its embellished
            operator subtree. It then must apply the current operation again
            to this embellished operator (intrinsic width determination or layout).
            Fortunately, such embellished operator subtrees are not deep in practice.
          </p>
          <p>
            This document does not require support for operator stretching in table cells.
            The “delayed” stretching of all operators must then be performed when processing
            arrives at the anonymous <code>&lt;mrow&gt;</code> child of <code>&lt;math&gt;</code> and <code>&lt;mtd&gt;</code>
            elements.
            In this manner, the intrinsic width of this anonymous <code>&lt;mrow&gt;</code> is well-defined
            for the layout of <code>&lt;mtable&gt;</code> elements and of the containers of the
            <code>&lt;math&gt;</code> element. Similarly, the final layout of this anonymous
            <code>&lt;mrow&gt;</code> is already done when it is time to perform the one of its ancestors.
          </p>
        </section>
      </section>
      <section>
        <h3>Token Elements</h3>
        <section>
          <h4>Text layout</h4>
          <p data-tests="relations/text-and-math/use-typo-metrics-1.html">
            Because math fonts generally contain very tall glyphs such as big integrals,
            using typographic metrics is important to avoid excessive line spacing of text.
            This behavior is specified in math fonts using the USE_TYPO_METRICS flag from
            the OS/2 table
            [[OPEN-FONT-FORMAT]] and user agents must honor that flag.
          </p>
          <p>
            Mathematical formulas can be viewed as an extension of standard text layout
            and thus user agents must be able to perfom
            complex text layout using fonts under the Open Font Format
            [[OPEN-FONT-FORMAT]]. In particular, they must implement bidirectional
            rendering and shaping of Arabic scripts.
          </p>
          <p>
            Good mathematical rendering requires use of non-Unicode glyphs. Mathematical
            fonts may only provide these glyphs when the <code class="MATH">math</code>
            script tag is enabled, so user agents must ensure that the text within
            MathML token elements is rendered with that script tag.
            For bidirectional layout, Unicode defines character-level mirroring
            to transform a character into its mirrored form,
            for example U+0028 LEFT PARENTHESIS into U+0029 RIGHT PARENTHESIS.
            User agents must also support the OpenType font feature
            <code>rtlm</code> (Right-to-left mirrored forms)
            to allow glyph-level mirroring in cases where character-level is not enough
            [[OPEN-FONT-FORMAT]].
          </p>
        </section>
        <section>
          <h4>Identifier <code>&lt;mi&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mi&gt;</code></dfn>
            element represents a symbolic name or
            arbitrary text
            that should be rendered as an identifier. Identifiers can include
            variables, function names, and symbolic constants.
          </p>
          <p>
            The <code>&lt;mi&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>. Its layout algorithm is
            the same as the <a>&lt;mtext&gt;</a> element.
            The
            <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following property in order to implement automatic
            italic:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/mi.css"></pre>
        </section>
        <section>
          <h4>Number <code>&lt;mn&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mn&gt;</code></dfn>
            element represents a "numeric literal" or
            other data that should be rendered as a numeric literal. Generally
            speaking, a numeric literal is a sequence of digits, perhaps including a
            decimal point, representing an unsigned integer or real number.
          </p>
          <p>
            The <code>&lt;mn&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>. Its layout algorithm is
            the same as the
            <a><code>&lt;mtext&gt;</code></a> element.
          </p>
        </section>
        <section>
          <h4>Operator, Fence, Separator or Accent <code>&lt;mo&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mo&gt;</code></dfn>
            element represents an
            operator or anything that should be rendered as an operator. In general,
            the notational conventions for mathematical operators are quite
            complicated, and therefore MathML provides a relatively sophisticated
            mechanism for specifying the rendering behavior of an
            <code>&lt;mo&gt;</code> element. As a consequence, in MathML the list of
            things that should "render as an operator" includes a number of notations
            that are not mathematical operators in the ordinary sense. Besides
            ordinary operators with infix, prefix, or postfix forms, these include
            fence characters such as braces, parentheses, and "absolute value" bars;
            separators such as comma and semicolon; and mathematical accents such as
            a bar or tilde over a symbol. This chapter uses the term "operator" to refer to
            operators in this broad sense.
          </p>
          <p>
            The <code>&lt;mo&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attributes:
          </p>
          <ul>
            <li><code>form</code></li>
            <li><code>fence</code></li>
            <li><code>separator</code></li>
            <li><code>lspace</code></li>
            <li><code>rspace</code></li>
            <li><code>stretchy</code></li>
            <li><code>symmetric</code></li>
            <li><code>maxsize</code></li>
            <li><code>minsize</code></li>
            <li><code>largeop</code></li>
            <li><code>movablelimits</code></li>
            <li><code>accent</code></li>
          </ul>
          <p>
            Many properties of an <code>&lt;mo&gt;</code> element can be specified
            via attribute on that element. The default value of the <code>form</code>
            of an <code>&lt;mo&gt;</code> element is obtained as described in section
            “Default value of the form attribute” of
            [[MATHML3]]. From the
            <code>form</code> and the text content, other
            default values can be deduced from the operator dictionary or use the fallback values
            given in “Dictionary-based attributes” of
            [[MATHML3]].
          </p>
          <p>
            The leading space <code>lspace</code> and trailing space
            <code>rspace</code> must be added on each side of the
            <code>&lt;mo&gt;</code> element (or its outermost embellished ancestor).
          </p>
          <p>
            In most cases, the <code>&lt;mo&gt;</code> element is treated as an
            <a>&lt;mtext&gt;</a> element.
            However, when an <code>&lt;mo&gt;</code> element with a single character must be
            displayed as a large operator then use the
            <code class="MATH">MathVariants</code>
            table to try and find a glyph of height at least
            <code class="MATH">DisplayOperatorMinHeight</code>
            (<a href="#figure-sum-base-and-displastyle-sizes"></a>). If none is found, fallback to the
            largest one. Because this parameter does not always give
            the best size, user agents may also use the following heuristic: ensure
            that the large variant height is at least 2 times as large as the base
            height for integrals and √2 times as large as the base height for other
            operators.
          </p>
          <figure id="figure-sum-base-and-displastyle-sizes">
            <img src="figures/sumsize.svg"/>
            <figcaption>Base and displaystyle sizes of the summation symbol</figcaption>
          </figure>
          <p>
            When an <code>&lt;mo&gt;</code> element with a single character must be
            displayed as a horizontal or vertical operator then instead of displaying
            the normal character, use the <code class="MATH">MathVariants</code>
            table to try and find a glyph that has at least the desired size or an
            assembly from several glyphs to cover at least the desired size
            (<a href="#figure-base-variants-and-assembly"></a>). The rules for vertical stretching
            are a bit more complicated and are described in section
            “Vertical Stretching Rules” of
            [[MATHML3]].
            If the operator has property <code>symmetric="true"</code>, then it must be
            stretched symmetrically with respect to the math axis, which is given by
            the <code class="MATH">AxisHeight</code> value.
            <a href="#symmetric-and-non-symmetric-vertical-stretching"></a>
            compares the symmetric and non-symmetric stretching.
          </p>
          <p>
            The size variant or construction used for vertical stretchy operators
            will depend on the target size to cover. The intrinsic width W of the
            operator is calculated from the maximum of all possible widths
            for the base size, size variants and construction available for the given
            operator. In practice, for most math fonts and operators, the width
            of the operator is almost independent of the stretch size.
          </p>
          <figure id="figure-base-variants-and-assembly">
            <img src="figures/bracesize.svg"/>
            <figcaption>Base size, size variants and glyph assembly for the
              left brace</figcaption>
          </figure>
          <figure id="symmetric-and-non-symmetric-vertical-stretching">
            <img src="figures/vstretch.svg"/>
            <figcaption>Symmetric and non-symmetric stretching of vertical
              operators</figcaption>
          </figure>
          <p>
            See
            <a href="#horizontally-group-sub-expressions-mrow"></a>
            for details about how to treat
            “embellished ancestor”, and how decide when to display operators larger
            or when to stretch them vertically &amp; horizontally.
          </p>
        </section>
        <section>
          <h4>Text <code>&lt;mtext&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mtext&gt;</code></dfn>
            element is used to represent arbitrary text
            that should be rendered as itself. In general, the
            <code>&lt;mtext&gt;</code> element is intended to denote commentary text.
          </p>
          <p>
            The <code>&lt;mtext&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>.
          </p>
          <p>
            In most cases the <code>&lt;mtext&gt;</code> element contains some text
            that is laid out without line breaks using complex text layout. The ink ascent
            &amp; descent, logical ascent &amp; descent and
            advance width of the text frame are measured and these values used
            for the MathML box of the <code>&lt;mtext&gt;</code> element.
          </p>
          <p>
            If the trailing glyph of the text content has an entry in the
            <code class="MATH">MathItalicsCorrectionInfo</code> table then the specified
            value is used as the italic correction.
            User agents may subtract the advance width from the abscissa of the trailing
            ink edge as a heuristic value for the italic correction of the
            <code>&lt;mtext&gt;</code> element when it is not specified in the
            <code class="MATH">MathItalicsCorrectionInfo</code> table.
          </p>
          <p>
            If the text content is made of a single glyph and this glyph
            has an entry in the <code class="MATH">MathTopAccentAttachment</code> table
            then the specified value is used as the top accent attachment of the
            <code>&lt;mtext&gt;</code> element.
          </p>
          <p>
            If the CSS <code>direction</code> on the <code>&lt;mtext&gt;</code> element
            is set to right-to-left then user agents must enable the <code>rtlm</code>
            OpenType feature on text nodes unless it contradicts what the page author
            has specified with the <code>font-feature-settings</code> CSS property.
          </p>
          <div class="issue"  data-number="19">Add detailed rules for the ssty OpenType feature</div>
          <p>
            Some characters like primes already have script size by default and
            hence would be too small when used in a script position.
            To render such “prescripted” characters with the appropriate size,
            If a <code>&lt;mtext&gt;</code> has a positive
            <a><code>scriptlevel</code></a> value then user agents must enable
            the <code class="MATH">ssty</code> (Script Style) OpenType feature
            on its text nodes unless it contradicts what the page author has
            specified with the
            <a data-cite="CSS-FONTS-3#font-rend-desc"><code>font-feature-settings</code></a>
            CSS property.
          </p>
          <p>
            In the most general case, the <code>&lt;mtext&gt;</code> element may contain
            text with line breaks or arbitrary HTML5 phrasing elements. We assume that
            we can still determine logical dimensions and max-content width of the text
            content and use it for both the logical and ink values of the
            <code>&lt;mtext&gt;</code> element. The italic correction and
            top accent attachment are assigned the fallback values indicated in
            <a href="#operator-fence-separator-or-accent-mo"></a>.
          </p>
        </section>
        <section>
          <h4>Space <code>&lt;mspace&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mspace&gt;</code></dfn>
            empty element represents a blank space of any
            desired size, as set by its attributes.
          </p>
          <p>
            The <code>&lt;mspace&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attributes:
          </p>
          <ul>
            <li><a href="#attribute-mspace-width" class="internalDFN" data-link-type="dfn"><code>width</code></a></li>
            <li><a href="#attribute-mspace-width" class="internalDFN" data-link-type="dfn"><code>height</code></a></li>
            <li><a href="#attribute-mspace-width" class="internalDFN" data-link-type="dfn"><code>depth</code></a></li>
          </ul>
          <p>The
            <dfn id="attribute-mspace-width">mspace <code>width</code></dfn>,
            <dfn id="attribute-mspace-height">mspace <code>height</code></dfn>,
            <dfn id="attribute-mspace-depth">mspace <code>depth</code></dfn>, if present, must
            have a value that is a valid <a>length-percentage</a>.
            These indicate the requested width, ascent and descent of the blank space.
            An unspecified attribute, a percentage  value, or an invalid value is
            interpreted as <code>0</code>.
          </p>
          <p>
            The <code>&lt;mspace&gt;</code> element is laid out as shown on
            <a href="#figure-box-mspace"></a>. The logical box is determined by the
            requested width, ascent and descent. The ink box matches the logical box.
          </p>
          <figure id="figure-box-mspace">
            <img src="figures/mspacebox.svg"/>
            <figcaption>Box model for the <code>&lt;mspace&gt;</code> element</figcaption>
          </figure>
          <div class="note">
            The terminology height/depth comes from [[MATHML3]], itself inspired
            from [[TEXBOOK]].
          </div>
        </section>
        <section>
          <h4>String Literal <code>&lt;ms&gt;</code></h4>
          <p>
            <dfn><code>&lt;ms&gt;</code></dfn>
            element is used to represent
            "string literals" in expressions meant to be interpreted by computer
            algebra systems or other systems containing "programming languages".
          </p>
          <p>
            The <code>&lt;mn&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attributes:
          </p>
          <ul>
            <li><a><code>lquote</code></a></li>
            <li><a><code>rquote</code></a></li>
          </ul>
          <p>The
            <dfn><code>lquote</code></dfn>,
            <dfn><code>rquote</code></dfn> attributes respectively specify the strings to use as opening and
            closing quotes. An unspecified attribute is
            interpreted as the character U+0022 QUOTATION MARK.
          </p>
          <p>
            The layout algorithm is the same as the
            <a><code>&lt;mtext&gt;</code></a> element.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rules in order to enclose the content with
            quotes:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/ms.css"></pre>
        </section>
      </section>
      <section>
        <h3>General Layout Schemata</h3>
        <section>
          <h4>Horizontally Group Sub-Expressions <code>&lt;mrow&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mrow&gt;</code></dfn>
            element is used to group together any number of sub-expressions, usually
            consisting of one or more <code>&lt;mo&gt;</code> elements acting as
            "operators" on one or more other expressions that are their "operands".
          </p>
          <p>
            The <code>&lt;mrow&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>. An <code>&lt;mrow&gt;</code>
            element with children
            child<sub>1</sub>, child<sub>2</sub>, … child<sub>N</sub>
            is laid out as show on <a href="#figure-box-mrow"></a>. The child boxes
            are put in a horizontal row one after the other with all their baselines
            aligned.
          </p>
          <div class="note">
            Because the box model ensure alignment of baselines,
            fraction bars or symmetric stretchy operators
            will also be aligned along the math axis in the typical case when
            <code class="MATH">AxisHeight</code> is the same for all children.
          </div>
          <p>
            A child is <dfn>slanted</dfn> if it is not an
            <code>&lt;mo&gt;</code> operator with <code>largeop="true"</code>
            (or an embellished operator whose <code>&lt;mo&gt;</code> element core
            has <code>largeop="true"</code>) and has nonzero <a>italic correction</a>.
            If a <a>slanted</a> child is followed by a non-<a>slanted</a> child,
            a space of width the <a>italic correction</a> of the former is added
            between the two children. If the last child is <a>slanted</a>, then
            a space of width its <a>italic correction</a> is added after that child.
          </p>
          <div class="note">
            Spacing around (possibly embellished) operators is already included in
            their box metrics.
          </div>
          <p>
            If the <code>&lt;mrow&gt;</code> element contains only one child,
            then its <a>italic correction</a> and <a>top accent attachment</a>
            are set to the corresponding values of that single child.
          </p>
          <figure id="figure-box-mrow">
            <img src="figures/mrowbox.svg"/>
            <figcaption>Box model for the <code>&lt;mrow&gt;</code> element</figcaption>
          </figure>
        </section>
        <section>
          <h4>Fractions <code>&lt;mfrac&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mfrac&gt;</code></dfn>
            element is used for fractions. It can also be used to mark up
            fraction-like objects such as binomial coefficients and Legendre symbols.
          </p>
          <p>
            The <code>&lt;mfrac&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the
            following attribute:
          </p>
          <ul>
            <li><a>linethickness</a></li>
          </ul>
          <p>
            The
            <dfn><code>linethickness</code></dfn>
            attribute indicates the thickness to use for the fraction bar.
            If present, it must
            have a value that is a valid <a>length-percentage</a>.
            If the attribute is absent or has an invalid value,
            <code class="MATH">FractionRuleThickness</code> is used as the default
            value. A percentage is interpreted relative to that default value.
          </p>
          <p>
            The <code>&lt;mfrac&gt;</code> element sets
            <code>displaystyle</code> to <code>false</code>,
            or if it was already <code>false</code> increments
            <code>scriptlevel</code> by 1, within its children.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rule in order to implement that behavior:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/mfrac.css"></pre>
          <div class="issue" data-number="15">Decide how to handle invalid
            fraction.</div>
          <p>
            If the fraction has less or more than two children, its layout algorithm
            is the same as the <a><code>&lt;mrow&gt;</code></a> element.
            Otherwise, the first child is called
            <dfn>numerator</dfn> and
            the second child is called
            <dfn>denominator</dfn>
            and its layout algorithm is explained below.
          </p>
          <section>
            <h5>Fraction with nonzero line thickeness</h5>
            <p>
              If the actual line thickness is nonzero, the <code>&lt;mfrac&gt;</code>
              element is laid out as shown on <a href="#figure-box-mfrac"></a>.
              The fraction bar must only be painted if the
              <a data-cite="CSS2#visibility"><code>visibility</code></a> of
              the <code>&lt;mfrac&gt;</code> element is <code>visible</code>.
              In that case, the fraction bar must be painted with the
              <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a>
              of the <code>&lt;mfrac&gt;</code> element.
              The middle of the fraction bar is shifted by
              <code class="MATH">AxisHeight</code> above the baseline.
            </p>
            <p>
              The width is given by the maximum width of the
              numerator and denominator. The numerator and denominator are
              horizontally centered. A fraction bar with the actual thickness is drawn
              centered on the
              axis height. The numerator and denominator are shifted
              up and down using the values <code class="MATH">FractionNumeratorShiftUp</code>,
              <code class="MATH">FractionDenominatorShiftDown</code> in inline style and
              <code class="MATH">FractionNumeratorDisplayStyleShiftUp</code>,
              <code class="MATH">FractionDenominatorDisplayStyleShiftDown</code>
              in display style.
              If necessary, these shift values are increased to ensure that the gaps between
              the numerator/denominator and fraction bar satisfy the minimal values provided
              by <code class="MATH">FractionDenominatorGapMin</code> and
              <code class="MATH">FractionNumeratorGapMin</code> in inline style and
              <code class="MATH">FractionDenominatorDisplayStyleGapMin</code> and
              <code class="MATH">FractionNumeratorDisplayStyleGapMin</code>
              in display style.
            </p>
            <figure id="figure-box-mfrac">
              <img src="figures/mfracbox.svg"/>
              <figcaption>Box model for the <code>&lt;mfrac&gt;</code> element</figcaption>
            </figure>
          </section>
          <section>
            <h5>Fraction with zero line thickeness</h5>
            <p>
              If the actual line thickness is zero,
              the <code>&lt;mfrac&gt;</code> element is instead laid out as
              shown on <a href="#figure-box-mfrac-without-bar"></a>.
              The gap between the top and bottom boxes
              is equally split around the math axis, which is
              <code class="MATH">AxisHeight</code> above the baseline.
              The relevant shift values are now
              <code class="MATH">StackTopShiftUp</code>,
              <code class="MATH">StackBottomShiftDown</code> in inline style and
              <code class="MATH">StackTopDisplayStyleShiftUp</code>,
              <code class="MATH">StackBottomDisplayStyleShiftDown</code> in display style.
              If necessary, the two shift values are increased by a same value to ensure
              the gap between the top and bottom boxes satisfy the values provided by
              by <code class="MATH">StackGapMin</code> in inline style and
              <code class="MATH">StackDisplayStyleGapMin</code> in display style.
            </p>
            <figure id="figure-box-mfrac-without-bar">
              <img src="figures/mfracnobarbox.svg"/>
              <figcaption>Box model for the <code>&lt;mfrac&gt;</code> element without bar</figcaption>
            </figure>
          </section>
          <section>
            <h5>Spacing around the fraction</h5>
            <p>
              In order to prevent the fraction bar to be confused with other items around
              the fraction (e.g. minus sign or the bar of another fraction), a 1 pixel space
              must actually be added on each side of the <code>&lt;mfrac&gt;</code> element.
            </p>
            <p>
              If the numerator is an embellished operator and the <code>&lt;mfrac&gt;</code> element is the
              outermost element in this embellished operator hierarchy then the operator
              leading and trailing spaces must be added around the fraction.
            </p>
          </section>
        </section>
        <section>
          <h4>Radicals <code>&lt;msqrt&gt;</code>, <code>&lt;mroot&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;msqrt&gt;</code></dfn>
            and
            <dfn><code>&lt;mroot&gt;</code></dfn>
            elements construct radicals. The <code>&lt;msqrt&gt;</code> element is
            used for square roots, while the <code>&lt;mroot&gt;</code> element is
            used to draw radicals with indices, e.g. a cube root.
          </p>
          <p>
          </p>
          <p>
            The <code>&lt;msqrt&gt;</code> and <code>&lt;mroot&gt;</code>
            elements accept the attributes described
            in <a href="#global-attributes"></a>.
          </p>
          <p>
            The <code>&lt;mroot&gt;</code> element sets
            increments scriptlevel by 2, and sets displaystyle to "false" in all
            but its first child.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rule in order to implement that behavior:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/mroot.css"></pre>
          <div class="issue" data-number="15">Decide how to handle invalid
            mroot.</div>
          <p>
            If the <code>&lt;mroot&gt;</code> has less or more than two children,
            its layout algorithm
            is the same as the <a><code>&lt;mrow&gt;</code></a> element.
            Otherwise, the first child is called
            <dfn>base</dfn> and
            the second child is called
            <dfn>index</dfn>
            and its layout algorithm is explained below.
            The children of the <code>&lt;msqrt&gt;</code> element are laid out
            using the algorithm of the <a><code>&lt;mrow&gt;</code></a> element
            to produce a box that is also called the base.
          </p>
          <section>
            <h5>Radical symbol</h5>
            <p>
              The radical symbol must only be painted if the
              <a data-cite="CSS2#visibility"><code>visibility</code></a> of
              the <code>&lt;msqrt&gt;</code> or <code>&lt;mroot&gt;</code>
              element is <code>visible</code>.
              In that case, the radical symbol must be painted with the
              <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a>
              of that element.
            </p>
            <p>
              The line thickness of the overbar is given by
              <code class="MATH">RadicalRuleThickness</code>.
              The gap between the overbar and base is given by
              <code class="MATH">RadicalVerticalGap</code>
              in inline style and
              <code class="MATH">RadicalDisplayStyleVerticalGap</code>
              in display style.
              The ascent above the overbase is given by
              <code class="MATH">RadicalExtraAscender</code>.
            </p>
            <p>
              The surd is drawn by trying to vertically stretch the character
              U+221A SQUARE ROOT
              to at least the sum of the ink height of the base, the radical gap and
              the radical rule thickness. If the CSS <code>direction</code> is set to
              right-to-left,
              then the surd is actually drawn from the glyph obtained by mirroring
              U+221A SQUARE ROOT via the <code>rtlm</code> OpenType feature.
            </p>
          </section>
          <section>
            <h5>Square root</h5>
            <p>
              The <code>&lt;msqrt&gt;</code> element is laid out as shown on
              <a href="#figure-box-msqrt"></a>.
              The width is given by the sum of the width of the surd and of the
              base.
              The baseline of the square root matches the baseline of the base.
              The ink box is determined from the ink boxes of the surd and base
              while the logical box takes into account the extra ascender.
            </p>
            <figure id="figure-box-msqrt">
              <img src="figures/msqrtbox.svg"/>
              <figcaption>Box model for the <code>&lt;msqrt&gt;</code> element</figcaption>
            </figure>
          </section>
          <section>
            <h5>Root with index</h5>
            <p>
              The <code>&lt;mroot&gt;</code> element is laid out as shown on
              <a href="#figure-box-mroot"></a>.
              The root index is first ignored and the base and surd are laid out as
              shown on figure <a href="#figure-box-msqrt"></a> to obtain a box B.
              The horizontal metrics of the <code>&lt;mroot&gt;</code> element are
              obtained by putting
              <code class="MATH">RadicalKernBeforeDegree</code>
              before the root index, then placing the root index, then a kerning
              of <code class="MATH">RadicalKernAfterDegree</code>
              after the root index and finally placing B. In general
              the kerning before the root index is positive while the kerning after
              it is negative,
              which means that the root element will have some space before it and
              that the root index will overlap the surd.
              For the vertical metrics of the <code>&lt;mroot&gt;</code> element, the
              baseline of B is first taken as the baseline.
              The ink height of B is graduated with a linear
              scale going from the bottom at coordinate 0 to the top at coordinate
              1. Then the ink bottom of the root index will
              be vertically positioned at coordinate
              <code class="MATH">RadicalDegreeBottomRaisePercent</code>.
              Finally, the box of the root index and B is taken into account to
              deduce the metrics for the whole box of the <code>&lt;mroot&gt;</code>
              element.
            </p>
            <figure id="figure-box-mroot">
              <img src="figures/mrootbox.svg"/>
              <figcaption>Box model for the <code>&lt;mroot&gt;</code> element</figcaption>
            </figure>
          </section>
        </section>
        <section>
          <h4>Style Change <code>&lt;mstyle&gt;</code></h4>
          <p>
            Historically, the
            <dfn><code>&lt;mstyle&gt;</code></dfn>
            element was introduced to make
            style changes that affect the rendering of its contents.
          </p>
          <p>
            The <code>&lt;mstyle&gt;</code> element accepts the attributes described in
            <a href="#global-attributes"></a>. Its layout algorithm is the
            same as the <a><code>&lt;mrow&gt;</code></a> element.
          </p>
          <div class="note">
            While the <code>&lt;mstyle&gt;</code> is preserved for backward compatibility reasons
            with legacy documents and existing tools, modern authors and tools are strongly
            encouraged to use CSS for styling.
          </div>
        </section>
        <section>
          <h4>Error Message <code>&lt;merror&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;merror&gt;</code></dfn>
            element displays its contents as an
            ”error message”. The intent of this element is to provide a standard way
            for programs that generate MathML from other input to report syntax errors
            in their input.
          </p>
          <p>
            The <code>&lt;merror&gt;</code> element accepts the attributes described in
            <a href="#global-attributes"></a>. Its layout algorithm is the
            same as the <a><code>&lt;mrow&gt;</code></a> element.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rule in order to visually highlight the error
            message:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/merror.css"></pre>
        </section>
        <section>
          <h4>Adjust Space Around Content <code>&lt;mpadded&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mpadded&gt;</code></dfn>
            element renders the same as its child content, but with the
            size of the child’s bounding box and the relative positioning point of its
            content modified according to <code>&lt;mpadded&gt;</code>’s attributes.
          </p>
          <p>
            The <code>&lt;mspace&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attributes:
          </p>
          <ul>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-width"><code>width</code></a></li>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-height"><code>height</code></a></li>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-depth"><code>depth</code></a></li>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-lspace"><code>lspace</code></a></li>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-voffset"><code>voffset</code></a></li>
          </ul>
          <p>
            The
            <dfn id="attribute-mpadded-width">mpadded <code>width</code></dfn> and
            <dfn id="attribute-mpadded-lspace">mpadded <code>lspace</code></dfn> attributes, if present, must match the syntax
            <code>( "+" | "-" )? (<a><code>unsigned-length-percentage</code></a> | (<a><code>unsigned-number</code></a> "%"? "width"))</code>.
          </p>
          <p>
            The
            <dfn id="attribute-mpadded-height">mpadded <code>height</code></dfn>,
            <dfn id="attribute-mpadded-depth">mpadded <code>depth</code></dfn> and
            <dfn id="attribute-mpadded-voffset">mpadded <code>voffset</code></dfn>
            attributes, if present, must match the syntax
            <code>( "+" | "-" )? (<a><code>unsigned-length-percentage</code></a> | (<a><code>unsigned-number</code></a> "%"? ("height" | "depth"))</code>.
          </p>
          <section>
            <h5>Content box and requested parameters</h5>
            <p>
              Children of the <code>&lt;mpadded&gt;</code> element are laid out
              using the algorithm of the <a><code>&lt;mrow&gt;</code></a> element
              to produce the
              <dfn>mpadded content box</dfn>
              with logical metrics called content width,
              content height and content depth. The requested <code>&lt;mpadded&gt;</code>
              parameters are determined as follows:
            </p>
            <ul>
              <li>If the <code>width</code> (respectively <code>height</code>,
                <code>depth</code>, <code>lspace</code>, <code>voffset</code>)
                attributes are absent or invalid the requested width
                (respectively depth, height) is the content width
                (respectively content height, content depth, <code>0</code>,
                <code>0</code>).
              </li>
              <li>If the <code>width</code> (respectively <code>height</code>,
                <code>depth</code>, <code>lspace</code>, <code>voffset</code>)
                attribute is an
                <a><code>unsigned-length-percentage</code></a>
                then the requested width
                (respectively height, depth, lspace, voffset)
                is the resolved value
                with percentage interpreted relative to
                the content width (respectively height, depth, <code>0</code>,
                <code>0</code>).
              </li>
              <li>If the <code>width</code> (respectively <code>lspace</code>) attribute
                matches <code>"<a><code>unsigned-number</code></a>width"</code>
                then the requested width (respectively lspace) is the number multipled by
                the content width. If instead it matches
                <code>"<a><code>unsigned-number</code></a>%width"</code>
                then it is the same value but divided by 100.
              </li>
              <li>If the <code>height</code> (respectively <code>depth</code>,
                <code>voffset</code>) attribute
                matches <code>"<a><code>unsigned-number</code></a>height"</code>
                then the requested height (respectively depth, voffset) is the number
                multipled by the content height. If instead it matches
                <code>"<a><code>unsigned-number</code></a>%heigth"</code>
                then it is the same value but divided by 100.
              </li>
              <li>If the <code>height</code> (respectively <code>depth</code>,
                <code>voffset</code>) attribute
                matches <code>"<a><code>unsigned-number</code></a>depth"</code>
                then the requested height (respectively depth, voffset) is the number
                multipled by the content depth. If instead it matches
                <code>"<a><code>unsigned-number</code></a>%depth"</code>
                then it is the same value but divided by 100.
              </li>
              <li>If the <code>width</code> (respectively <code>height</code>,
                <code>depth</code>, <code>lspace</code>, <code>voffset</code>)
                starts with a U+002B PLUS SIGN or U+002D HYPHEN-MINUS character,
                then choose ε = ±1 to match the sign of that character
                and let V be the requested width
                (respectively height, depth, lspace, voffset)
                obtained for the same attribute value with that character removed.
                Then the requested width (respectively height, depth, lspace, voffset)
                is the content width (respectively height, depth, <code>0</code>,
                <code>0</code>) + εV.
              </li>
            </ul>
            <div class="issue" data-number="40">Allow negative width, lspace to
              produce negative spacing?</div>
            <p>
              If one of the requested width, depth, height or lspace values calculated
              above is negative then it is treated as <code>0</code>.
            </p>
          </section>
          <section>
            <h5>Layout of <code>&lt;mpadded&gt;</code></h5>
            <p>
              The <code>&lt;mpadded&gt;</code> element is laid out as shown on
              <a href="#figure-box-mpadded"></a>.
              The <a>mpadded content box</a> is positioned at the origin of the
              <code>&lt;mpadded&gt;</code> element, shift horizontally by the requested
              lspace and vertically by the requested voffset.
              The logical metrics of the <code>&lt;mpadded&gt;</code> element are given
              by the requested height, depth and width. The ink metrics of the
              <code>&lt;mpadded&gt;</code> element match their logical metrics.
            </p>
            <figure id="figure-box-mpadded">
              <img src="figures/mpaddedbox.svg"/>
              <figcaption>Box model for the <code>&lt;mpadded&gt;</code> element</figcaption>
            </figure>
          </section>
        </section>
        <section>
          <h4>Making Sub-Expressions Invisible <code>&lt;mphantom&gt;</code></h4>
          <p>
            Historically, the
            <dfn><code>&lt;mphantom&gt;</code></dfn>
            element was introduced to render
            its content invisibly, but with the same size and other dimensions,
            including baseline position, that its contents would have if they were
            rendered normally.
          </p>
          <p>
            The <code>&lt;mphantom&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>. Its layout algorithm is
            the same as the <a><code>&lt;mrow&gt;</code></a> element.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rule in order to hide the content:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/mphantom.css"></pre>
          <div class="note">
            While <code>&lt;mphantom&gt;</code> is preserved for backward compatibility reasons
            with legacy documents and existing tools, modern authors and tools are strongly
            encouraged to use CSS for styling.
          </div>
        </section>
        <section>
          <h4>Enclose Expression Inside Notation <code>&lt;menclose&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;menclose&gt;</code></dfn>
            element renders its content inside the enclosing notation.
            It accepts the attributes described in
            <a href="#global-attributes"></a> as well as the
            following attribute:
          </p>
          <ul>
            <li><a>notation</a></li>
          </ul>
          <p>
            The
            <dfn><code>notation</code></dfn>
            attribute, if present, must have a value that is an
            <a data-cite="HTML#unordered-set-of-unique-space-separated-tokens">unordered set
              of unique space-separated tokens</a> that are ASCII case-insensitive. The
            allowed values are
            <code>left</code>,
            <code>right</code>,
            <code>top</code>,
            <code>bottom</code>,
            <code>box</code>,
            <code>roundedbox</code>,
            <code>actuarial</code>,
            <code>madruwb</code>,
            <code>horizontalstrike</code>,
            <code>verticalstrike</code>
            <code>updiagonalstrike</code>,
            <code>downdiagonalstrike</code>,
            <code>longdiv</code>,
            <code>circle</code>.
          </p>
          <p>
            The notations must only be painted if the
            <a data-cite="CSS2#visibility"><code>visibility</code></a> of
            the <code>&lt;menclose&gt;</code> element is <code>visible</code>.
            In that case, the notations must be painted with the
            <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a>
            of the <code>&lt;menclose&gt;</code> element.
          </p>
          <p>
            Children of the <code>&lt;menclose&gt;</code> element are laid out
            using the algorithm of the <a><code>&lt;mrow&gt;</code></a> element
            to produce a content box.
            Following [[OPEN-FONT-FORMAT]] [[?TEXBOOK]], the notation ξ<sub>8</sub>
            is used to denote the default rule thickness and is equal to
            <code class="MATH">OverbarRuleThickness</code>.
            Gaps are set to 3ξ<sub>8</sub>.
            Contrary to what is done in general and unless specified otherwise,
            the x-axis direction of notations is assumed to be independent of the CSS
            <code>direction</code>.
            Each notation is handled individually and the union of all output is taken
            in order to determine the metrics of the <code>&lt;menclose&gt;</code>.
          </p>
          <ol>
            <li>
              <p>
                The <code>left</code> notation is drawn by putting a vertical bar of thickness
                ξ<sub>8</sub> on the left of the content of the <code>&lt;menclose&gt;</code> element.
                The length of the bar is obtained by extending the height of the content
                with <code class="MATH">OverbarVerticalGap</code> plus
                <code class="MATH">OverbarRuleThickness</code> above
                and <code class="MATH">UnderbarVerticalGap</code> plus
                <code class="MATH">UnderbarRuleThickness</code> below.
                The gap between the bar and the content is 3ξ<sub>8</sub>.
                The logical box is obtained by adding some space of width
                ξ<sub>8</sub> on the left of the bar. See
                <a href="#figure-box-menclose-left"></a>.
              </p>
              <figure id="figure-box-menclose-left">
                <img src="figures/leftbox.svg"/>
                <figcaption>Box model for the <code>left</code>
                  notation of the <code>&lt;menclose&gt;</code> element</figcaption>
              </figure>
            </li>
            <li>
              <p>
                The <code>right</code> notation is drawn the same as the <code>left</code> notation,
                but with the vertical bar placed on the right.
              </p>
            </li>
            <li>
              <p>
                The <code>top</code> notation is drawn by putting an overbar of thickness
                <code class="MATH">OverbarRuleThickness</code>
                over the content of the <code>&lt;menclose&gt;</code> element.
                The length of the bar is obtained by extending the width of the content
                with 4ξ<sub>8</sub> on each side.
                The gap between the overbar and the content is
                <code class="MATH">OverbarVerticalGap</code>.
                The logical box is obtained by adding some space of height
                <code class="MATH">OverbarExtraAscender</code> above the bar.
                See <a href="#figure-box-menclose-top"></a>.
              </p>
              <figure id="figure-box-menclose-top">
                <img src="figures/topbox.svg"/>
                <figcaption>Box model for the <code>top</code>
                  notation of the <code>&lt;menclose&gt;</code> element</figcaption>
              </figure>
            </li>
            <li>
              <p>
                The <code>bottom</code> notation is drawn the same as the <code>top</code> notation,
                but with the vertical bar placed below the content and using parameters
                <code class="MATH">UnderbarRuleThickness</code>,
                <code class="MATH">UnderbarVerticalGap</code>.
                and <code class="MATH">UnderExtraDescender</code>.
              </p>
            </li>
            <li>
              The <code>box</code> notation is treated as equivalent to
              <code>left right top bottom</code>.
            </li>
            <li>
              <p>
                The <code>roundedbox</code> notation is drawn as follows. An expanded
                is calculated by extending the ink box by 7ξ<sub>8</sub> / 2 on each
                side. Using terminology from [[SVG]],
                a rounded rectangle is drawn on this expanded box
                with parameters <code>rx</code>, <code>ry</code> and
                <code>stroke-width</code> set to 3ξ<sub>8</sub>.
                The logical box is obtained by adding a space of ξ<sub>8</sub> on
                each side of the ink box.
                See <a href="#figure-box-menclose-roundedbox"></a>.
              </p>
              <figure id="figure-box-menclose-roundedbox">
                <img src="figures/roundedbox.svg"/>
                <figcaption>Box model for the <code>roundedbox</code>
                  notation of the <code>&lt;menclose&gt;</code> element</figcaption>
              </figure>
            </li>
            <li>The <code>actuarial</code> notation is treated as equivalent to <code>right top</code>.</li>
            <li>
              <p>
                The <code>madruwb</code> notation is treated as equivalent to
                <code>right bottom</code>.
            </li>
            <li>
              <p>
                The <code>horizontalstrike</code> notation is drawn with an horizontal bar
                of thickness ξ<sub>8</sub> and
                vertically centered inside the <code>&lt;menclose&gt;</code> content.
                This does not change the box metrics.
                See <a href="#figure-box-horizontal-strike"></a>.
              </p>
              <figure id="figure-box-horizontal-strike">
                <img src="figures/horizstrikebox.svg"/>
                <figcaption>Box model for the <code>horizontalstrike</code>
                  notation of the <code>&lt;menclose&gt;</code> element</figcaption>
              </figure>
            </li>
            <li>
              <p>
                The <code>verticalstrike</code> notation is drawn the same as
                <code>horizontalstrike</code> but with a vertical bar
                of thickness ξ<sub>8</sub> and horizontally centered inside the <code>&lt;menclose&gt;</code>
                content.
              </p>
            </li>
            <li>
              <p>
                The <code>updiagonalstrike</code> notation is drawn with a line
                of thickness ξ<sub>8</sub> going from the bottom left corner of the <code>&lt;menclose&gt;</code>
                content to its top right corner. Using terminology from [[SVG]], the
                <code>stroke-linecap</code> of the line is <code>butt</code>.
                As an approximation, the ink box
                is set equal to the logical box and obtained by increasing the original box
                from each side by ξ<sub>8</sub> / 2.
                See <a href="#figure-box-menclose-up-diagonal-strike"></a>.
              </p>
              <figure id="figure-box-menclose-up-diagonal-strike">
                <img src="figures/updiagstrikebox.svg"/>
                <figcaption>Box model for the <code>updiagonalstrike</code>
                  notation of the <code>&lt;menclose&gt;</code> element</figcaption>
              </figure>
            </li>
            <li>
              <p>
                The <code>downdiagonalstrike</code> notation is drawn as an
                <code>updiagonalstrike</code>
                but the line strike goes from the top left corner to the bottom right corner.
                Using terminology from [[SVG]], the
                <code>stroke-linecap</code> of the line is <code>butt</code>.
              </p>
            </li>
            <li>
              <p>
                The <code>longdiv</code> notation is drawn similarly to the <code>&lt;msqrt&gt;</code> element
                (<a href="#figure-box-msqrt"></a>). It is independent of CSS
                <code>direction</code> and U+221A SQUARE ROOT is replaced with
                U+0029 RIGHT PARENTHESIS. The rule thickness is ξ<sub>8</sub>,
                the gap between content and overbar is 3ξ<sub>8</sub> and the extra ascender
                is ξ<sub>8</sub>.
              </p>
            </li>
            <li>
              <p>
                The <code>circle</code> notation is drawn as follows.
                Given the ink box of width w and height h, an ellipse is drawn using
                the axes of symmetry of this ink box, the radii
                w * √2 / 2, h * √2 / 2 and thickness ξ<sub>8</sub>.
                The logical box is obtained by adding space ξ<sub>8</sub> around each
                side of the ellipse's ink box.
              </p>
              <figure id="figure-box-menclose-circle">
                <img src="figures/circlebox.svg"/>
                <figcaption>Box model for the <code>circle</code>
                  notation of the <code>&lt;menclose&gt;</code> element</figcaption>
              </figure>
            </li>
          </ol>
        </section>
      </section>
      <section>
        <h3>Script and Limit Schemata</h3>
        <section>
          <h4>Cramped Elements</h4>
          <p>
            A <a>MathML Core element</a> is <dfn>cramped</dfn> if it satisfies
            one of the following condition:
          </p>
          <ol>
            <li>Its parent is <a>cramped</a>.</li>
            <li>Its parent is a <a><code>&lt;msqrt&gt;</code></a> or
              <a><code>&lt;mroot&gt;</code></a> element.
            </li>
            <li>It is the denominator of a <a><code>&lt;mfrac&gt;</code></a>
              element.</li>
            <li>
              It is the subscript of a
              <a><code>&lt;msub&gt;</code></a> or
              <a><code>&lt;msubsup&gt;</code></a> element.
            </li>
            <li>
              It is the underscript of a
              <a><code>&lt;munder&gt;</code></a> or
              <a><code>&lt;munderover&gt;</code></a> element.
            </li>
            <li>It is the overscript of the
              <code>&lt;mover&gt;</code> and <code>&lt;munderover&gt;</code>
              elements and
              is an <a>embellished operator</a> with
              the <a>accent</a> property.
            </li>
          </ol>
        </section>
        <section>
          <h4>Subscripts and Superscripts <code>&lt;msub&gt;</code>, <code>&lt;msup&gt;</code>, <code>&lt;msubsup&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;msub&gt;</code></dfn>
            element attaches a subscript to a base using the syntax
            <br/>
            <code>&lt;msub&gt;</code> base subscript <code>&lt;/msub&gt;</code>
          </p>
          <p>
            The
            <dfn><code>&lt;msup&gt;</code></dfn>
            element attaches a superscript to a base using the syntax
            <br/>
            <code>&lt;msup&gt;</code> base superscript <code>&lt;/msup&gt;</code>
          </p>
          <p>
            The
            <dfn><code>&lt;msubsup&gt;</code></dfn>
            element is used to attach both a subscript and superscript to
            a base expression.
            <br/>
            <code>&lt;msubsup&gt;</code> base subscript superscript <code>&lt;/msubsup&gt;</code>
          </p>
          <p>
            The <code>&lt;msub&gt;</code> element is laid out as shown on <a href="#figure-box-msub"></a>.
            The baseline is the baseline of the base while the baseline of the script is
            shifted down by <code>SubShift</code>, which is the minimal value honoring the
            following conditions:
          </p>
          <ol>
            <li>
              <p>
                <code>SubShift</code> is at least <code class="MATH">SubscriptShiftDown</code>.
              </p>
            </li>
            <li>
              <p>
                The top of the subscript <code>SubTop</code> with respect to the baseline
                is not above <code class="MATH">SubscriptTopMax</code>.
              </p>
            </li>
            <li>
              <p>
                The drop <code>SubscriptBaselineDrop</code> from the bottom of the base to
                the baseline of the script is at least
                <code class="MATH">SubscriptBaselineDropMin</code>.
              </p>
            </li>
          </ol>
          <p>
            When determining
            the logical box, a space of width <code class="MATH">SpaceAfterScript</code>
            is added after
            the subscript. By default, the leading edge of the subscript is aligned with
            the trailing edge of the base. However, if the base is an operator with
            <code>largeop="true"</code> (or an embellished operator whose <code>&lt;mo&gt;</code> element core
            has <code>largeop="true"</code>) the subscript is horizontally shifted backward
            by the italic correction of the base.
          </p>
          <figure id="figure-box-msub">
            <img src="figures/msubbox.svg"/>
            <figcaption>Box model for the <code>&lt;msub&gt;</code> element</figcaption>
          </figure>
          <p>
            The <code>&lt;msup&gt;</code> element is laid out as shown on <a href="#figure-box-msup"></a>.
            The baseline is the baseline of the base while the baseline of the script is
            shifted up by <code>SuperShift</code>, which is the minimal value honoring the
            following conditions:
          </p>
          <ol>
            <li><code>SuperShift</code> is at least
              <code class="MATH">SuperscriptShiftUpCramped</code> if the <code>&lt;msup&gt;</code> element is
              <a>cramped</a> or at least
              <code class="MATH">SuperscriptShiftUp</code> otherwise.
            </li>
            <li>
              <p>
                The bottom of the superscript <code>SuperBottom</code> with respect to the
                baseline is not below <code class="MATH">SuperscriptBottomMin</code>.
            </li>
            <li>
              <p>
                The drop <code class="MATH">SuperscriptBaselineDrop</code> from the top of the base to
                the baseline of the script is at most <code class="MATH">SuperscriptBaselineDropMax</code>.
            </li>
          </ol>
          <p>
            When determining
            the logical box, a space of width <code class="MATH">SpaceAfterScript</code>
            is added after
            the superscript. By default, the leading edge of the superscript is aligned with
            the trailing edge of the base and shifted forward by the italic correction
            of the base, except if the base is an operator with
            <code>largeop="true"</code> (or an embellished operator whose <code>&lt;mo&gt;</code> element core
            has <code>largeop="true"</code>).
          </p>
          <figure id="figure-box-msup">
            <img src="figures/msupbox.svg"/>
            <figcaption>Box model for the <code>&lt;msup&gt;</code> element</figcaption>
          </figure>
          <p>
            The <code>&lt;msubsup&gt;</code> element is laid out as shown on
            <a href="#figure-box-msup"></a>.
            The baseline is the baseline of the base while the baseline of the script is
            shifted down by <code>SubShift</code> and the superscript is shifted up by
            <code>SuperShift</code> which is initially set to the minimal values honoring the
            following conditions:
          </p>
          <ol>
            <li><code>SubShift</code> is at least
              <code class="MATH">SuperscriptShiftUpCramped</code> if the <code>&lt;msup&gt;</code> element is
              <a>cramped</a> or at least
              <code class="MATH">SuperscriptShiftUp</code> otherwise.
            </li>
            <li>
              The top of the subscript <code>SubTop</code> with respect to the baseline
              is not above <code class="MATH">SubscriptTopMax</code>.
            </li>
            <li><p>
                The drop <code class="MATH">SuperscriptBaselineDrop</code> from the top of the base to
                the baseline of the superscript is at most <code class="MATH">SuperscriptBaselineDropMax</code>.</li>
            <li><code>SubShift</code> is at least
              <code class="MATH">SuperscriptShiftUpCramped</code> if the <code>&lt;msup&gt;</code> element is
              <a>cramped</a> or at least
              <code class="MATH">SuperscriptShiftUp</code> otherwise.
            </li>
            <li>The bottom of the superscript <code>SuperBottom</code> with respect to the
              baseline is not below <code class="MATH">SuperscriptBottomMin</code>.
            </li>
            <li>The drop <code class="MATH">SubscriptBaselineDrop</code> from
              the bottom of the base to the the baseline of the subscript is at least
              <code class="MATH">SubscriptBaselineDropMin</code>.
            </li>
          </ol>
          <p>
            We then increase the gap <code>SubSuperGap</code> between the bottom of the superscript
            and the top of the subscript to ensure it is at least
            <code class="MATH">SubSuperscriptGapMin</code>:
            This is first done by continuing to shift the superscript up as long as the
            <code>SuperBottom</code> does not exceed
            <code class="MATH">SuperscriptBottomMaxWithSubscript</code>
            and next by continuing to shift the subscript down.
          </p>
          <p>
            When determining
            the logical box, a space of width <code class="MATH">SpaceAfterScript</code>
            is added after
            each script. By default the leading edges of the scripts are aligned with
            the trailing edge and either the superscript is shifted forward by the italic
            correction of the base. However, if the base is an operator with
            <code>largeop="true"</code> (or an embellished operator whose <code>&lt;mo&gt;</code> element core
            has <code>largeop="true"</code>) then instead the subscript is shifted forward by the
            italic correction of the base.
          </p>
          <figure id="figure-box-msubsup">
            <img src="figures/msubsupbox.svg"/>
            <figcaption>Box model for the <code>&lt;msubsup&gt;</code> element</figcaption>
          </figure>
        </section>
        <section>
          <h4>Underscripts and Overscripts <code>&lt;munder&gt;</code>, <code>&lt;mover&gt;</code>, <code>&lt;munderover&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;munder&gt;</code></dfn>
            element attaches an accent or limit placed under a base using
            the syntax
            <br/>
            <code>&lt;munder&gt;</code> base underscript <code>&lt;/munder&gt;</code>
            <br/>
            If base is an operator with <code>movablelimits="true"</code> (or an embellished
            operator whose <code>&lt;mo&gt;</code> element core has <code>movablelimits="true"</code>), and
            <code>displaystyle="false"</code>, then underscript is drawn in a subscript position.
            In this case, the <code>accentunder</code> attribute is ignored. […]
          </p>
          <p>
            The
            <dfn><code>&lt;mover&gt;</code></dfn>
            element attaches an accent or limit placed over a base using
            the syntax
            <br/>
            <code>&lt;mover&gt; base overscript &lt;/mover&gt;</code>
            <br/>
            If base is an operator with <code>movablelimits="true"</code> (or an embellished
            operator whose <code>&lt;mo&gt;</code> element core has <code>movablelimits="true"</code>), and
            <code>displaystyle="false"</code>, then overscript is drawn in a superscript position.
            In this case, the <code>accent</code> attribute is ignored.
          </p>
          <p>
            The
            <dfn><code>&lt;munderover&gt;</code></dfn>
            element attaches accents or limits placed both over and
            under a base using the syntax
            <br/>
            <code>&lt;munderover&gt; base underscript overscript &lt;/munderover&gt;</code>
            <br/>
            If base is an operator with <code>movablelimits="true"</code> (or an embellished
            operator whose <code>&lt;mo&gt;</code> element core has <code>movablelimits="true"</code>), and
            <code>displaystyle="false"</code>, then underscript and overscript are drawn in a
            subscript and superscript position, respectively. In this case, the
            <code>accentunder</code> and <code>accent</code> attributes are ignored.
          </p>
          <p>
            In cases where underscript and overscript are drawn as subscript and
            superscript position then the layout algorithm is the same as
            <a href="#subscripts-and-superscripts-msub-msup-msubsup"></a>.
            Note that in that case,
            <code>accent</code> or <code>accentunder</code> are ignored so the scriptlevel increment is
            always performed.
          </p>
          <p>
            The general layout of <code>&lt;munderover&gt;</code> is shown on
            <a href="figure-box-munderover"></a>.
            The overscript is placed above the base, the underscript below the base
            and by default are aligned with respect to their geometrical center.
            If the overscript is an accent and has a <code class="MATH">TopAccentAttachment</code>
            value, then this value may be used to horizontally align the accent instead
            of its geometrical center.
            <code>OverShift</code> is the distance between the top ink
            of the base and the baseline of the overscript, <code>OverGap</code> is the distance
            between the top ink of the base and the bottom ink of the overscript,
            <code class="MATH">OverExtraAscender</code> is extra space to add above the overscript when
            determining the logical box. <code>UnderShift</code>, <code>UnderGap</code> and
            <code class="MATH">UnderExtraDescender</code> are defined similarly for the underscripts.
            We distinguish three cases:
          </p>
          <ol>
            <li>If the base is an operator with <code>largeop="true"</code>
              (or an embellished operator whose <code>&lt;mo&gt;</code> element core has
              <code>largeop="true"</code>) then ensure that <code>OverGap</code> is at least
              <code class="MATH">UpperLimitGapMin</code>, that <code>OverShift</code> is at least
              <code class="MATH">UpperLimitBaselineRiseMin</code> that <code>UnderGap</code> is at
              least
              <code class="MATH">LowerLimitGapMin</code>, that <code>UnderShift</code> is at least
              <code class="MATH">LowerLimitBaselineDropMin</code>.
              <code class="MATH">OverExtraAscender</code> and
              <code class="MATH">UnderExtraDescender</code> are zero. The
              underscript is shifted backward by half the italic correction of the base.
              The overscript is shifted forward by half the italic correction of the base.</li>
            <li>If the base is a horizontal operator with <code>stretchy="true"</code>
              (or a horizontal embellished operator whose <code>&lt;mo&gt;</code> element core has
              <code>stretchy="true"</code>). Then ensure that <code>OverGap</code> is at least
              <code class="MATH">StretchStackGapBelowMin</code>, that <code>OverShift</code> is at
              least
              <code class="MATH">StretchStackTopShiftUp</code> that <code>UnderGap</code> is at least
              <code class="MATH">StretchStackGapAboveMin</code>,
              that <code>UnderShift</code> is at least
              <code class="MATH">StretchStackBottomShiftDown</code>.
              <code class="MATH">OverExtraAscender</code> and
              <code class="MATH">UnderExtraDescender</code> are zero.
            </li>
            <li>In other cases we proceed as follows.
              There are not any specific conditions to satisfy on <code>OverShift</code> or
              <code>UnderShift</code>.
              <code>OverExtraAscender</code> and
              <code>OverExtraAscender</code> are respectively set to
              <code class="MATH">OverbarExtraAscender</code>
              and <code class="MATH">UnderExtraDescender</code>.
              We set <code>UnderGap</code> to <code class="MATH">UnderbarVerticalGap</code>
              if the underscript is not an accent and to zero otherwise.
              We set <code>OverGap</code> to <code class="MATH">OverbarVerticalGap</code>
              if the overscript is not an accent and generally to zero otherwise.
              However, if overscript is an accent and if the base ascent is at most
              <code class="MATH">AccentBaseHeight</code> then we actually set <code>OverGap</code> to
              their nonnegative difference.
            </li>
          </ol>
          <p>
            Remark: For accent overscripts and bases with ascents that are at most
            <code class="MATH">AccentBaseHeight</code>, the rule from
            [[OPEN-FONT-FORMAT]] [[?TEXBOOK]] is actually to align the baselines of the
            overscripts and of the bases. This assumes that accent glyphs are designed in
            such a way that their ink bottoms are more or less
            <code class="MATH">AccentBaseHeight</code> above their baselines. Hence, the
            previous rule will guarantee that all the overscript bottoms are aligned while
            still avoiding collision with the bases. However, MathML can have arbitrary
            accent overscripts so we provide a more general and simpler rule above: Ensure
            that the bottom of overscript is at least
            <code class="MATH">AccentBaseHeight</code> above the baseline of the base.
          </p>
          <figure id="figure-box-munderover">
            <img src="figures/munderoverbox.svg"/>
            <figcaption>Box model for the <code>&lt;munderover&gt;</code> element</figcaption>
          </figure>
          <p>
            The layout of <code>&lt;munder&gt;</code> and <code>&lt;mover&gt;</code> is the same as the one of
            <code>&lt;munderover&gt;</code> except that one script and its corresponding extra space
            are ignored.
          </p>
        </section>
        <section>
          <h4>Prescripts and Tensor Indices <code>&lt;mmultiscripts&gt;</code></h4>
          <p>
            Presubscripts and tensor notations are represented by a single element,
            <dfn><code>&lt;mmultiscripts&gt;</code></dfn>, using the syntax:</p>
          <p>
            <code>&lt;mmultiscripts&gt;</code>
            <code>base</code><br/>
            <code>(subscript superscript)*</code><br/>
            <code>[ &lt;mprescripts/&gt; (presubscript presuperscript)* ]</code><br/>
            <code>&lt;/mmultiscripts&gt;</code>
          </p>
          <p>
            This element allows the representation of any number of vertically-aligned
            pairs of subscripts and superscripts, attached to one base expression. It
            supports both postscripts and prescripts
            separated by
            the empty element
            <dfn><code>&lt;mprescripts&gt;</code></dfn>. Missing scripts can be represented
            by the empty element
            <dfn><code>&lt;none&gt;</code></dfn>.
          </p>
          <p>
            Any layout for <code>&lt;mmultiscripts&gt;</code> is acceptable as long as it follows
            the condition of the MathML 3 specification [[MATHML3]] and is consistent
            with
            <a href="#subscripts-and-superscripts-msub-msup-msubsup"></a>
            for <code>&lt;mmultiscripts&gt;</code>
            contructions that are equivalent to <code>&lt;msubsup&gt;</code>. Here is a possible algorithm
            that is represented on <a href="#figure-box-mmultiscripts"></a>.
          </p>
          <ol>
            <li>
              Determine the vertical shifts for each subscript/superscript pair
              using the algorithm for <code>&lt;msub&gt;</code> (if the superscript is <code>&lt;none&gt;</code>),
              <code>&lt;msup&gt;</code> (if the subscript is <code>&lt;none&gt;</code>) or <code>&lt;msubsup&gt;</code>
              (if none of the scripts are <code>&lt;none&gt;</code>) or otherwise use shifts of zero
              (if both scripts of the pair are <code>&lt;none&gt;</code>). When placing the scripts,
              use the maximum of the subscript shift for all subscript and
              the maximum of the superscript shift for all superscripts.
            </li>
            <li>
              For the horizontal layout of postscripts, use the trailing edge of the
              base or of the previous pair as the leading edge of the current pair.
              For each pair, apply the same italic correction described for
              <code>&lt;msubsup&gt;</code> in
              <a href="#subscripts-and-superscripts-msub-msup-msubsup"></a>.
              Apply the same italic corrections for all these postscripts.
            </li>
            <li>For the horizontal layout of prescripts, use the leading edge of the
              base or of next pair as the trailing edge of the current pair. Do not apply
              any italic correction for prescripts.
            </li>
          </ol>
          <figure id="figure-box-mmultiscripts">
            <img src="figures/mmultiscriptsbox.svg"/>
            <figcaption>Box model for the <code>&lt;mmultiscripts&gt;</code> element</figcaption>
          </figure>
        </section>
        <section>
          <h4>Displaystyle and scriptlevel</h4>
          <p>
            For all MathML elements used for scripts and limits schemata,
            the first child is the base while the other children
            are scripts. In these scripts, the rule of thumb is to set
            <a><code>displaystyle</code></a> to <code>false</code>
            and to increment <a><code>scriptlevel</code></a>.
            However, when an overscript (respectively underscript)
            has <a><code>accent</code></a> (respectively
            <a><code>accentunder</code></a>)
            that is case-insensitively equal to
            to <code>"true"</code> then
            the <a><code>scriptlevel</code></a> is not incremented.
          </p>
          <p>
            The
            <a href="#user-agent-stylesheet"></a> must contain the following
            style in order to implement this behavior:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/scripts.css"></pre>
          <div class="issue" number="76">
            In [[MathML3]] specification, the scriptlevel shouldn't be
            incremented either if the underscript/overscript is a
            (possibly embellished) operator
            whose <a><code>accent</code></a> property (read from an
            attribute or from the disctionary) is <code>true</code>.
          </div>
        </section>
      </section>
      <section>
        <h3>Tabular Math</h3>
        <p>
          Matrices, arrays and other table-like mathematical notation are marked up
          using
          <a><code>&lt;mtable&gt;</code></a>
          <a><code>&lt;mtr&gt;</code></a>
          <a><code>&lt;mtd&gt;</code></a>
          elements.  These  elements are similar to the
          <a data-cite="HTML#the-table-element"><code>&lt;table&gt;</code></a>,
          <a data-cite="HTML#the-tr-element"><code>&lt;tr&gt;</code></a>
          and
          <a data-cite="HTML#the-td-element"><code>&lt;td&gt;</code></a>
          elements of [[HTML]].
        </p>
        <div class="issue">
          This describes a very partial support for [[MathML3]] tables.
          Do we want more? Should CSS be extended to cover math table's use cases?
        </div>
        <section>
          <h4>Table or Matrix <code>&lt;mtable&gt;</code></h4>
          <p>The <dfn><code>&lt;mtable&gt;</code></dfn> is laid out as an
            <code>inline-table</code> and sets
            <code>displaystyle</code> to <code>false</code>. The
            <a href="#user-agent-stylesheet">user agent stylesheet</a> must contain
            the following rules in order to implement these properties:
          </p>
          <pre data-include="user-agent-stylesheet/mtable.css"></pre>
          <p>
            The <code>&lt;mtable&gt;</code> accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attribute:
            <ul>
              <li><a>frame</a></li>
            </ul>
          <p>
            The <dfn>frame</dfn> attribute, if present, must be case-insensitively
            equal to the value <code>none</code>, <code>solid</code> or
            <code>dashed</code>. The <a href="#user-agent-stylesheet">user agent
              stylesheet</a> must contain the following rules in order to implement
            that attribute:
          </p>
          <pre data-include="user-agent-stylesheet/mtable-frame.css"></pre>
          <div class="issue">TODO: Improve description here and handle the case
            when height &lt; AxisHeight </div>
          <p>
            The size of the logical box of the <code>&lt;mtable&gt;</code>
            are provided by CSS layout. The math axis is aligned with the center of
            the table: Ascent is height plus
            <code class="MATH">AxisHeight</code> and descent the height minus
            <code class="MATH">AxisHeight</code>. The ink box is the same as the
            logical box.
          </p>
        </section>
        <section>
          <h4>Row in Table or Matrix <code>&lt;mtr&gt;</code></h4>
          <p>
            The <dfn><code>&lt;mtr&gt;</code></dfn> is laid out as
            <code>table-row</code>. The
            <a href="#user-agent-stylesheet">user agent stylesheet</a> must contain
            the following rules in order to implement that behavior:
          </p>
          <pre data-include="user-agent-stylesheet/mtr.css"></pre>
          <p>
            The <code>&lt;mtr&gt;</code> accepts the attributes described
            in <a href="#global-attributes"></a>.
          </p>
        </section>
        <section>
          <h4>Entry in Table or Matrix <code>&lt;mtd&gt;</code></h4>
          <p>
            The <dfn><code>&lt;mtd&gt;</code></dfn> is laid out as
            a <code>table-cell</code> with content centered in the cell and
            a default padding. The
            <a href="#user-agent-stylesheet">user agent stylesheet</a> must contain
            the following rules:
          </p>
          <pre data-include="user-agent-stylesheet/mtd.css"></pre>
          <p>
            The <code>&lt;mtr&gt;</code> accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following attributes:
          </p>
          <ul>
            <li><a>columnspan</a></li>
            <li><a>rowspan</a></li>
          </ul>
          <p>
            The <dfn><code>columnspan</code></dfn> (respectively
            <dfn><code>rowspan</code></dfn>) attribute has the same
            syntax and semantic as the
            <a data-cite="HTML#attr-tdth-colspan"><code>&lt;colspan&gt;</code></a>
            (respectively
            <a data-cite="HTML#attr-tdth-rowspan"><code>&lt;rowspan&gt;</code></a>)
            attribute on the <code>&lt;td&gt;</code> element from [[HTML]].
          </p>
          <div class="note">
            The name for the column spanning attribute is
            <code>columnspan</code> as in [[MathML3]] and not
            <code>colspan</code> as in [[HTML]].
          </div>
        </section>
      </section>
      <section>
        <h3>Enlivening Expressions</h3>
        <p>
          Historically, the
          <dfn><code>&lt;maction&gt;</code></dfn>
          element provides a mechanism
          for binding actions to expressions.
        </p>
        <p>
          The <code>&lt;maction&gt;</code> element accepts the attributes described
          in <a href="#global-attributes"></a> as well as the following
          attributes:
        </p>
        <ul>
          <li><code>actiontype</code></li>
          <li><code>selection</code></li>
        </ul>
        <p>
          The <dfn>actiontype</dfn> and <dfn>selection</dfn> attributes are
          not taken into account in the present specification but may be used
          by authors to implement custom actions on the
          <code>&lt;maction&gt;</code> element.
        </p>
        <p>
          The layout algorithm of the <code>&lt;maction&gt;</code> element
          the same as the <code>&lt;mrow&gt;</code> element.
          The <a href="#user-agent-stylesheet">user agent stylesheet</a>
          must contain the following rules in order to hide all but
          its first child, which is the default behavior for the legacy actiontype
          values:
        </p>
        <pre class="css" data-include="user-agent-stylesheet/maction.css"></pre>
        <div class="note">
          While <code>&lt;maction&gt;</code> is preserved for backward compatibility reasons
          with legacy documents and existing tools, modern authors and tools are strongly
          encouraged to use CSS for styling.
        </div>
      </section>
      <section>
        <h3>Semantics and Presentation</h3>
        <p>
          The
          <dfn><code>&lt;semantics&gt;</code></dfn>
          element is the container element that associates
          annotations with a MathML expression. Typically, the
          <code>&lt;semantics&gt;</code> element has as its first child a
          MathML expression to be annotated while subsequent children represent
          text annotations within an <dfn><code>&lt;annotation&gt;</code></dfn>
          element, or more complex markup annotations within
          an <dfn><code>&lt;annotation-xml&gt;</code></dfn> element.
        </p>
        <p>
          The <code>&lt;semantics&gt;</code> element accepts the attributes
          described in <a href="#global-attributes"></a>. Its layout algorithm
          is the same as the <a><code>&lt;mrow&gt;</code></a> element.
          The <a href="#user-agent-stylesheet">user agent stylesheet</a>
          must contain the following rule in order to only render the annotated
          MathML expression:
        </p>
        <pre data-include="user-agent-stylesheet/semantics.css"></pre>
        <p>
          The <code>&lt;annotation-xml&gt;</code> and
          <code>&lt;annotation&gt;</code> element accepts the attributes
          described in <a href="#global-attributes"></a> as well as the
          following attribute:
        </p>
        <ul>
          <li><code>encoding</code></li>
        </ul>
        <p>
          The <dfn>encoding</dfn> attribute is not taken into account in the
          present specification but it is intended to distinguish annotations
          for <a data-cite="HTML#html-integration-point">HTML integration point</a>, clipboard copy, alternative rendering etc
        </p>
        <p>
          The layout algorithm of the <code>&lt;annotation-xml&gt;</code>
          element is the same as the <a><code>&lt;mrow&gt;</code></a> element.
          The layout algorithm of the <code>&lt;annotation&gt;</code>
          element is the same as the <a><code>&lt;mtext&gt;</code></a> element.
        </p>
        <div class="note">
          CSS can be used to render alternative annotations e.g.
          <pre class="css">
            /* Hide the annotated child. */
            semantics > :first-child { display: none; }
             /* Show all text annotations. */
            semantics > annotation { display: block; }
            /* Show all HTML annotations. */
            semantics > annotation-xml[encoding="text/html" i],
            semantics > annotation-xml[encoding="application/xhtml+xml" i] {
              display: block;
            }
          </pre>
        </div>
      </section>
    </section>
    <section class="normative">
      <h2>CSS Extensions for Math Layout</h2>
      <section>
        <h3>New <code>text-transform</code> values</h3>
        <p>The <dfn><code>text-transform</code></dfn> property
          from
          is extended with new values:
        </p>
        <code><a data-cite="CSS-TEXT-3#text-transform-property">&lt;text-transform-old&gt;</a> <a data-cite="CSS-VALUES-3#comb-one">|</a> math-auto | math-bold | math-italic | math-bold-italic | math-double-struck | math-bold-fraktur | math-script | math-bold-script | math-fraktur | math-sans-serif | math-bold-sans-serif | math-sans-serif-italic | math-sans-serif-bold-italic | math-monospace | math-initial | math-tailed | math-looped | math-stretched</code>
        <p>
          On text nodes containing a unique character, <code>math-auto</code> has
          the same effect as <code>math-italic</code>, otherwise it has no effects.
        </p>
        <p>
          For all the other <code>math-...</code> values, the transformed text is
          obtained by performing conversion of each character that have
          <a href="#mathvariant-mappings">a mapping for the specified
            <code>math-variant</code> value</a>.
        </p>
        <p>
          User agents may decide to rely on italic, bold and bold-italic
          font-level properties when available fonts lack the proper glyphs to
          perform <code>math-auto</code>, <code>math-italic</code>,
          <code>math-bold</code>, <code>math-bold-italic</code> character-level
          transforms.
        </p>
      </section>
      <section>
        <h3>The <code>math-style</code> property</h3>
        <table>
          <tbody>
            <tr>
              <th>Name:</th>
              <td>
                <dfn><code>math-style</code></dfn>
              </td>
            </tr>
            <tr><th>Value:</th><td><code>display | inline</code></td></tr>
            <tr><th>Initial:</th><td><code>inline</code></td></tr>
            <tr><th>Applies to:</th><td>All elements</td></tr>
            <tr><th>Inherited:</th><td>yes</td></tr>
            <tr><th>Percentages:</th><td>n/a</td></tr>
            <tr><th>Media:</th><td>visual</td></tr>
            <tr><th>Computed value:</th><td>specified keyword</td></tr>
            <tr><th>Canonical order:</th><td>n/a</td></tr>
            <tr><th>Animation type:</th><td>not animatable</td></tr>
          </tbody>
        </table>
        <p>
          If the value of <code>math-style</code> is <code>inline</code>, the math
          layout on descendants should try to minimize the
          <a data-cite="CSS-WRITING-MODES-3#extent">logical height</a>.
          This includes how
          <a data-cite="CSS-FONTS-3#font-size-prop"><code>font-size</code></a>
          is changed when <a><code>math-script-level</code></a> is
          <code>auto</code> as well
          miscelleanous layout rules described in details in
          <a href="#presentation-markup"></a>.
          If the value of <code>math-style</code> is <code>display</code>, the math
          layout should not take such constraints into consideration.
        </p>
      </section>
      <section>
        <h3>The <code>math-script-level</code> property</h3>
        <table>
          <tbody>
            <tr>
              <th>Name:</th>
              <td>
                <dfn><code>math-script-level</code></dfn>
              </td>
            </tr>
            <tr><th>Value:</th><td><code>auto | add(&lt;integer&gt;) | &lt;integer&gt;</code></td></tr>
            <tr><th>Initial:</th><td><code>0</code></td></tr>
            <tr><th>Applies to:</th><td>All elements</td></tr>
            <tr><th>Inherited:</th><td>yes</td></tr>
            <tr><th>Percentages:</th><td>n/a</td></tr>
            <tr><th>Media:</th><td>visual</td></tr>
            <tr><th>Computed value:</th><td>see individual properties</td></tr>
            <tr><th>Canonical order:</th><td>n/a</td></tr>
            <tr><th>Animation type:</th><td>not animatable</td></tr>
          </tbody>
        </table>
        <p>
          If the specified value of <code>math-script-level</code> is
          <code>auto</code> and the inherited value of <code>math-style</code> is
          <code>display</code> then the computed value of
          <code>math-script-level</code> is the inherited value.
        </p>
        <p>If the specified value of <code>math-script-level</code> is
          <code>auto</code> and the inherited value of <code>math-style</code> is
          <code>inline</code> then the computed value of
          <code>math-script-level</code> is the inherited value plus one.
        </p>
        <p>
          If the specified value of <code>math-script-level</code> is of the form
          <code>add(&lt;integer&gt;)</code> then the computed value of
          <code>math-script-level</code> is the inherited value plus the specified
          integer.
        </p>
        <p>
          If the specified value of <code>math-script-level</code> is of the form
          <code>&lt;integer&gt;</code> then the computed value of
          <code>math-script-level</code> is set to the specified integer.
        </p>
        <p>
          If
          <a data-cite="CSS-FONTS-3#font-size-prop"><code>font-size</code></a>
          is specified or if the specified value of
          <code>math-script-level</code> is <code>initial</code> then
          <code>math-script-level</code> does not affect the computed value of
          <code>font-size</code>. Otherwise, the computed value of
          <code>font-size</code> is obtained by multiplying the inherited value of
          <code>font-size</code> by a nonzero scale factor calculated by the
          following procedure:
        </p>
        <ol>
          <li>Let A be the inherited <code>math-script-level</code>, B the computed
            <code>math-script-level</code>, C be 0.71 and S be 1.0</li>
          <li>
            <ul>
              <li>If A = B then return S.</li>
              <li>If B &lt; A, swap A and B and set <code>InvertScaleFactor</code> to true.</li>
              <li>Otherwise B &gt; A and set <code>InvertScaleFactor</code> to false.</li>
            </ul>
          </li>
          <li>Let E be B - A &gt; 0.</li>
          <li>If the inherited font has an OpenType MATH table:
            <ul>
              <li>Read <code class="MATH">scriptPercentScaleDown</code> and fallback to C if the MathVariants table is absent or provides a null value.</li>
              <li>Read <code class="MATH">scriptScriptPercentScaleDown</code> and fallback to C<sup>2</sup> if the MathVariants table is absent or provides a null value.</li>
              <li>If A ≤ 0 and B ≥ 2 then multiply S by <code class="MATH">scriptScriptPercentScaleDown</code> and
                decrement E by 2.</li>
              <li>Otherwise if A = 1 then multiply S by
                <code class="MATH">scriptScriptPercentScaleDown</code> / <code class="MATH">scriptPercentScaleDown</code> and
                decrement E by 1.</li>
              <li>Otherwise if B = 1 then multiply S by <code class="MATH">scriptPercentScaleDown</code>
                and decrement E by 1.</li>
            </ul>
          </li>
          <li>Multiply S by C<sup>E</sup></li>
          <li>Return S if <code>InvertScaleFactor</code> is false and 1/S otherwise.</li>
        </ol>
      </section>
    </section>
    <section class="normative">
      <h2>OpenType MATH</h2>
      <div class="issue" gh-number="69">Define fallback values</div>
      <p>
        User agents must be able to read information from the
        OpenType MATH table [[OPEN-FONT-FORMAT]].
        In particular they must be able to read the values from the
        <code class="MATH">MathConstants</code> subtable.
        They must also be able to use the <code class="MATH">MathVariants</code> subtable
        to solve the following problem: given a particular default glyph shape and a
        certain width or height, find a variant shape glyph (or a construct created by
        putting several glyphs together) that has the required measurement.
        More information are provided in
        <a href="operator-fence-separator-or-accent-mo"></a>.
      </p>
      <div class="issue">Describe stretchy algo
        http://frederic-wang.fr/opentype-math-in-harfbuzz.html
      </div>
    </section>
    <section class="appendix informative">
      <h2>RelaxNG</h2>
      <p>
        This section displays a non-normative Relax NG Schema which
        details the elements and attributes defined by this specification.
        Note that MathML does not need to be expressed in XML syntax, in
        particular the syntax defined by HTML may be used. However this
        schema may be taken as an informal specification of the structure,
        whatever syntax is used.
      </p>
      <pre data-include="mathml-core.rnc"></pre>
    </section>
    <section class="appendix normative">
      <h2>User Agent Stylesheet</h2>
      <pre class="css">@namespace url(http://www.w3.org/1998/Math/MathML);

/* Links */
<span data-include-replace="true" data-include="user-agent-stylesheet/links.css"></span>
/* The &lt;math&gt; element */
<span data-include-replace="true" data-include="user-agent-stylesheet/math.css"></span>
/* &lt;mrow&gt;-like elements */
<span data-include-replace="true" data-include="user-agent-stylesheet/semantics.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/maction.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/merror.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mphantom.css"></span>
/* Tables */
<span data-include-replace="true" data-include="user-agent-stylesheet/mtable.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mtable-frame.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mtr.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mtd.css"></span>
/* Other rules for scriptlevel and displastyle */
<span data-include-replace="true" data-include="user-agent-stylesheet/displaystyle.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mfrac.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mroot.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/scripts.css"></span>
      </pre>
    </section>
    <section class="normative">
      <h2>Operator Dictionary</h2>
      <section>
        <h3>Description</h3>
        <p>
          Users agent must use a dictionary of rendering properties for MathML
          operators. The dictionary must include at least the entries of the
          table provided in <a href="#operator-dictionary-entries"></a>.
        </p>
        <p>
          The dictionary is indexed by 'Content' and 'Form' columns together.
          <a href="#operator-fence-separator-or-accent-mo"></a>
          describes how to determine these values for a given operator.
          The 'Rendering' and 'Unicode' columns are provided for convenience,
          but they are just alternative to the 'Content' column.
        </p>
        <p>
          The 'Priority' column is significant for the proper grouping of
          sub-expressions using <code>&lt;mrow&gt;</code>. This is especially
          relevant to the automatic generation of MathML by conversion from
          other formats for displayed mathematics, such as T<sub>E</sub>X,
          which do not always specify how sub-expressions nest.
          However, it does not affect the rendering described in this
          specification and so is not needed for implementing it in user agents.
        </p>
        <p>
          The length valued attributes <a><code>lspace</code></a> and
          <a><code>rspace</code></a> are given here as numeric values ranging
          from 0 to 7 in order to save space in the table. They must be
          interpreted as multiples of 1/18em i.e.
          <code>0</code>,
          <code>0.05555555555555555em</code>,
          <code>0.1111111111111111em</code>,
          <code>0.16666666666666666em</code>,
          <code>0.2222222222222222em</code>,
          <code>0.2777777777777778em</code>,
          <code>0.3333333333333333em</code>,
          <code>0.3888888888888889em</code> respectively.
        </p>
        <p>
          Boolean valued attributes such as <a><code>stretchy</code></a> are
          specified together in the final 'Properties' column by listing the
          attribute name if its value should be set to true by the dictionary.
        </p>
      </section>
      <section>
        <h3>Operator dictionary entries</h3>
        <div data-include="tables/operator-dictionary.html"></div>
      </section>
    </section>
    <section>
      <h2>MathML Combining Character Equivalences</h2>
      <p>
        The following table gives mappings between spacing and non spacing
        characters when used in MathML accent constructs.
      </p>
      <div data-include="tables/combining-operators.html"></div>
    </section>
    <section>
      <h3>Mathvariant Mappings</h3>
      <div data-include="tables/mathvariants.html"></div>
    </section>
    <section class="appendix normative">
      <h2>Conformance</h2>
      <section>
        <h3>Document conventions</h3>
        <p>
          Conformance requirements are expressed with a combination of
          descriptive assertions and RFC 2119 terminology. The key words “MUST”,
          “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
          “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
          document are to be interpreted as described in RFC 2119.
          However, for readability, these words do not appear in all uppercase
          letters in this specification.
        </p>
        <p>
          All of the text of this specification is normative except sections
          explicitly marked as non-normative, examples, and notes.
          [[RFC2119]].
        </p>
        <p>
          Examples in this specification are introduced with the words
          “for example” or are set apart from the normative text with
          <code>class="example"</code>, like this:
        </p>
        <div class="example">
          <p>
            This is an example of an informative example.
          </p>
        </div>
        <p>
          Informative notes begin with the word “Note” and are set apart from
          the normative text with <code>class="note"</code>, like this:
        </p>
        <p class="note">
          Note, this is an informative note.
        </p>
        <p>
          Advisements are normative sections styled to evoke special attention
          and are set apart from other normative text with
          <code>&lt;strong class="advisement"&gt;</code>, like this:
          <strong class="advisement">UAs MUST provide an accessible alternative. </strong>
        </p>
        <p>
          Definitions taken the MATH specification of [[OPEN-FONT-FORMAT]]
          are written with the following style:
          <code class="MATH">MyMathTableParameter</code>.
        </p>
      </section>
    </section>
  </body>
</html>
