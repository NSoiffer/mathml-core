<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>MathML Core</title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common"
            class="remove"></script>
    <script src="tables/sorttable.js"></script>
    <script class="remove">
      var respecConfig = {
          specStatus: "ED",
          editors: [{
              name: "David Carlisle",
              url: "https://davidcarlisle.github.io/dcarlisle/david/",
              company: "NAG"
          }, {
              name: "Frédéric Wang",
              url: "http://frederic-wang.fr",
              company: "Igalia"
          }],
          wg: "MathML Refresh Community Group",
          wgURI: "https://www.w3.org/community/mathml4/",
          edDraftURI: "https://mathml-refresh.github.io/mathml-core/",
          shortName: "mathml-core",
          testSuiteURI: "https://w3c-test.org/mathml/",
          issueBase: "https://github.com/mathml-refresh/mathml/issues/",
          implementationReportURI: "https://build-chromium.igalia.com/mathml/wpt/summary.html",
          otherLinks: [{
              key: "Participate",
              data: [{
                  value: 'MathML Refresh CG',
                  href: 'https://www.w3.org/community/mathml4/'
              }, {
                  value: 'GitHub mathml-refresh/mathml',
                  href: 'https://github.com/mathml-refresh/mathml/'
              }, {
                  value: 'GitHub mathml-refresh/mathml-core',
                  href: 'https://github.com/mathml-refresh/mathml-core/'
              }, {
                  value: 'File a bug',
                  href: 'https://github.com/mathml-refresh/mathml/issues'
              }, {
                  value: 'Commit History',
                  href: 'https://github.com/mathml-refresh/mathml-core/commits/gh-pages'
              }, {
                  value: 'Pull requests',
                  href: 'https://github.com/mathml-refresh/mathml-core/pulls/'
              }]
          }],
          localBiblio: {
              "MATHML4": {
                  title: "Mathematical Markup Language (MathML) Version 4.0",
                  authors: [
                      "David Carlisle et al."
                  ],
                  status: "WD",
                  href: "https://mathml-refresh.github.io/mathml/"
              },
              "TEXBOOK": {
                  title: "The TeXBook",
                  date: "1984",
                  authors: [
                      "Knuth, Donald E."
                  ],
                  publisher: "Addison-Wesley Professional",
                  id: "ISBN9780201134483"
              },
              "OPEN-TYPE-MATH-ILLUMINATED": {
                  title: "OpenType Math Illuminated",
                  date: "2009",
                  authors: [
                      "Ulrik Vieth"
                  ],
                  href: "http://www.tug.org/TUGboat/tb30-1/tb94vieth.pdf",
              },
              "OPEN-TYPE-MATH-IN-HARFBUZZ": {
                  title: "OpenType MATH in HarfBuzz",
                  authors: [
                      "Frédéric Wang"
                  ],
                  href: "http://frederic-wang.fr/opentype-math-in-harfbuzz.html"
              }
          },
          postProcess: [sorttable.init]
      };
    </script>
  </head>
  <body>
    <section id="abstract">
      <p>
        This specification defines a core subset of Mathematical Markup
        Language, or MathML, that is suitable for browser implementation.
        MathML is a markup language for describing mathematical notation
        and capturing both its structure and content. The goal of MathML is to
        enable mathematics to be served, received, and processed on the World
        Wide Web, just as HTML has enabled this functionality for text.
      </p>
    </section>
    <section id="sotd">
      <p>
        This is a public copy of the editors’ draft. It is provided for
        discussion only and may change at any moment. Its publication here does
        not imply endorsement of its contents by W3C. Don’t cite this document
        other than as work in progress.
      </p>
    </section>
    <section class="informative">
      <h2>Introduction</h2>
      <p>
        The [[MATHML3]] specification has several shortcomings that make it
        hard to implement consistently across web rendering engines or to
        extend with user-defined constructions e.g.
      </p>
      <ul>
        <li>It is a huge and standalone specification.</li>
        <li>It does not contain any detailed rendering rules.</li>
        <li>It is not driven by browser-implementation.</li>
        <li>It lacks automated testing.</li>
      </ul>
      <p>
        This MathML Core specification intends to address these issues by
        being as accurate as possible on the visual rendering of mathematical
        formulas using additional rules from the TeXBook’s Appendix G
        [[?TEXBOOK]] and from the Open Font Format [[OPEN-FONT-FORMAT]],
        [[OPEN-TYPE-MATH-ILLUMINATED]]. It also relies on modern browser
        implementations and web technologies [[HTML]] clarifying interactions
        with them when needed or introducing new low-level primitives to
        improve the web platform layering. Parts of MathML 3 that do not
        fit well in this framework or are rarely used in practice have been
        omitted. Instead, they are described in a separate and larger
        [[MATHML4]] specification.
      </p>
      <p>
        By increasing the level of implementation details, focusing on a
        workable subset, following a browser-driven design and relying on
        automated web platform tests, this specification is expected to
        greatly improve MathML interoperability. Moreover, effort on MathML
        layering will enable users to implement the rest of the MathML 4
        specification, or more generally to extend MathML Core, using
        polyfills or converters.
      </p>
    </section>
    <section class="normative">
      <h2>MathML Fundamentals</h2>
      <section>
        <h3>Integration in the Web Platform</h3>
        <section>
          <h4>HTML and SVG</h4>
          <p>
            When
            <a data-cite="HTML#parsing">parsing HTML documents</a>
            user agents must treat any of the following
            <dfn>MathML Core elements</dfn> as belonging to the
            <a data-cite="INFRA#mathml-namespace">MathML namespace</a>:
          </p>
          <ol>
            <li><a>&lt;annotation&gt;</a></li>
            <li><a>&lt;annotation-xml&gt;</a></li>
            <li><a>&lt;maction&gt;</a></li>
            <li><a>&lt;math&gt;</a></li>
            <li><a>&lt;menclose&gt;</a></li>
            <li><a>&lt;merror&gt;</a></li>
            <li><a>&lt;mfrac&gt;</a></li>
            <li><a>&lt;mi&gt;</a></li>
            <li><a>&lt;mmultiscripts&gt;</a></li>
            <li><a>&lt;mn&gt;</a></li>
            <li><a>&lt;mo&gt;</a></li>
            <li><a>&lt;mover&gt;</a></li>
            <li><a>&lt;mpadded&gt;</a></li>
            <li><a>&lt;mphantom&gt;</a></li>
            <li><a>&lt;mprescripts&gt;</a></li>
            <li><a>&lt;mroot&gt;</a></li>
            <li><a>&lt;mrow&gt;</a></li>
            <li><a>&lt;ms&gt;</a></li>
            <li><a>&lt;mspace&gt;</a></li>
            <li><a>&lt;msqrt&gt;</a></li>
            <li><a>&lt;mstyle&gt;</a></li>
            <li><a>&lt;msub&gt;</a></li>
            <li><a>&lt;msubsup&gt;</a></li>
            <li><a>&lt;msup&gt;</a></li>
            <li><a>&lt;mtable&gt;</a></li>
            <li><a>&lt;mtd&gt;</a></li>
            <li><a>&lt;mtext&gt;</a></li>
            <li><a>&lt;mtr&gt;</a></li>
            <li><a>&lt;munder&gt;</a></li>
            <li><a>&lt;munderover&gt;</a></li>
            <li><a>&lt;none&gt;</a></li>
            <li><a>&lt;semantics&gt;</a></li>
          </ol>
          <p>
            Users agents must allow mixing HTML, SVG and MathML elements
            as allowed by sections
            <a data-cite="HTML#html-integration-point">HTML integration point</a>,
            <a data-cite="HTML#mathml-text-integration-point">MathML integration point</a>,
            <a data-cite="HTML#tree-construction-dispatcher">tree construction
              dispatcher</a>,
            <a data-cite="HTML#mathml">MathML</a> and
            <a data-cite="HTML#svg-0">SVG</a>
            from [[HTML]].
          </p>
          <p>
            When evaluating the SVG
            <a data-cite="SVG#RequiredExtensionsAttribute"><code>requiredExtensions</code></a>
            attribute, user agents must claim support for the language extension
            identified by the
            <a data-cite="INFRA#mathml-namespace">MathML namespace</a>.
          </p>
          <div class="note">
            <ul>
              <li>
                The <code>&lt;math&gt;</code> element can be used at
                position permitted for
                <a data-cite="HTML#flow-content-2">flow content</a>
                (e.g. a
                <a data-cite="SVG#ForeignObjectElement"><code>&lt;foreignObject&gt;</code></a> element)
                or <a data-cite="HTML#phrasing-content-2">phrasing content</a>.
              </li>
              <li>
                Any
                <a data-cite="HTML#phrasing-content-2">phrasing content</a>
                can be used inside
                <a><code>&lt;mi&gt;</code></a>,
                <a><code>&lt;mo&gt;</code></a>,
                <a><code>&lt;mn&gt;</code></a>,
                <a><code>&lt;ms&gt;</code></a> and
                <a><code>&lt;mtext&gt;</code></a>
                elements.
              </li>
              <li>
                The <code>&lt;svg&gt;</code> element can be used inside
                <a><code>&lt;annotation-xml&gt;</code></a> elements.
              </li>
              <li>
                Any <a data-cite="HTML#flow-content-2">flow content</a>
                can be used inside
                <a><code>&lt;annotation-xml&gt;</code></a> elements with
                encoding
                <code>application/xhtml+xml</code> or <code>text/html</code>.
              </li>
            </ul>
          </div>
        </section>
        <section>
          <h4>CSS styling</h4>
          <p>User agents must support various CSS features mentioned in this
            specification, including new ones described in
            <a href="#css-extensions-for-math-layout"></a>.</p>
          <p>
            All documents containing <a>MathML Core elements</a> must include
            CSS rules described in <a href="#user-agent-stylesheet"></a>
            as part of user-agent level style sheet defaults.
            Rules relying on universal selectors such as
            <code>mfrac > *</code> or <code>msub > :not(:first-child)</code> may
            be replaced with equivalent expanded rules listing all possible
            <a>MathML Core elements</a>.
          </p>
        </section>
        <section>
          <h4>DOM and Javascript</h4>
          <p>
            User agents supporting
            <a data-cite="HTML#webappapis">Web application APIs</a>
            must ensure that they keep the visual rendering of MathML
            in synchronization with the [[DOM]] tree.
          </p>
          <div class="issue" data-number="83">Properly define DOM/IDL relationships.</div>
          <p>
            All the nodes representing <a>MathML Core elements</a> in the DOM
            must and expose to scripts, the following
            <dfn><code>MathMLElement</code></dfn> interface.
          </p>
          <pre class="idl" data-include="webidl/MathMLElement.idl"></pre>
          <p>The
            <dfn data-cite="HTML#globaleventhandlers"><code>GlobalEventHandlers</code></dfn>,
            <dfn data-cite="HTML#documentandelementeventhandlers"><code>DocumentAndElementEventHandlers</code></dfn> and
            <dfn data-cite="HTML#htmlorsvgelement"><code>HTMLOrSVGElement</code></dfn> interfaces are defined in
            [[HTML]].</p>
          <p>The
            <dfn data-cite="CSSOM#elementcssinlinestyle"><code>ElementCSSInlineStyle</code></dfn>
            interface is defined in [[CSSOM]].
          </p>
        </section>
        <section>
          <h4>Text layout</h4>
          <p data-tests="relations/text-and-math/use-typo-metrics-1.html">
            Because math fonts generally contain very tall glyphs such as big
            integrals, using typographic metrics is important to avoid
            excessive line spacing of text. As a consequence,
            user agents must take into account the USE_TYPO_METRICS flag from
            the OS/2 table [[OPEN-FONT-FORMAT]] when performing text layout.
          </p>
        </section>
      </section>
      <section>
        <h3>Types for MathML Attribute Values</h3>
        <dl>
          <dt><dfn>unsigned-integer</dfn></dt>
          <dd>An
            <a data-cite="CSS-VALUES-3#integer-value"><code>&lt;integer-value&gt;</code></a> value as defined in
            [[CSS-VALUES-3]], whose first character is neither
            U+002D HYPHEN-MINUS character (-) nor
            U+002B PLUS SIGN (+).
          </dd>
        </dl>
        <dl>
          <dt><dfn>unsigned-number</dfn></dt>
          <dd>A
            <a data-cite="CSS-VALUES-3#number-value"><code>&lt;number-value&gt;</code></a> value as defined in
            [[CSS-VALUES-3]], whose first character is neither
            U+002D HYPHEN-MINUS character (-) nor
            U+002B PLUS SIGN (+).
          </dd>
        </dl>
        <dl>
          <dt><dfn>length-percentage</dfn></dt>
          <dd>A
            <a data-cite="CSS-VALUES-3#typedef-length-percentage"><code>&lt;length-percentage&gt;</code></a>
            value as defined in
            [[CSS-VALUES-3]]
          </dd>
        </dl>
        <dl>
          <dt><dfn>unsigned-length-percentage</dfn></dt>
          <dd>A
            <a><code>length-percentage</code></a>
            whose first character is neither
            U+002D HYPHEN-MINUS character (-) nor
            U+002B PLUS SIGN (+).
          </dd>
        </dl>
        <dl>
          <dt><dfn>color</dfn></dt>
          <dd>A
            <a data-cite="CSS-COLOR-3#colorunits"><code>&lt;color&gt;</code></a>
            value as defined in [[CSS-COLOR-3]]
          </dd>
        </dl>
        <dl>
          <dt><dfn>boolean</dfn></dt>
          <dd>A string that is case-insensitively equal to <code>true</code> or
            <code>false</code>.
          </dd>
        </dl>
      </section>
      <section>
        <h3>Global Attributes</h3>
        <p>
          The following attributes are common to and may be specified on all MathML
          elements:
        </p>
        <ul>
          <li><a>id</a></li>
          <li><a>class</a></li>
          <li><a><code>style</code></a></li>
          <li><a><code>href</code></a></li>
          <li><a><code>dir</code></a></li>
          <li><a><code>mathbackground</code></a></li>
          <li><a><code>mathcolor</code></a></li>
          <li><a><code>mathsize</code></a></li>
          <li><a><code>mathvariant</code></a></li>
          <li><a><code>displaystyle</code></a></li>
          <li><a><code>scriptlevel</code></a></li>
        </ul>
        <section>
          <h4>Attributes common to HTML and MathML elements</h4>
          <p>
            The
            <dfn><code>id</code></dfn>,
            <dfn><code>class</code></dfn>,
            <dfn><code>style</code></dfn>,
            attributes have the same syntax and semantic as defined for
            <a data-cite="HTML#the-id-attribute">id</a>,
            <a data-cite="HTML#classes">class</a> and
            <a data-cite="HTML#the-style-attribute">style</a> attributes on
            HTML elements.
          </p>
          <p>
            The
            <dfn><code>href</code></dfn>
            attribute has the syntax and semantic as defined for
            the <a data-cite="HTML#attr-hyperlink-href">href</a> attribute on
            <code>&lt;a&gt;</code> element.
            To fully implement this attribute, the following CSS properties for
            links must be specified in the
            <a href="#user-agent-stylesheet">user agent stylesheet</a>:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/links.css"></pre>
          <p>
            The
            <dfn><code>dir</code></dfn>
            attribute, if present,
            must be case-insensitively equal to the
            value <code>ltr</code> or <code>ltr</code>.
            It is mapped to the
            <a data-cite="CSS-WRITING-MODES-3#direction"><code>direction</code></a>
            CSS property.
            This attribute is used to set the directionality of math formulas, which is
            often <code>rtl</code> in Arabic speaking world.
          </p>
        </section>
        <section>
          <h4>Legacy MathML Style Attributes</h4>
          <p>
            The
            <dfn><code>mathcolor</code></dfn>
            and
            <dfn><code>mathbackground</code></dfn>
            attributes, if present, must
            have a value that is a <a>color</a>.
            The <code>mathcolor</code> property describes the foreground fill color of
            an MathML text, bars etc and the background color of an element.
            They are mapped to the
            <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a> and
            <a data-cite="CSS-BACKGROUNDS-3#the-background-color"><code>background-color</code></a> CSS properties.
          </p>
          <p>
            The
            <dfn><code>mathsize</code></dfn>
            attribute, if present, must
            have a value that is a valid <a>length-percentage</a>.
            The <code>mathsize</code> property indicates indicates the desired height
            of glyphs in math formulas but also scale other parts (spacing, shifts,
            line thickness of bars etc) accordingly.
            Is is mapped to the CSS property
            <a data-cite="CSS-FONTS-3#font-size-prop"><code>font-size</code></a>
            and the <code>mathsize</code> values are interpreted according to the
            definition in [[CSS-FONTS-3]].
          </p>
          <div class="note">
            While the above attributes are preserved for backward compatibility reasons
            with legacy documents and existing tools, modern authors and tools are strongly
            encouraged to use CSS for styling.
          </div>
        </section>
        <section>
          <h4>The <code>mathvariant</code> attribute</h4>
          <p>
            The
            <dfn><code>mathvariant</code></dfn>
            attribute,
            if present, must have a value that is case-insensitively equal to
            one of
            <code>normal</code>,
            <code>bold</code>,
            <code>italic</code>,
            <code>bold-italic</code>,
            <code>double-struck</code>,
            <code>bold-fraktur</code>,
            <code>script</code>,
            <code>bold-script</code>,
            <code>fraktur</code>,
            <code>sans-serif</code>,
            <code>bold-sans-serif</code>,
            <code>sans-serif-italic</code>,
            <code>sans-serif-bold-italic</code>,
            <code>monospace</code>,
            <code>initial</code>,
            <code>tailed</code>,
            <code>looped</code>,
            <code>stretched</code>.
          </p>
          <p>
            The <code>mathvariant</code> attribute defines logical classes of token
            elements. Each class provides a collection of typographically-related
            symbolic tokens with specific meaning within a given mathematical
            expression.
            For <code>mathvariant</code> values other than <code>normal</code>,
            this is done by using glyphs of
            Unicode's Mathematical Alphanumeric Symbols.
          </p>
          <p>
            Hence, the <code>mathvariant</code> attribute
            is mapped to new values of the CSS property
            <a><code>text-transform</code></a>.
            More precisely, <code>normal</code> is mapped to <code>none</code>
            while all the other values the corresponding CSS value with the extra
            <code>math-</code> prefix.
          </p>
          <div class="note">
            While <code>mathvariant</code> values other than <code>normal</code>
            are preserved for backward compatibility reasons with legacy
            documents and existing tools, modern authors and tools are strongly
            encouraged to just use the corresponding Unicode characters.
            The <code>normal</code> value is still important to cancel automatic
            italic of the <a><code>&lt;mi&gt;</code></a> element.
          </div>
          <div class="issue" data-number="61">
            Consider a new script style to distinguish Chancery and Spencerian?
          </div>
          <div class="note">
            Unicode does not distinguish between Chancery and Spencerian style
            for the Unicode MATHEMATICAL SCRIPT characters. However, some
            mathematical fonts rely on <code>salt</code> or
            <code>ssXY</code> properties from [[OPEN-FONT-FORMAT]]
            to provide both styles. Page authors may use the
            <a data-cite="CSS-FONTS-4#font-variant-alternates-prop"><code>font-variant-alternates</code></a> property with corresponding OpenType font features
            to access these glyphs.
          </div>
        </section>
        <section>
          <h4>The <code>displaystyle</code> and <code>scriptlevel</code> attributes</h4>
          <p>
            The
            <dfn><code>displaystyle</code></dfn>
            attribute, if present, must have a value that is a <a>boolean</a>.
            It is mapped to the CSS property <a><code>math-style</code></a>.
            More precisely,  <code>true</code> is mapped to <code>display</code> and
            <code>false</code> to  <code>inline</code>.
            This attribute indicate whether formulas should try to minimize
            the logical height (value is <code>false</code>) or not
            (value is <code>true</code>) e.g. by changing the size of content or
            the layout of scripts.
          </p>
          <p>
            The
            <dfn><code>scriptlevel</code></dfn>
            attribute, if present, must have value
            <code>+&lt;U&gt;</code>, <code>-&lt;U&gt;</code> or <code>&lt;U&gt;</code>
            where <code>&lt;U&gt;</code> is an
            <a>unsigned-integer</a>.
            It is mapped to the <a><code>math-script-level</code></a>.
            More precisely,
            <code>+&lt;U&gt;</code>, <code>-&lt;U&gt;</code> and
            <code>&lt;U&gt;</code>
            are respectively mapped to
            <code>add(&lt;U&gt;)</code>
            <code>add(&lt;-U&gt;)</code>
            and <code>&lt;U&gt;</code>.
          </p>
          <p>
            <code>displaystyle</code> and <code>scriptlevel</code> values
            are automatically adjusted within MathML elements.
            To fully implement these attributes, additional CSS properties must be
            specified in the user agent stylesheet
            as described in <a href="#user-agent-stylesheet"></a>.
          </p>
          <div class="note">
            T<sub>E</sub>X's <code>\displaystyle</code>, <code>\textstyle</code>,
            <code>\scriptstyle</code>, and <code>\scriptscriptstyle</code> correspond
            to <code>displaystyle</code> and <code>scriptlevel</code> as
            <code>true</code> and <code>0</code>,
            <code>false</code> and <code>0</code>,
            <code>false</code> and <code>1</code>,
            and <code>false</code> and 2, respectively.
          </div>
          <div class="issue">
            Do we actually need these rules?
            What about <code>scriptlevel</code>?
            <pre class="css" data-include="user-agent-stylesheet/displaystyle.css"></pre>
          </div>
        </section>
      </section>
      <section>
        <h3>The Top-Level <code>&lt;math&gt;</code> Element</h3>
        <p>MathML specifies a single top-level or root
          <dfn><code>&lt;math&gt;</code></dfn> element, which encapsulates each
          instance of MathML markup within a document. All other MathML content
          must be contained in a <code>&lt;math&gt;</code> element.
        </p>
        <p>
          The <code>&lt;math&gt;</code>
          element accepts the attributes described
          in <a href="#global-attributes"></a> as well as the
          following attribute:
        </p>
        <ul>
          <li><a>display</a></li>
        </ul>
        <p>
          The
          <dfn><code>display</code></dfn>
          attribute, if present,
          must have value <code>block</code> or <code>inline</code>.
          To fully implement this attribute, additional CSS properties must be
          specified in the user agent stylesheet
          as described in <a href="#user-agent-stylesheet"></a>.
        </p>
        <p>
          The layout algorithm of the <code>&lt;math&gt;</code> element
          is the same as the <code>&lt;mrow&gt;</code> element. User agents must
          ensure correct baseline alignment, centering, sizing etc of the
          <code>&lt;math&gt;</code> element.
        </p>
        <div class="note">
          T<sub>E</sub>X's display mode <code>$...$</code>
          and inline mode <code>$...$</code> correspond to
          <code>display="block"</code> and <code>display="inline"</code>
          respectively.
        </div>
      </section>
    </section>
    <section class="normative">
      <h2>Presentation Markup</h2>
      <section>
        <h3>Introduction</h3>
        <section>
          <h4>Box Model</h4>
          <div class="issue" data-number="15">Interoperable handling of invalid markup</div>
          <p>
            User agents must also follow the rules described in section 4.7.14
            Embedded content, MathML of [[HTML]], in particular the equivalence with
            implicit <code>&lt;mtext&gt;</code> and <code>&lt;merror&gt;</code> to handle non-conforming MathML markup.
          </p>
          <p>
            MathML elements have the following box model. The <code>&lt;math&gt;</code> root may have
            inline or block display, as suggested in
            <a href="#user-agent-stylesheet"></a>.
            Tabular MathML elements have table, table-row and
            table-cell display as discussed in
            <a href="#tabular-math"></a>.
            The <code>&lt;math&gt;</code> and <code>&lt;mtd&gt;</code> elements
            generate an anonymous <code>&lt;mrow&gt;</code> MathML box child that contains the boxes of
            their children and use the box parameters below to layout this anonymous
            <code>&lt;mrow&gt;</code> box.
            No line breaking can happen within MathML boxes and the min-content width is
            equal to the max-content width, these are simply called the intrinsic width.
            Each MathML box has the following parameters:
          </p>
          <ol>
            <li>intrinsic width W.</li>
            <li>logical width w, ascent above the origin a and descent below the origin b. The height is then a + b.</li>
            <li>ink ascent A and descent B, corresponding to the exact box enclosing ink of text and bars within the MathML box.</li>
          </ol>
          <figure id="box-model-generic">
            <img src="figures/boxmodel.svg"/>
            <figcaption>Generic Box Model for MathML elements</figcaption>
          </figure>
          <p>
            For a MathML element containing only text nodes or foreign elements,
            the content is simple enough to determine these values. For example,
            in most cases, this is just a single text node and w = W.
            A MathML element containing only other MathML elements follows special rules to
            layout their children at position
            (x<sub>i</sub>, y<sub>i</sub>) with parameters
            W<sub>i</sub>, w<sub>i</sub>, a<sub>i</sub>, b<sub>i</sub>, A<sub>i</sub>,
            B<sub>i</sub>. Then, as a general rule, its box parameters are given
            by taking the union of child boxes, that is:
          </p>
          <p>
            w = max<sub>1 ≤ i ≤ n</sub> (x<sub>i</sub> + w<sub>i</sub>) −
            max<sub>1 ≤ i ≤ n</sub> x<sub>i</sub>
          </p>
          <p>
            W = max<sub>1 ≤ i ≤ n</sub> (x<sub>i</sub> + W<sub>i</sub>) −
            max<sub>1 ≤ i ≤ n</sub> x<sub>i</sub>
          </p>
          <p>
            a = max<sub>1 ≤ i ≤ n</sub> (a<sub>i</sub> − y<sub>i</sub>)
          </p>
          <p>
            b = max<sub>1 ≤ i ≤ n</sub> (b<sub>i</sub> + y<sub>i</sub>)
          </p>
          <p>
            A = max<sub>1 ≤ i ≤ n</sub> (A<sub>i</sub> − y<sub>i</sub>)
          </p>
          <p>
            B = max<sub>1 ≤ i ≤ n</sub> (B<sub>i</sub> + y<sub>i</sub>)
          </p>
          <p>
            Note that the schemas in this document are drawn assuming left-to-right
            directionality. If the
            CSS property
            <a data-cite="CSS-WRITING-MODES-3#direction"><code>direction</code></a>
            is <code>rtl</code>,
            then the
            elements should layout by making the x-axis pointing from right-to-left.
          </p>
          <p>
            The <a>MathItalicsCorrectionInfo</a> table contains the italic
            correction of some glyphs, which provides a measure of how slanted the
            glyphs are (see <a href="#figure-italic-correction"></a>). The
            <a>MathTopAccentAttachment</a> table also contains a reference
            points that are used for the horizontal positioning of glyphs as an accent
            (see <a href="#figure-top-accent-attachment"></a>). In later sections, this is
            generalized by claiming that all MathML boxes have <dfn>italic correction</dfn>
            and <dfn>top accent attachment</dfn> values. The values for glyphs are used to try and
            extend to token elements or to special boxes that do not change child metrics.
            Otherwise fallback values are used: 0 for italic correction and half
            the width of the box for top accent attachment.
          </p>
          <figure id="figure-italic-correction">
            <img src="figures/italcorr.svg"/>
            <figcaption>Examples of italic correction for italic f and large integral</figcaption>
          </figure>
          <figure id="figure-top-accent-attachment">
            <img src="figures/topaccent.svg"/>
            <figcaption>Example of top accent attachment for a circumflex accent</figcaption>
          </figure>
          <p>
            The present document assumes that W, w, a, b, A, B, italic correction
            and top accent attachment are nonnegative values. If computations result
            in negative values, then they must be interpreted as being zero.
            Note that some MathML elements such as <code>&lt;mspace&gt;</code> or <code>&lt;mpadded&gt;</code> may set box
            dimensions to negative values.
          </p>
        </section>
        <section>
          <h4>Layout Steps</h4>
          <p>
            For compatibility with HTML5 rendering, the MathML layout is performed in two
            independent steps:
          </p>
          <ol>
            <li>First, determine the intrinsic width W of MathML boxes following the description
              given in this document for each MathML box. This relies on vertical positions x as
              well as values for italic correction and top accent attachment, ignoring any vertical
              positioning or metrics.
            <li>
              Next, the final layout of MathML boxes is performed following
              the description given in this document, obtaining all the box metrics,
              including the actual width w, vertical metrics a, b, A, B and
              vertical positions y.
            </li>
          </ol>
          <p>
            In order to perform the first step independently of the second one, the
            horizontal metrics must not depend on the vertical metrics.
            As described in
            <a href="#adjust-space-around-content-mpadded"></a>,
            this adds some restrictions on the possible pseudo-units
            of the <code>&lt;mpadded&gt;</code> element. As indicated in
            <a href="#operator-fence-separator-or-accent-mo"></a>,
            the width of size variants or of the glyph assembly used for vertical stretchy
            operators may depend on the target size to cover. Taking the maximum widths
            for all these size variants or for the glyph assembly during the first step
            makes the intrinsic width independent of the target size but may lead to a
            small over-estimation.
          </p>
          <p>
            Each of these steps is done recursively: the metrics of a given
            MathML box are determined from those of the child boxes.
            The stretching of the <a>core operator</a> of an
            <a>embellished operator</a> may happen when processing reaches
            the <a>outermost embellished operator</a>.
            User agents must then apply the current operation again
            to this embellished operator
            (intrinsic width determination or layout).
            Fortunately, such embellished operator subtrees are not deep in
            practice.
          </p>
          <p>
            This document does not require support for operator stretching in table cells.
            The “delayed” stretching of all operators must then be performed when processing
            arrives at the anonymous <code>&lt;mrow&gt;</code> child of <code>&lt;math&gt;</code> and <code>&lt;mtd&gt;</code>
            elements.
            In this manner, the intrinsic width of this anonymous <code>&lt;mrow&gt;</code> is well-defined
            for the layout of <code>&lt;mtable&gt;</code> elements and of the containers of the
            <code>&lt;math&gt;</code> element. Similarly, the final layout of this anonymous
            <code>&lt;mrow&gt;</code> is already done when it is time to perform the one of its ancestors.
          </p>
        </section>
      </section>
      <section>
        <h3>Token Elements</h3>
        <section>
          <h4>Text <code>&lt;mtext&gt;</code></h4>
          <div class="issue">Improve description of layout?</div>
          <p>
            The
            <dfn><code>&lt;mtext&gt;</code></dfn>
            element is used to represent arbitrary text
            that should be rendered as itself. In general, the
            <code>&lt;mtext&gt;</code> element is intended to denote commentary text.
          </p>
          <p>
            The <code>&lt;mtext&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>.
          </p>
          <p>
            If the <code>&lt;mtext&gt;</code> element contains only text content
            without <a data-cite="CSS-TEXT-3#forced-line-break">forced line break</a> or
            <a data-cite="CSS-TEXT-3#soft-wrap-opportunity">soft wrap opportunity</a>
            then a <a href="#simple-layout-of-mtext">simple layout</a> is
            performed with the proper
            <a href="#opentype-features">OpenType features</a> enabled.
            Otherwise, a <a href="#general-mtext-layout">more generic layout</a>
            is performed.
          </p>
          <div class="note">
            In practice, most MathML token elements just contain simple text
            for variables, numbers, operators etc and don't need sophisticated
            layout.
          </div>
          <section>
            <h4>Simple layout of <code>&lt;mtext&gt;</code></h4>
            <p>
              The text is laid out, ink ascent,
              ink descent, logical ascent, logical descent and
              advance width of the text is measured and these values used
              for the MathML box of the <code>&lt;mtext&gt;</code> element.
            </p>
            <p>
              If the inline-end glyph of the text content has an entry in the
              <a>MathItalicsCorrectionInfo</a> table then the specified
              value is used as the italic correction.
            </p>
            <p>
              If the text content is made of a single glyph and this glyph
              has an entry in the <a>MathTopAccentAttachment</a> table
              then the specified value is used as the top accent attachment of
              the <code>&lt;mtext&gt;</code> element.
            </p>
          </section>
          <section>
            <h5>OpenType features</h5>
            <p>
              Good mathematical rendering requires use of non-Unicode glyphs.
              Mathematical fonts may only provide these glyphs when the
              <code>math</code> script tag is enabled [[OPEN-FONT-FORMAT]],
              so user agents must
              ensure that it is the case when rendering text inside the
              <code>&lt;mtext&gt;</code> element.
            </p>
            <p>
              If on the <code>&lt;mtext&gt;</code> element
              the CSS property
              <a data-cite="CSS-WRITING-MODES-3#direction"><code>direction</code></a>
              is <code>rtl</code>,
              then user agents must enable the <code>rtlm</code>
              OpenType feature on text nodes [[OPEN-FONT-FORMAT]]
              unless it contradicts what the
              page author has specified with the
              <code>font-feature-settings</code> CSS property.
            </p>
            <div class="issue"  data-number="19">Add detailed rules for the ssty OpenType feature</div>
            <p>
              Some characters like primes already have script size by default
              and
              hence would be too small when used in a script position.
              To render such “prescripted” characters with the appropriate size,
              If a <code>&lt;mtext&gt;</code> has a positive
              <a><code>scriptlevel</code></a> value then user agents must enable
              the <code>ssty</code> (Script Style) OpenType feature
              on its text nodes [[OPEN-FONT-FORMAT]]
              unless it contradicts what the page author has
              specified with the
              <a data-cite="CSS-FONTS-3#font-rend-desc"><code>font-feature-settings</code></a>
              CSS property.
          </p>
          </section>
          <section>
            <h4>General <code>&lt;mtext&gt;</code> layout</h4>
            <p>
              In the most general case, the <code>&lt;mtext&gt;</code> element
              may contain text with line breaks or arbitrary HTML5 phrasing
              elements. The logical dimensions and max-content width
              are determined and the result is used for both
              the logical and ink values of the
              <code>&lt;mtext&gt;</code> element. The italic correction and
              top accent attachment are assigned the fallback values indicated
              in  <a href="#operator-fence-separator-or-accent-mo"></a>.
            </p>
          </section>
        </section>
        <section>
          <h4>Identifier <code>&lt;mi&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mi&gt;</code></dfn>
            element represents a symbolic name or
            arbitrary text
            that should be rendered as an identifier. Identifiers can include
            variables, function names, and symbolic constants.
          </p>
          <p>
            The <code>&lt;mi&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>. Its layout algorithm is
            the same as the <a>&lt;mtext&gt;</a> element.
            The
            <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following property in order to implement automatic
            italic:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/mi.css"></pre>
        </section>
        <section>
          <h4>Number <code>&lt;mn&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mn&gt;</code></dfn>
            element represents a "numeric literal" or
            other data that should be rendered as a numeric literal. Generally
            speaking, a numeric literal is a sequence of digits, perhaps including a
            decimal point, representing an unsigned integer or real number.
          </p>
          <p>
            The <code>&lt;mn&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>. Its layout algorithm is
            the same as the
            <a><code>&lt;mtext&gt;</code></a> element.
          </p>
        </section>
        <section>
          <h4>Operator, Fence, Separator or Accent <code>&lt;mo&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mo&gt;</code></dfn>
            element represents an
            operator or anything that should be rendered as an operator.
            In general, the notational conventions for mathematical operators
            are quite complicated, and therefore MathML provides a relatively
            sophisticated mechanism for specifying the rendering behavior of an
            <code>&lt;mo&gt;</code> element.</p>
          <p>
            As a consequence, in MathML the
            list of things that should "render as an operator" includes a
            number of notations that are not mathematical operators in the
            ordinary sense. Besides ordinary operators with infix, prefix, or
            postfix forms, these include fence characters such as braces,
            parentheses, and "absolute value" bars; separators such as comma
            and semicolon; and mathematical accents such as a bar or tilde over
            a symbol. This chapter uses the term "operator" to refer to
            operators in this broad sense.
          </p>
          <p>
            The <code>&lt;mo&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attributes:
          </p>
          <ul>
            <li><a><code>form</code></a></li>
            <li><a><code>fence</code></a></li>
            <li><a><code>separator</code></a></li>
            <li><a><code>lspace</code></a></li>
            <li><a><code>rspace</code></a></li>
            <li><a><code>stretchy</code></a></li>
            <li><a><code>symmetric</code></a></li>
            <li><a><code>maxsize</code></a></li>
            <li><a><code>minsize</code></a></li>
            <li><a><code>largeop</code></a></li>
            <li><a><code>movablelimits</code></a></li>
            <li><a><code>accent</code></a></li>
          </ul>
          <section>
            <h5>Embellished operators</h5>
            <p>
              A <a>MathML Core element</a> is an
              <dfn data-lt="embellished">embellished operator</dfn>
              if is is:
            </p>
            <ol>
              <li>An <a><code>&lt;mo&gt;</code></a> element;</li>
              <li>
                Or one of the elements <a><code>&lt;msub&gt;</code></a>,
                <a><code>&lt;msup&gt;</code></a>,
                <a><code>&lt;msubsup&gt;</code></a>,
                <a><code>&lt;munder&gt;</code></a>,
                <a><code>&lt;mover&gt;</code></a>,
                <a><code>&lt;munderover&gt;</code></a>,
                <a><code>&lt;mmultiscripts&gt;</code></a>,
                <a><code>&lt;mfrac&gt;</code></a>,
                <a><code>&lt;semantics&gt;</code></a> or
                <a><code>&lt;maction&gt;</code></a>
                whose first child exists and is an
                <a>embellished operator</a>;
              </li>
              <li>
                Or one of the elements
                <a><code>&lt;mrow&gt;</code></a>,
                <a><code>&lt;mstyle&gt;</code></a>,
                <a><code>&lt;mphantom&gt;</code></a>,
                <a><code>&lt;mpadded&gt;</code></a>
                whose children consist (in any order) of one
                <a>embellished operator</a> and zero or more
                <a>space-like</a> elements.
              </li>
            </ol>
            <p>
              The <dfn>core operator</dfn> of an <a>embellished operator</a>
              is the <code>&lt;mo&gt;</code> element defined recursively as
              follows:
            </p>
            <ol>
              <li>The core operator of an <a><code>&lt;mo&gt;</code></a>
                element; is the element itself.</li>
              <li>
                The core operator of an embellished
                <a><code>&lt;msub&gt;</code></a>,
                <a><code>&lt;msup&gt;</code></a>,
                <a><code>&lt;msubsup&gt;</code></a>,
                <a><code>&lt;munder&gt;</code></a>,
                <a><code>&lt;mover&gt;</code></a>,
                <a><code>&lt;munderover&gt;</code></a>,
                <a><code>&lt;mmultiscripts&gt;</code></a>,
                <a><code>&lt;mfrac&gt;</code></a>,
                <a><code>&lt;semantics&gt;</code></a> or
                <a><code>&lt;maction&gt;</code></a>
                element is the core operator of its first child.
              </li>
              <li>
                The core operator of an embellished
                <a><code>&lt;mrow&gt;</code></a>,
                <a><code>&lt;mstyle&gt;</code></a>,
                <a><code>&lt;mphantom&gt;</code></a>,
                <a><code>&lt;mpadded&gt;</code></a>
                is the core operator of its unique <a>embellished operator</a>
                child.
              </li>
            </ol>
            <p>
              An <dfn>outermost embellished operator</dfn> is an
              <a>embellished operator</a> whose parent is not
              an embellished operator.
            </p>
          </section>
          <section>
            <h4>Dictionary-based attributes</h4>
            <p>
              The <dfn><code>form</code></dfn>
              property of an <a>embellished operator</a>
              element is either <code>prefix</code>, <code>prefix</code> or
              <code>postfix</code>.
              The <code>form</code> attribute,
              if present on an <a><code>&lt;mo&gt;</code></a> element
              must be case-insensitively equal to one of the values.
            </p>
            <p>
              If the <a>core operator</a> of an <a>embellished operator</a> has
              a valid <code>form</code> attribute then the <code>form</code> of
              that <a>embellished operator</a> is the value specified
              by the <code>form</code> attribute on its <a>core operator</a>.
              Otherwise, the <code>form</code> of the
              <a>embellished operator</a> is determined as follows:
            </p>
            <ul>
              <li>If the embellished operator is the first child of an
                <a>&lt;math&gt;</a>
                <a>&lt;menclose&gt;</a>
                <a>&lt;merror&gt;</a>
                <a>&lt;mpadded&gt;</a>
                <a>&lt;mphantom&gt;</a>
                <a>&lt;mrow&gt;</a>
                <a>&lt;msqrt&gt;</a> or
                <a>&lt;mstyle&gt;</a> element with more than one child
                (ignoring all <a>space-like</a> children) then it has
                form <code>prefix</code>;
              </li>
              <li>Or, if the embellished operator is the last child of an
                <a><code>&lt;math&gt;</code></a>,
                <a><code>&lt;menclose&gt;</code></a>,
                <a><code>&lt;merror&gt;</code></a>,
                <a><code>&lt;mpadded&gt;</code></a>,
                <a><code>&lt;mphantom&gt;</code></a>,
                <a><code>&lt;mrow&gt;</code></a>,
                <a><code>&lt;msqrt&gt;</code></a> or
                <a><code>&lt;mstyle&gt;</code></a> element
                with more than one child
                (ignoring all <a>space-like</a> children) then it has
                form <code>postfix</code>;
              <li>Or, if the embellished operator is a child of an
                <a><code>&lt;msub&gt;</code></a>,
                <a><code>&lt;msup&gt;</code></a>,
                <a><code>&lt;msubsup&gt;</code></a>,
                <a><code>&lt;munder&gt;</code></a>,
                <a><code>&lt;mover&gt;</code></a>,
                <a><code>&lt;munderover&gt;</code></a> or
                <a><code>&lt;mmultiscripts&gt;</code></a>
                element other than the first child, then it has form
                <code>postfix</code>;
              </li>
              <li>
                Otherwise, the embellished operator has form
                <code>infix</code>.
              </li>
            </ul>
            <p>
              The
              <dfn><code>fence</code></dfn>,
              <dfn><code>separator</code></dfn>,
              <dfn><code>stretchy</code></dfn>,
              <dfn><code>symmetric</code></dfn>,
              <dfn><code>largeop</code></dfn>,
              <dfn><code>movablelimits</code></dfn>,
              <dfn><code>accent</code></dfn>
              properties of an <a>embellished operator</a> are is either
              <code>true</code> or <code>false</code>. In the former case, it
              is said that <a>embellished operator</a> <em>has</em> the
              property.
              The corresponding attributes,
              if present on an <a><code>&lt;mo&gt;</code></a> element
              must be <a>boolean</a>.
            </p>
            <p>
              The
              <dfn><code>lspace</code></dfn>,
              <dfn><code>rspace</code></dfn>,
              <dfn><code>minsize</code></dfn>
              properties of an <a>embellished operator</a> are
              <a>length-percentage</a>.
              The <dfn><code>maxsize</code></dfn> property
              of an <a>embellished operator</a> is either an
              <a>length-percentage</a> or <code>infinity</code>.
              The
              <code>lspace</code>,
              <code>rspace</code>,
              <code>minsize</code> and
              <code>maxsize</code> attributes,
              if present on an <a><code>&lt;mo&gt;</code></a> element
              must be <a>length-percentage</a>.
            </p>
            <p>
              The
              <code>fence</code>,
              <code>separator</code>,
              <code>stretchy</code>,
              <code>symmetric</code>,
              <code>largeop</code>,
              <code>movablelimits</code>,
              <code>accent</code>,
              <code>lspace</code>,
              <code>rspace</code>,
              <code>maxsize</code>,
              <code>minsize</code> properties of
              an <a>embellished operator</a> are determined as follows:
            </p>
            <ol>
              <li>If the corresponding attribute is present and valid
                on the <a>core operator</a>, then this property is used;</li>
              <li>
                Otherwise, if the <a>core operator</a> contains only text
                content T the corresponding property from the
                <a href="#operator-dictionary">Operator Dictionary</a>
                is retrieved by looking for <code>Content=T,Form=F</code>
                where <code>F</code> is the <a><code>form</code></a> of the
                <a>embellished operator</a>;
              </li>
              <li>
                If no entry is found and the <a><code>form</code></a>
                of <a>embellished operator</a> was actually
                not explicitly specified
                as an attribute on its <a>core operator</a> then
                user agents must try other entries dictionary for different
                values of <code>F</code> in the following order:
                <code>infix</code>, <code>prefix</code>, <code>postfix</code>;
              </li>
              <li>
                Otherwise, use the value  <code>false</code> for
                <code>fence</code>,
                <code>separator</code>,
                <code>stretchy</code>,
                <code>symmetric</code>,
                <code>largeop</code>,
                <code>movablelimits</code> and
                <code>accent</code> properties ;
                <code>0.2777777777777778em</code> for
                <code>lspace</code> and
                <code>rspace</code> properties ;
                <code>100%</code> for the <code>minsize</code> property and
                <code>infinity</code> for the <code>maxsize</code> property.
              </li>
            </ol>
            <p>
              Percentage values for <code>lspace</code>,
              <code>rspace</code>,
              <code>minsize</code>,
              <code>maxsize</code> properties of an <a>embellished operator</a>
              are interpreted relative to the (non-percentage) value
              determined when the <a>core operator</a> does not have a valid
              attribute for the corresponding property. A percentage
              of <code>infinity</code> is interpreted as <code>infinity</code>.
            </p>
          </section>
          <section>
            <h4>Layout of operators</h4>
            <div class="issue">TODO: Rewrite and reorganize this section...</div>
            <p>
              The inline-start <code>lspace</code> and
              inline-end <code>rspace</code> must be added on each side of
              <a>outermost embellished operators</a>.
            </p>
            <p>
              In most cases, the <code>&lt;mo&gt;</code> element is treated as an
              <a>&lt;mtext&gt;</a> element.
              However, when an <code>&lt;mo&gt;</code> element with a single character must be
              displayed as a large operator then use the
              <code>MathVariants</code>
              table to try and find a glyph of height at least
              <a>DisplayOperatorMinHeight</a>
              (<a href="#figure-sum-base-and-displastyle-sizes"></a>). If none is found, fallback to the
              largest one. Because this parameter does not always give
              the best size, user agents may also use the following heuristic: ensure
              that the large variant height is at least 2 times as large as the base
              height for integrals and √2 times as large as the base height for other
              operators.
            </p>
            <figure id="figure-sum-base-and-displastyle-sizes">
              <img src="figures/sumsize.svg"/>
              <figcaption>Base and displaystyle sizes of the summation symbol</figcaption>
            </figure>
            <p>
              When an <code>&lt;mo&gt;</code> element with a single character must be
              displayed as a horizontal or vertical operator then instead of displaying
              the normal character, use the <code>MathVariants</code>
              table to try and find a glyph that has at least the desired size or an
              assembly from several glyphs to cover at least the desired size
              (<a href="#figure-base-variants-and-assembly"></a>). The rules for vertical stretching
              are a bit more complicated and are described in section
              “Vertical Stretching Rules” of
              [[MATHML3]].
              If the operator has property <code>symmetric="true"</code>, then it must be
              stretched symmetrically with respect to the math axis, which is given by
              the <a>AxisHeight</a> value.
              <a href="#symmetric-and-non-symmetric-vertical-stretching"></a>
              compares the symmetric and non-symmetric stretching.
            </p>
            <p>
              The size variant or construction used for vertical stretchy operators
              will depend on the target size to cover. The intrinsic width W of the
              operator is calculated from the maximum of all possible widths
              for the base size, size variants and construction available for the given
              operator. In practice, for most math fonts and operators, the width
              of the operator is almost independent of the stretch size.
            </p>
            <figure id="figure-base-variants-and-assembly">
              <img src="figures/bracesize.svg"/>
              <figcaption>Base size, size variants and glyph assembly for the
                left brace</figcaption>
            </figure>
            <figure id="symmetric-and-non-symmetric-vertical-stretching">
              <img src="figures/vstretch.svg"/>
              <figcaption>Symmetric and non-symmetric stretching of vertical
                operators</figcaption>
            </figure>
            <p>
              See
              <a href="#horizontally-group-sub-expressions-mrow"></a>
              for details about how to treat
              <a>outermost embellished operators</a>,
              and how decide when to display operators larger
              or when to stretch them vertically &amp; horizontally.
            </p>
          </section>
        </section>
        <section>
          <h4>Space <code>&lt;mspace&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mspace&gt;</code></dfn>
            empty element represents a blank space of any
            desired size, as set by its attributes.
          </p>
          <p>
            The <code>&lt;mspace&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attributes:
          </p>
          <ul>
            <li><a href="#attribute-mspace-width" class="internalDFN" data-link-type="dfn"><code>width</code></a></li>
            <li><a href="#attribute-mspace-height" class="internalDFN" data-link-type="dfn"><code>height</code></a></li>
            <li><a href="#attribute-mspace-depth" class="internalDFN" data-link-type="dfn"><code>depth</code></a></li>
          </ul>
          <div class="issue" data-number="40">Allow negative width, lspace to
            produce negative spacing?</div>
          <p>The
            <dfn id="attribute-mspace-width"><code>mspace@width</code></dfn>,
            <dfn id="attribute-mspace-height"><code>mspace@height</code></dfn>,
            <dfn id="attribute-mspace-depth"><code>mspace@depth</code></dfn>, if present, must
            have a value that is a valid <a>length-percentage</a>.
            An unspecified attribute, a percentage  value, or an invalid value
            is interpreted as <code>0</code>.
            If one of the requested values calculated is negative then it is
            treated as <code>0</code>.
          </p>
          <p>
            The <code>&lt;mspace&gt;</code> element is laid out as shown on
            <a href="#figure-box-mspace"></a>.
            The min-content and max-content inline sizes are equal to
            the requested inline size.
            The inline size, line-ascent and line-descent are respectively
            the requested inline size, line-ascent and line-descent.
            The ink line-ascent (respecitvely ink line-descent) is the same
            as the line-ascent (respecitvely line-descent).
            Finally, the (ink) block size is the sum of the (ink) line-ascent
            and (ink) line-descent.
          </p>
          <figure id="figure-box-mspace">
            <img src="figures/mspacebox.svg"/>
            <figcaption>Box model for the <code>&lt;mspace&gt;</code> element</figcaption>
          </figure>
          <div class="note">
            The terminology height/depth comes from [[MATHML3]], itself inspired
            from [[TEXBOOK]].
          </div>
          <section>
            <h3>Definition of space-like elements</h3>
            <p>
              A number of MathML presentation elements are "space-like" in the
              sense that they typically render as whitespace, and do not affect
              the mathematical meaning of the expressions in which they appear.
              As a consequence, these elements often function in somewhat
              exceptional ways in other MathML expressions.
            </p>
            <p>
              A <a>MathML Core element</a> is a
              <dfn data-lt="space-like">space-like element</dfn>
              if is is:
            </p>
            <ul>
              <li>An
                <a><code>&lt;mtext&gt;</code></a> or
                <a><code>&lt;mspace&gt;</code></a>.
              </li>
              <li>Or an
                <a><code>&lt;mrow&gt;</code></a>,
                <a><code>&lt;mstyle&gt;</code></a>,
                <a><code>&lt;mphantom&gt;</code></a>,
                <a><code>&lt;mpadded&gt;</code></a> element
                all of whose children are <a>space-like</a>;
              </li>
              <li>
                An <a><code>&lt;maction&gt;</code></a>
                whose first child exists and is <a>space-like</a>.
              </li>
            </ul>
            <div class="note">
              Note that an <a><code>&lt;mphantom&gt;</code></a> is not
              automatically defined to be space-like, unless its content is
              space-like. This is because operator spacing is affected by
              whether adjacent elements are space-like.
              Since the <code>&lt;mphantom&gt;</code> element is
              primarily intended as an aid in aligning expressions, operators
              adjacent to an <code>&lt;mphantom&gt;</code> should behave
              as if they were adjacent to the contents of the
              <code>&lt;mphantom&gt;</code>, rather than to an equivalently
              sized area of whitespace.
            </div>
          </section>
        </section>
        <section>
          <h4>String Literal <code>&lt;ms&gt;</code></h4>
          <p>
            <dfn><code>&lt;ms&gt;</code></dfn>
            element is used to represent
            "string literals" in expressions meant to be interpreted by computer
            algebra systems or other systems containing "programming languages".
          </p>
          <p>
            The <code>&lt;mn&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attributes:
          </p>
          <ul>
            <li><a><code>lquote</code></a></li>
            <li><a><code>rquote</code></a></li>
          </ul>
          <p>The
            <dfn><code>lquote</code></dfn>,
            <dfn><code>rquote</code></dfn> attributes respectively specify the strings to use as opening and
            closing quotes. An unspecified attribute is
            interpreted as the character U+0022 QUOTATION MARK.
          </p>
          <p>
            The layout algorithm is the same as the
            <a><code>&lt;mtext&gt;</code></a> element.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rules in order to enclose the content with
            quotes:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/ms.css"></pre>
        </section>
      </section>
      <section>
        <h3>General Layout Schemata</h3>
        <section>
          <h4>Horizontally Group Sub-Expressions <code>&lt;mrow&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mrow&gt;</code></dfn>
            element is used to group together any number of sub-expressions, usually
            consisting of one or more <code>&lt;mo&gt;</code> elements acting as
            "operators" on one or more other expressions that are their "operands".
          </p>
          <p>
            The <code>&lt;mrow&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>. An <code>&lt;mrow&gt;</code>
            element with children
            child<sub>1</sub>, child<sub>2</sub>, … child<sub>N</sub>
            is laid out as show on <a href="#figure-box-mrow"></a>. The child boxes
            are put in a horizontal row one after the other with all their baselines
            aligned.
          </p>
          <div class="note">
            Because the box model ensure alignment of baselines,
            fraction bars or symmetric stretchy operators
            will also be aligned along the math axis in the typical case when
            <a>AxisHeight</a> is the same for all children.
          </div>
          <p>
            A child is <dfn>slanted</dfn> if it is not an
            <a>embellished operator</a> with the <a>largeop</a> property.
            and has nonzero <a>italic correction</a>.
            If a <a>slanted</a> child is followed by a non-<a>slanted</a> child,
            a space of width the <a>italic correction</a> of the former is added
            between the two children. If the last child is <a>slanted</a>, then
            a space of width its <a>italic correction</a> is added after that child.
          </p>
          <div class="note">
            Spacing around <a>outermost embellished operators</a> is already
            included in their box metrics.
          </div>
          <p>
            If the <code>&lt;mrow&gt;</code> element contains only one child,
            then its <a>italic correction</a> and <a>top accent attachment</a>
            are set to the corresponding values of that single child.
          </p>
          <figure id="figure-box-mrow">
            <img src="figures/mrowbox.svg"/>
            <figcaption>Box model for the <code>&lt;mrow&gt;</code> element</figcaption>
          </figure>
        </section>
        <section>
          <h4>Fractions <code>&lt;mfrac&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mfrac&gt;</code></dfn>
            element is used for fractions. It can also be used to mark up
            fraction-like objects such as binomial coefficients and Legendre symbols.
          </p>
          <p>
            The <code>&lt;mfrac&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the
            following attribute:
          </p>
          <ul>
            <li><a>linethickness</a></li>
          </ul>
          <p>
            The
            <dfn><code>linethickness</code></dfn>
            attribute indicates the thickness to use for the fraction bar.
            If present, it must
            have a value that is a valid <a>length-percentage</a>.
            If the attribute is absent or has an invalid value,
            <a>FractionRuleThickness</a> is used as the default
            value. A percentage is interpreted relative to that default value.
          </p>
          <p>
            The <code>&lt;mfrac&gt;</code> element sets
            <code>displaystyle</code> to <code>false</code>,
            or if it was already <code>false</code> increments
            <code>scriptlevel</code> by 1, within its children.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rule in order to implement that behavior:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/mfrac.css"></pre>
          <div class="issue" data-number="15">Decide how to handle invalid
            markup.</div>
          <p>
            If the <code>&lt;mfrac&gt;</code> element
            has less or more than two children, its layout algorithm
            is the same as the <a><code>&lt;mrow&gt;</code></a> element.
            Otherwise, the first child is called
            <em>numerator</em>, the second child is called
            <em>denominator</em> and the layout algorithm is explained below.
          </p>
          <section>
            <h5>Fraction with nonzero line thickness</h5>
            <p>
              If the actual line thickness is nonzero, the
              <code>&lt;mfrac&gt;</code>
              element is laid out as shown on <a href="#figure-box-mfrac"></a>.
              The fraction bar must only be painted if the
              <a data-cite="CSS2#visibility"><code>visibility</code></a> of
              the <code>&lt;mfrac&gt;</code> element is <code>visible</code>.
              In that case, the fraction bar must be painted with the
              <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a>
              of the <code>&lt;mfrac&gt;</code> element.
            </p>
            <p>
              The min-content (respectively max-content) inline size are
              the maximum between the min-content
              (respectively max-content) inline size of the numerator
              and the min-content
              (respectively max-content) of the denominator.
            </p>
            <p>
              The inline size is the maximum between the inline size of the
              numerator and the inline size of the denominator.
              The line-left coordinate of the fraction bar is 0.
              The numerator (respectively denominator) is centered along
              the inline axis i.e. its line-left coordinate is
              half the difference between the inline size and the
              inline size of the numerator
              (respectively denominator).
            </p>
            <p>
              The inline size of the fraction bar is the inline size.
              Its block size is the line thickness.
              Its block-axis center is placed on the math axis
              i.e. <a>AxisHeight</a> line-above the baseline.
            </p>
            <p>
              The baseline of the numerator (respectively denominator) is
              initially placed line-above (respectively line-below) the math
              axis by block-axis shifts <a>FractionNumeratorShiftUp</a>
              (respectively <a>FractionDenominatorShiftDown</a>)
              if the <a>math-style</a> is <code>inline</code> and
              <a>FractionNumeratorDisplayStyleShiftUp</a>
              (respectively <a>FractionDenominatorDisplayStyleShiftDown</a>)
              if the <a>math-style</a> is <code>display</code>.
            </p>
            <p>
              If necessary, these block-axis shifts are increased to ensure that
              the absolute distance between the
              line-under (respectively line-over) ink edge
              of the numerator (respectively denominator) and the
              line-over (respectively line-under) edge of the fraction bar is
              at least
              <a>FractionNumeratorGapMin</a>
              (respectively <a>FractionDenominatorGapMin</a>)
              if the <a>math-style</a> is <code>inline</code>
              and
              <a>FractionNumDisplayStyleGapMin</a>
              (respectively <a>FractionDenomDisplayStyleGapMin</a>)
              if the <a>math-style</a> is <code>display</code>.
            </p>
            <p>
              The (ink) line-ascent is the maximum between:
            </p>
            <ul>
              <li>
                <a>AxisHeight</a> plus the block-axis shift of the
                numerator plus the line-ascent of the numerator.
              </li>
              <li>
                <a>AxisHeight</a>,
                minus the block-axis shift of the denominator plus the
                (ink) line-ascent of the denominator.
              </li>
              <li>
                <a>AxisHeight</a> plus half the line thickness.
              </li>
            </ul>
            <p>
              The (ink) line-descent is the maximum between:
            </p>
            <ul>
              <li>
                −<a>AxisHeight</a>, minus the block-axis shift of the
                numerator plus the line-descent of the numerator.
              </li>
              <li>
                −<a>AxisHeight</a>, plus
                the block-axis shift of the denominator plus
                the (ink) line-descent of the denominator.
              </li>
              <li>
                −<a>AxisHeight</a> plus half the line thickness.
              </li>
              <li>0</li>
            </ul>
            <p>
              The (ink) block-size is the sum of the (ink) line-ascent
              and (ink) line-descent.
            </p>
            <figure id="figure-box-mfrac">
              <img src="figures/mfracbox.svg"/>
              <figcaption>Box model for the <code>&lt;mfrac&gt;</code> element</figcaption>
            </figure>
          </section>
          <section>
            <h5>Fraction with zero line thickness</h5>
            <p>
              If the actual line thickness is zero,
              the <code>&lt;mfrac&gt;</code> element is instead laid out as
              shown on <a href="#figure-box-mfrac-without-bar"></a>.
            </p>
            <p>
              The min-content inline size, max-content inline size
              inline size are calculated the same
              as in <a href="#fraction-with-nonzero-line-thickness"></a>.
              The line-left coordinates of the numerator and denominator too.
            </p>
            <p>
              The math axis is <a>AxisHeight</a> line-above the baseline.
              The baseline of the numerator (respectively denominator) is
              initially placed line-above (respectively line-below)
              the block-axis center of the math axis
              by block-axis shifts <a>StackTopShiftUp</a>
              (respectively <a>StackBottomShiftDown</a>)
              if the <a>math-style</a> is <code>inline</code> and
              <a>StackTopDisplayStyleShiftUp</a>
              (respectively <a>StackBottomDisplayStyleShiftDown</a>)
              if the <a>math-style</a> is <code>display</code>.
            </p>
            <p>
              The stack gap is the absolute distance between the
              line-under ink edge of the numerator
              and the line-over ink edge of the denominator.
              The minimal stack gap is
              <a>StackGapMin</a>
              if the <a>math-style</a> is <code>inline</code>
              and
              <a>StackDisplayStyleGapMin</a>
              if the <a>math-style</a> is <code>display</code>.
              If the stack gap is less than the minimal stack gap then
              the block-axis shifts of the numerator and denominator are
              increased by half the difference between the minimal stack gap
              and stack gap.
            </p>
            <p>
              Finally, the (ink) line-ascent, (ink) line-ascent and ink
              (block-size) are calculated the same
              as in <a href="#fraction-with-nonzero-line-thickness"></a>,
              ignoring the contribution of the fraction bar.
            </p>
            <figure id="figure-box-mfrac-without-bar">
              <img src="figures/mfracnobarbox.svg"/>
              <figcaption>Box model for the <code>&lt;mfrac&gt;</code> element without bar</figcaption>
            </figure>
          </section>
          <section>
            <h5>Spacing around the fraction</h5>
            <div class="issue">
              The embellished op spacing should probably added during the mrow
              layout. The extra 1px spacing could be in the CSS UA sheet. Hence
              this section can be removed.
            </div>
            <p>
              In order to prevent the fraction bar to be confused with other items around
              the fraction (e.g. minus sign or the bar of another fraction), a 1 pixel space
              must actually be added on each side of the <code>&lt;mfrac&gt;</code> element.
            </p>
            <p>
              If the <code>&lt;mfrac&gt;</code> element is an
              <a>outermost embellished operator</a> then its
              <a><code>lspace</code></a> and
              <a><code>rspace</code></a> properties
              must be added around the fraction.
            </p>
          </section>
        </section>
        <section>
          <h4>Radicals <code>&lt;msqrt&gt;</code>, <code>&lt;mroot&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;msqrt&gt;</code></dfn>
            and
            <dfn><code>&lt;mroot&gt;</code></dfn>
            elements construct radicals. The <code>&lt;msqrt&gt;</code> element is
            used for square roots, while the <code>&lt;mroot&gt;</code> element is
            used to draw radicals with indices, e.g. a cube root.
          </p>
          <p>
          </p>
          <p>
            The <code>&lt;msqrt&gt;</code> and <code>&lt;mroot&gt;</code>
            elements accept the attributes described
            in <a href="#global-attributes"></a>.
          </p>
          <p>
            The <code>&lt;mroot&gt;</code> element sets
            increments scriptlevel by 2, and sets displaystyle to "false" in all
            but its first child.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rule in order to implement that behavior:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/mroot.css"></pre>
          <div class="issue" data-number="15">Decide how to handle invalid
            mroot.</div>
          <p>
            If the <code>&lt;mroot&gt;</code> has less or more than two children,
            its layout algorithm
            is the same as the <a><code>&lt;mrow&gt;</code></a> element.
            Otherwise, the first child is called
            <em>base</em> and
            the second child is called
            <em>index</em>
            and its layout algorithm is explained below.
            The children of the <code>&lt;msqrt&gt;</code> element are laid out
            using the algorithm of the <a><code>&lt;mrow&gt;</code></a> element
            to produce a box that is also called the <em>base</em>.
          </p>
          <section>
            <h5>Radical symbol</h5>
            <p>
              The radical symbol must only be painted if the
              <a data-cite="CSS2#visibility"><code>visibility</code></a> of
              the <code>&lt;msqrt&gt;</code> or <code>&lt;mroot&gt;</code>
              element is <code>visible</code>.
              In that case, the radical symbol must be painted with the
              <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a>
              of that element.
            </p>
            <p>
              The <dfn>radical glyph</dfn> is the glyph obtained for the
              character U+221A SQUARE ROOT,
              applying the <code>rtlm</code> OpenType feature
              if the CSS property
              <a data-cite="CSS-WRITING-MODES-3#direction"><code>direction</code></a>
              is <code>rtl</code> [[OPEN-FONT-FORMAT]].
            </p>
            <p>
              The <dfn>radical gap</dfn> is given by
              <a>RadicalVerticalGap</a>
              if the <a>math-style</a> is <code>inline</code> and
              <a>RadicalDisplayStyleVerticalGap</a>
              if the <a>math-style</a> is <code>display</code>.
            </p>
            <p>
              The radical target size for the stretchy radical glyph is
              the sum of <a>RadicalRuleThickness</a>,
              <a>RadicalExtraAscender</a> and the radical gap.
            </p>
            <p>
              The <dfn>box metrics of the radical glyph</dfn> is the
              <a>box metrics of a stretchy glyph</a> in block direction
              for the radical radical glyph and target size.
            </p>
            <p>
              The shaping of the surd is performed by the algorithm to
              <a>shape a stretchy glyph</a> in block direction
              for the radical radical glyph and target size.
            </p>
          </section>
          <section>
            <h5>Square root</h5>
            <p>
              The <code>&lt;msqrt&gt;</code> element is laid out as shown on
              <a href="#figure-box-msqrt"></a>.
            </p>
            <p>
              The min-content (respectively max-content) inline size is
              the sum of the
              <a>preferred inline-size of a stretchy glyph in block direction</a>
              for the <a>radical glyph</a>
              and of the min-content (respectively max-content) inline size
              of the base.
            </p>
            <p>
              The inline size is the sum of the advance width
              of the <a>box metrics of the radical glyph</a> and
              of the inline size of the base.
            </p>
            <p>
              The ink line-ascent is the sum of <a>RadicalRuleThickness</a>,
              the radical gap and the ink line-ascent of the base.
              The line-ascent is the maximum between:
            </p>
            <ul>
              <li>The line-ascent of the base.</li>
              <li>The sum of ink line-ascent and <a>RadicalExtraAscender</a></li>
            </ul>
            <p>
              The (ink) line-descent is the maximum between:
            </p>
            <ul>
              <li>The (ink) line-descent of the base.</li>
              <li>The sum of the line-ascent and line-descent for the
                <a>box metrics of the radical glyph</a>, minus the ink line-ascent.
              </li>
            </ul>
            <p>
              The (ink) block size is the sum of the (ink) line-ascent
              and (ink) line-descent.
            </p>
            <p>
              The base is at line-left coordinate the width of the
              <a>box metrics of the radical glyph</a> and
              its baseline is aligned with the baseline.
            </p>
            <p>
              The inline size of the overbar is the inline size of the
              base. Its block size is the rule thickness
              <a>RadicalRuleThickness</a>. It is positioned
              line-above the baseline by the ink line-ascent.
            </p>
            <p>
              Finally, the painting of the radical glyph is performed at
              line-left 0 and
              at distance line-below the line-over edge of the overbar,
              given by the line-ascent of the
              <a>box metrics of the radical glyph</a>.
            </p>
            <figure id="figure-box-msqrt">
              <img src="figures/msqrtbox.svg"/>
              <figcaption>Box model for the <code>&lt;msqrt&gt;</code> element</figcaption>
            </figure>
          </section>
          <section>
            <h5>Root with index</h5>
            <p>
              The <code>&lt;mroot&gt;</code> element is laid out as shown on
              <a href="#figure-box-mroot"></a>.
              The root index is first ignored and the base and
              radical glyph
              are laid out as
              shown on figure <a href="#figure-box-msqrt"></a> to obtain a box B.
            </p>
            <div class="issue">Handle large negative RadicalKernAfterDegree?</div>
            <p>
              The min-content (respectively max-content) inline size is the sum
              of <a>RadicalKernBeforeDegree</a>,
              the index min-content (respectively max-content) inline size,
              <a>RadicalKernAfterDegree</a>
              and of the min-content (respectively max-content) of B.
            </p>
            <p>
              The line-left coordinate of the index is
              <a>RadicalKernBeforeDegree</a>.
              The line-left coordinate of B is obtained by adding the
              inline size of the index and <a>RadicalKernAfterDegree</a>.
              The inline size is the sum of
              <a>RadicalKernBeforeDegree</a>,
              the inline size of the index, <a>RadicalKernAfterDegree</a>
              and of the inline size of B.
            </p>
            <p>
              The baseline of the <code>&lt;mroot&gt;</code> is the baseline
              of B.
              The line-under ink edge of the index is positioned
              at a distance line-above the line-under ink edge of B,
              given by <a>RadicalDegreeBottomRaisePercent</a> times
              the ink block size of B. Hence the (ink) line-ascent
              is the maximum between:</p>
            <ul>
              <li>−the ink line-descent of B +
                <a>RadicalDegreeBottomRaisePercent</a> ×
                the ink block size of B + the (ink) line-ascent of the
                index</li>
              <li>The (ink) line-ascent of B</li>
            </ul>
            <p>while the (ink) line-descent is the maximum between:</p>
            <ul>
              <li>the ink line-descent of B −
                <a>RadicalDegreeBottomRaisePercent</a> ×
                the ink block size of B + the (ink) line-ascent of the
                index</li>
              <li>The (ink) line-descent of B</li>
            </ul>
            <p>Finally, the (ink) block size is the sum of the (ink)
              line-ascent and (ink) line-descent.</p>
            <figure id="figure-box-mroot">
              <img src="figures/mrootbox.svg"/>
              <figcaption>Box model for the <code>&lt;mroot&gt;</code> element</figcaption>
            </figure>
            <div class="note">
              In general, the kerning before the root index is positive while
              the kerning after it is negative, which means that the root
              element will have some line-left space and that the root index
              will overlap the surd.
            </div>
          </section>
        </section>
        <section>
          <h4>Style Change <code>&lt;mstyle&gt;</code></h4>
          <p>
            Historically, the
            <dfn><code>&lt;mstyle&gt;</code></dfn>
            element was introduced to make
            style changes that affect the rendering of its contents.
          </p>
          <p>
            The <code>&lt;mstyle&gt;</code> element accepts the attributes described in
            <a href="#global-attributes"></a>. Its layout algorithm is the
            same as the <a><code>&lt;mrow&gt;</code></a> element.
          </p>
          <div class="note">
            While the <code>&lt;mstyle&gt;</code> is preserved for backward compatibility reasons
            with legacy documents and existing tools, modern authors and tools are strongly
            encouraged to use CSS for styling.
          </div>
        </section>
        <section>
          <h4>Error Message <code>&lt;merror&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;merror&gt;</code></dfn>
            element displays its contents as an
            ”error message”. The intent of this element is to provide a standard way
            for programs that generate MathML from other input to report syntax errors
            in their input.
          </p>
          <p>
            The <code>&lt;merror&gt;</code> element accepts the attributes described in
            <a href="#global-attributes"></a>. Its layout algorithm is the
            same as the <a><code>&lt;mrow&gt;</code></a> element.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rule in order to visually highlight the error
            message:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/merror.css"></pre>
        </section>
        <section>
          <h4>Adjust Space Around Content <code>&lt;mpadded&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;mpadded&gt;</code></dfn>
            element renders the same as its child content, but with the
            size of the child’s bounding box and the relative positioning point of its
            content modified according to <code>&lt;mpadded&gt;</code>’s attributes.
          </p>
          <p>
            The <code>&lt;mspace&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attributes:
          </p>
          <ul>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-width"><code>width</code></a></li>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-height"><code>height</code></a></li>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-depth"><code>depth</code></a></li>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-lspace"><code>lspace</code></a></li>
            <li><a class="internalDFN" data-link-type="dfn" href="#attribute-mpadded-voffset"><code>voffset</code></a></li>
          </ul>
          <p>
            The
            <dfn id="attribute-mpadded-width"><code>mpadded@width</code></dfn> and
            <dfn id="attribute-mpadded-lspace"><code>mpadded@lspace</code></dfn> attributes, if present, must match the syntax
            <code>( "+" | "-" )? (<a><code>unsigned-length-percentage</code></a> | (<a><code>unsigned-number</code></a> "%"? "width"))</code>.
          </p>
          <p>
            The
            <dfn id="attribute-mpadded-height"><code>mpadded@height</code></dfn>,
            <dfn id="attribute-mpadded-depth"><code>mpadded@depth</code></dfn> and
            <dfn id="attribute-mpadded-voffset"><code>mpadded@voffset</code></dfn>
            attributes, if present, must match the syntax
            <code>( "+" | "-" )? (<a><code>unsigned-length-percentage</code></a> | (<a><code>unsigned-number</code></a> "%"? ("height" | "depth"))</code>.
          </p>
          <section>
            <h5>Inner box and requested parameters</h5>
            <p>
              Children of the <code>&lt;mpadded&gt;</code> element are laid out
              using the algorithm of the <a><code>&lt;mrow&gt;</code></a> element
              to produce the
              <em>mpadded inner box</em> with parameters called
              inner inline size, inner line-ascent and inner line-descent.
              The requested <code>&lt;mpadded&gt;</code>
              parameters are determined as follows:
            </p>
            <ul>
              <li>If the <code>width</code> (respectively <code>height</code>,
                <code>depth</code>, <code>lspace</code>, <code>voffset</code>)
                attributes are absent or invalid the requested width
                (respectively height, depth, lspace, voffset)
                is the inner inline size
                (respectively inner line-ascent, inner line-descent,
                <code>0</code>,
                <code>0</code>).
              </li>
              <li>If the <code>width</code> (respectively <code>height</code>,
                <code>depth</code>, <code>lspace</code>, <code>voffset</code>)
                attribute is an
                <a><code>unsigned-length-percentage</code></a>
                then the requested width
                (respectively height, depth, lspace, voffset)
                is the resolved value
                with percentage interpreted relative to
                the inner inline size (respectively
                inner line-ascent, inner line-descent, <code>0</code>,
                <code>0</code>).
              </li>
              <li>If the <code>width</code> (respectively <code>lspace</code>) attribute
                matches <code>"<a><code>unsigned-number</code></a>width"</code>
                then the requested width (respectively lspace) is the number multipled by
                the inner inline size. If instead it matches
                <code>"<a><code>unsigned-number</code></a>%width"</code>
                then it is the same value but divided by 100.
              </li>
              <li>If the <code>height</code> (respectively <code>depth</code>,
                <code>voffset</code>) attribute
                matches <code>"<a><code>unsigned-number</code></a>height"</code>
                then the requested height (respectively depth, voffset) is the number
                multipled by the inner line-ascent. If instead it matches
                <code>"<a><code>unsigned-number</code></a>%heigth"</code>
                then it is the same value but divided by 100.
              </li>
              <li>If the <code>height</code> (respectively <code>depth</code>,
                <code>voffset</code>) attribute
                matches <code>"<a><code>unsigned-number</code></a>depth"</code>
                then the requested height (respectively depth, voffset) is the number
                multipled by the inner line-descent. If instead it matches
                <code>"<a><code>unsigned-number</code></a>%depth"</code>
                then it is the same value but divided by 100.
              </li>
              <li>If the <code>width</code> (respectively <code>height</code>,
                <code>depth</code>, <code>lspace</code>, <code>voffset</code>)
                starts with a U+002B PLUS SIGN or U+002D HYPHEN-MINUS character,
                then choose ε = ±1 to match the sign of that character
                and let V be the requested width
                (respectively height, depth, lspace, voffset)
                obtained for the same attribute value with that character removed.
                Then the requested width (respectively height, depth, lspace, voffset)
                is the inner inline size (respectively inner line-ascent,
                inner line-descent, <code>0</code>,
                <code>0</code>) + εV.
              </li>
            </ul>
            <div class="issue" data-number="40">Allow negative width, lspace to
              produce negative spacing?</div>
            <p>
              If one of the requested width, depth, height or lspace values calculated
              above is negative then it is treated as <code>0</code>.
            </p>
          </section>
          <section>
            <h5>Layout of <code>&lt;mpadded&gt;</code></h5>
            <p>
              The <code>&lt;mpadded&gt;</code> element is laid out as shown on
              <a href="#figure-box-mpadded"></a>.
              The mpadded inner box is positioned at the origin of the
              <code>&lt;mpadded&gt;</code> element, shift by the requested
              lspace in the line-right direction and by the requested voffset
              in the line-over direction.
            </p>
            <p>
              The min-content (respectively max-content) inline size
              is the requested width calculated in
              <a href="#inner-box-and-requested-parameters"></a>
              but using the min-content (respectively max-content)
              inline size of the
              mpadded inner box instead of the "inner inline size".
            </p>
            <div class="note">
              The calculatation of min-content and max-content inline sizes
              are well-defined because the requested width
              does not depend on any block metric.
            </div>
            <p>
              The inline size is the requested width.
              The (ink) line-ascent is the requested height.
              The (ink) line-descent is the requested depth.
              The (ink) block size is the sum of the (ink) line-ascent and
              (ink) line-descent.
            </p>
            <figure id="figure-box-mpadded">
              <img src="figures/mpaddedbox.svg"/>
              <figcaption>Box model for the <code>&lt;mpadded&gt;</code> element</figcaption>
            </figure>
          </section>
        </section>
        <section>
          <h4>Making Sub-Expressions Invisible <code>&lt;mphantom&gt;</code></h4>
          <p>
            Historically, the
            <dfn><code>&lt;mphantom&gt;</code></dfn>
            element was introduced to render
            its content invisibly, but with the same size and other dimensions,
            including baseline position, that its contents would have if they were
            rendered normally.
          </p>
          <p>
            The <code>&lt;mphantom&gt;</code> element accepts the attributes described
            in <a href="#global-attributes"></a>. Its layout algorithm is
            the same as the <a><code>&lt;mrow&gt;</code></a> element.
            The <a href="#user-agent-stylesheet">user agent stylesheet</a>
            must contain the following rule in order to hide the content:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/mphantom.css"></pre>
          <div class="note">
            While <code>&lt;mphantom&gt;</code> is preserved for backward compatibility reasons
            with legacy documents and existing tools, modern authors and tools are strongly
            encouraged to use CSS for styling.
          </div>
        </section>
        <section>
          <h4>Enclose Expression Inside Notation <code>&lt;menclose&gt;</code></h4>
          <p>
            The
            <dfn><code>&lt;menclose&gt;</code></dfn>
            element renders its content inside the enclosing notation.
            It accepts the attributes described in
            <a href="#global-attributes"></a> as well as the
            following attribute:
          </p>
          <ul>
            <li><a>notation</a></li>
          </ul>
          <p>
            The
            <dfn><code>notation</code></dfn>
            attribute, if present, must have a value that is an
            <a data-cite="HTML#unordered-set-of-unique-space-separated-tokens">unordered set
              of unique space-separated tokens</a> that are ASCII case-insensitive. The
            allowed values are
            <code>left</code>,
            <code>right</code>,
            <code>top</code>,
            <code>bottom</code>,
            <code>box</code>,
            <code>roundedbox</code>,
            <code>actuarial</code>,
            <code>madruwb</code>,
            <code>horizontalstrike</code>,
            <code>verticalstrike</code>
            <code>updiagonalstrike</code>,
            <code>downdiagonalstrike</code>,
            <code>longdiv</code>,
            <code>circle</code>.
          </p>
          <p>
            The notations must only be painted if the
            <a data-cite="CSS2#visibility"><code>visibility</code></a> of
            the <code>&lt;menclose&gt;</code> element is <code>visible</code>.
            In that case, the notations must be painted with the
            <a data-cite="CSS-COLOR-3#foreground"><code>color</code></a>
            of the <code>&lt;menclose&gt;</code> element.
          </p>
          <p>
            Children of the <code>&lt;menclose&gt;</code> element are laid out
            using the algorithm of the <a><code>&lt;mrow&gt;</code></a> element
            to produce a content box.
            Following [[OPEN-FONT-FORMAT]] [[?TEXBOOK]], the notation ξ<sub>8</sub>
            is used to denote the default rule thickness and is equal to
            <a>OverbarRuleThickness</a>.
            Gaps are set to 3ξ<sub>8</sub>.
            Contrary to what is done in general and unless specified otherwise,
            the x-axis direction of notations is assumed to be independent of
            the CSS
              <a data-cite="CSS-WRITING-MODES-3#direction"><code>direction</code></a>.
            Each notation is handled individually and the union of all output is taken
            in order to determine the metrics of the <code>&lt;menclose&gt;</code>.
          </p>
          <ol>
            <li>
              <p>
                The <code>left</code> notation is drawn by putting a vertical bar of thickness
                ξ<sub>8</sub> on the left of the content of the <code>&lt;menclose&gt;</code> element.
                The length of the bar is obtained by extending the height of the content
                with <a>OverbarVerticalGap</a> plus
                <a>OverbarRuleThickness</a> above
                and <a>UnderbarVerticalGap</a> plus
                <a>UnderbarRuleThickness</a> below.
                The gap between the bar and the content is 3ξ<sub>8</sub>.
                The logical box is obtained by adding some space of width
                ξ<sub>8</sub> on the left of the bar. See
                <a href="#figure-box-menclose-left"></a>.
              </p>
              <figure id="figure-box-menclose-left">
                <img src="figures/leftbox.svg"/>
                <figcaption>Box model for the <code>left</code>
                  notation of the <code>&lt;menclose&gt;</code> element</figcaption>
              </figure>
            </li>
            <li>
              <p>
                The <code>right</code> notation is drawn the same as the <code>left</code> notation,
                but with the vertical bar placed on the right.
              </p>
            </li>
            <li>
              <p>
                The <code>top</code> notation is drawn by putting an overbar of thickness
                <a>OverbarRuleThickness</a>
                over the content of the <code>&lt;menclose&gt;</code> element.
                The length of the bar is obtained by extending the width of the content
                with 4ξ<sub>8</sub> on each side.
                The gap between the overbar and the content is
                <a>OverbarVerticalGap</a>.
                The logical box is obtained by adding some space of height
                <a>OverbarExtraAscender</a> above the bar.
                See <a href="#figure-box-menclose-top"></a>.
              </p>
              <figure id="figure-box-menclose-top">
                <img src="figures/topbox.svg"/>
                <figcaption>Box model for the <code>top</code>
                  notation of the <code>&lt;menclose&gt;</code> element</figcaption>
              </figure>
            </li>
            <li>
              <p>
                The <code>bottom</code> notation is drawn the same as the <code>top</code> notation,
                but with the vertical bar placed below the content and using parameters
                <a>UnderbarRuleThickness</a>,
                <a>UnderbarVerticalGap</a>.
                and <a>UnderbarExtraDescender</a>.
              </p>
            </li>
            <li>
              The <code>box</code> notation is treated as equivalent to
              <code>left right top bottom</code>.
            </li>
            <li>
              <p>
                The <code>roundedbox</code> notation is drawn as follows. An expanded
                is calculated by extending the ink box by 7ξ<sub>8</sub> / 2 on each
                side. Using terminology from [[SVG]],
                a rounded rectangle is drawn on this expanded box
                with parameters <code>rx</code>, <code>ry</code> and
                <code>stroke-width</code> set to 3ξ<sub>8</sub>.
                The logical box is obtained by adding a space of ξ<sub>8</sub> on
                each side of the ink box.
                See <a href="#figure-box-menclose-roundedbox"></a>.
              </p>
              <figure id="figure-box-menclose-roundedbox">
                <img src="figures/roundedbox.svg"/>
                <figcaption>Box model for the <code>roundedbox</code>
                  notation of the <code>&lt;menclose&gt;</code> element</figcaption>
              </figure>
            </li>
            <li>The <code>actuarial</code> notation is treated as equivalent to <code>right top</code>.</li>
            <li>
              <p>
                The <code>madruwb</code> notation is treated as equivalent to
                <code>right bottom</code>.
            </li>
            <li>
              <p>
                The <code>horizontalstrike</code> notation is drawn with an horizontal bar
                of thickness ξ<sub>8</sub> and
                vertically centered inside the <code>&lt;menclose&gt;</code> content.
                This does not change the box metrics.
                See <a href="#figure-box-horizontal-strike"></a>.
              </p>
              <figure id="figure-box-horizontal-strike">
                <img src="figures/horizstrikebox.svg"/>
                <figcaption>Box model for the <code>horizontalstrike</code>
                  notation of the <code>&lt;menclose&gt;</code> element</figcaption>
              </figure>
            </li>
            <li>
              <p>
                The <code>verticalstrike</code> notation is drawn the same as
                <code>horizontalstrike</code> but with a vertical bar
                of thickness ξ<sub>8</sub> and horizontally centered inside the <code>&lt;menclose&gt;</code>
                content.
              </p>
            </li>
            <li>
              <p>
                The <code>updiagonalstrike</code> notation is drawn with a line
                of thickness ξ<sub>8</sub> going from the bottom left corner of the <code>&lt;menclose&gt;</code>
                content to its top right corner. Using terminology from [[SVG]], the
                <code>stroke-linecap</code> of the line is <code>butt</code>.
                As an approximation, the ink box
                is set equal to the logical box and obtained by increasing the original box
                from each side by ξ<sub>8</sub> / 2.
                See <a href="#figure-box-menclose-up-diagonal-strike"></a>.
              </p>
              <figure id="figure-box-menclose-up-diagonal-strike">
                <img src="figures/updiagstrikebox.svg"/>
                <figcaption>Box model for the <code>updiagonalstrike</code>
                  notation of the <code>&lt;menclose&gt;</code> element</figcaption>
              </figure>
            </li>
            <li>
              <p>
                The <code>downdiagonalstrike</code> notation is drawn as an
                <code>updiagonalstrike</code>
                but the line strike goes from the top left corner to the bottom right corner.
                Using terminology from [[SVG]], the
                <code>stroke-linecap</code> of the line is <code>butt</code>.
              </p>
            </li>
            <li>
              <p>
                The <code>longdiv</code> notation is drawn similarly to the <code>&lt;msqrt&gt;</code> element
                (<a href="#figure-box-msqrt"></a>).
                It is independent of CSS property
                <a data-cite="CSS-WRITING-MODES-3#direction"><code>direction</code></a>
                and U+221A SQUARE ROOT is replaced with
                U+0029 RIGHT PARENTHESIS. The rule thickness is ξ<sub>8</sub>,
                the gap between content and overbar is 3ξ<sub>8</sub> and the extra ascender
                is ξ<sub>8</sub>.
              </p>
            </li>
            <li>
              <p>
                The <code>circle</code> notation is drawn as follows.
                Given the ink box of width w and height h, an ellipse is drawn using
                the axes of symmetry of this ink box, the radii
                w * √2 / 2, h * √2 / 2 and thickness ξ<sub>8</sub>.
                The logical box is obtained by adding space ξ<sub>8</sub> around each
                side of the ellipse's ink box.
              </p>
              <figure id="figure-box-menclose-circle">
                <img src="figures/circlebox.svg"/>
                <figcaption>Box model for the <code>circle</code>
                  notation of the <code>&lt;menclose&gt;</code> element</figcaption>
              </figure>
            </li>
          </ol>
        </section>
      </section>
      <section>
        <h3>Script and Limit Schemata</h3>
        <section>
          <h4>Cramped Elements</h4>
          <p>
            A <a>MathML Core element</a> is <dfn>cramped</dfn> if it satisfies
            one of the following condition:
          </p>
          <ol>
            <li>Its parent is <a>cramped</a>.</li>
            <li>Its parent is a <a><code>&lt;msqrt&gt;</code></a> or
              <a><code>&lt;mroot&gt;</code></a> element.
            </li>
            <li>It is the denominator of a <a><code>&lt;mfrac&gt;</code></a>
              element.</li>
            <li>
              It is the subscript of a
              <a><code>&lt;msub&gt;</code></a> or
              <a><code>&lt;msubsup&gt;</code></a> element.
            </li>
            <li>
              It is the underscript of a
              <a><code>&lt;munder&gt;</code></a> or
              <a><code>&lt;munderover&gt;</code></a> element.
            </li>
            <li>It is the overscript of the
              <code>&lt;mover&gt;</code> and <code>&lt;munderover&gt;</code>
              elements and
              is an <a>embellished operator</a> with
              the <a><code>accent</code></a> property.
            </li>
          </ol>
        </section>
        <section>
          <h4>Subscripts and Superscripts <code>&lt;msub&gt;</code>,
            <code>&lt;msup&gt;</code>, <code>&lt;msubsup&gt;</code></h4>
          <p>
            The <dfn><code>&lt;msub&gt;</code></dfn>,
            <dfn><code>&lt;msup&gt;</code></dfn> and
            <dfn><code>&lt;msubsup&gt;</code></dfn> elements are used to attach
            subscript and superscript to a MathML expression.
            They accept the attributes described in
            <a href="#global-attributes"></a>.
          </p>
          <section>
            <h5>Children of <code>&lt;msub&gt;</code>,
            <code>&lt;msup&gt;</code>, <code>&lt;msubsup&gt;</code></h5>
            <div class="issue" data-number="15">Decide how to handle invalid
              markup.</div>
            <p>
              If the <code>&lt;msub&gt;</code> element
              has less or more than two children, its layout algorithm
              is the same as the <a><code>&lt;mrow&gt;</code></a> element.
              Otherwise, the first child is called the
              <em>base</em>, the second child is called the
              <em>subscript</em> and the layout algorithm is explained
              in <a href="#base-with-subscript"></a>.
            </p>
            <p>
              If the <code>&lt;msub&gt;</code> element
              has less or more than two children, its layout algorithm
              is the same as the <a><code>&lt;mrow&gt;</code></a> element.
              Otherwise, the first child is called the
              <em>base</em>, the second child is called the
              <em>superscript</em> and the layout algorithm is explained
              in <a href="#base-with-superscript"></a>.
            </p>
            <p>
              If the <code>&lt;msubsup&gt;</code> element
              has less or more than three children, its layout algorithm
              is the same as the <a><code>&lt;mrow&gt;</code></a> element.
              Otherwise, the first child is called the
              <em>base</em>, the second child is called the <em>subscript</em>,
              its third child is called
              the <em>superscript</em> and the layout algorithm is explained
              in <a href="#base-with-subscript-and-superscript"></a>.
            </p>
          </section>
          <section>
            <h5>Base with subscript</h5>
            <p>
              The <code>&lt;msub&gt;</code> element is laid out as shown on
              <a href="#figure-box-msub"></a>.
              The baseline is the baseline of the base while the baseline of
              the script is shifted down by <code>SubShift</code>, which is the
              minimal value honoring the following conditions:
            </p>
            <ol>
              <li>
                <code>SubShift</code> is at least <a>SubscriptShiftDown</a>.
              </li>
              <li>
                The top of the subscript <code>SubTop</code> with respect to
                the baseline is not above <a>SubscriptTopMax</a>.
              </li>
              <li>
                The drop <code>SubscriptBaselineDrop</code> from the bottom of
                the base to the baseline of the script is at least
                <a>SubscriptBaselineDropMin</a>.
              </li>
            </ol>
            <p>
              When determining
              the logical box, a space of width <a>SpaceAfterScript</a>
              is added after
              the subscript. By default, the
              inline-start edge of the subscript is
              aligned with the inline-end edge of the base. However, if the base
              is an <a>embellished operator</a> with
              the <a><code>largeop</code></a> property then
              the subscript is horizontally
              shifted backward by the italic correction of the base.
            </p>
            <figure id="figure-box-msub">
              <img src="figures/msubbox.svg"/>
              <figcaption>Box model for the <code>&lt;msub&gt;</code> element</figcaption>
            </figure>
          </section>
          <section>
            <h5>Base with superscript</h5>
            <p>
              The <code>&lt;msup&gt;</code> element is laid out as shown on
              <a href="#figure-box-msup"></a>.
              The baseline is the baseline of the base while the baseline of
              the script is shifted up by <code>SuperShift</code>, which is the
              minimal value honoring the following conditions:
            </p>
            <ol>
              <li>
                <code>SuperShift</code> is at least
                <a>SuperscriptShiftUpCramped</a> if the
                <code>&lt;msup&gt;</code> element is
                <a>cramped</a> or at least
                <a>SuperscriptShiftUp</a> otherwise.
              </li>
              <li>
                The bottom of the superscript <code>SuperBottom</code> with
                respect to the baseline is not below
                <a>SuperscriptBottomMin</a>.
              </li>
              <li>
                The drop <code>SuperscriptBaselineDrop</code> from the top of
                the base to the baseline of the script is at most
                <a>SuperscriptBaselineDropMax</a>.
              </li>
            </ol>
            <p>
              When determining the logical box, a space of width
              <a>SpaceAfterScript</a> is added after
              the superscript. By default, the
              inline-start edge of the superscript
              is aligned with the inline-end edge of the base and
              shifted forward
              by the italic correction of the base, except if the base is an
              <a>embellished operator</a> with
              the <a><code>largeop</code></a> property.
            </p>
            <figure id="figure-box-msup">
              <img src="figures/msupbox.svg"/>
              <figcaption>Box model for the <code>&lt;msup&gt;</code> element</figcaption>
            </figure>
          </section>
          <section>
            <h5>Base with subscript and superscript</h5>
            <p>
              The <code>&lt;msubsup&gt;</code> element is laid out as shown on
              <a href="#figure-box-msup"></a>.
              The baseline is the baseline of the base while the baseline of
              the script is shifted down by <code>SubShift</code> and the
              superscript is shifted up by <code>SuperShift</code> which are
              initially set to the minimal values honoring the following
              conditions:
            </p>
            <ol>
              <li>
                <code>SubShift</code> is at least
                <a>SuperscriptShiftUpCramped</a> if the
                <code>&lt;msup&gt;</code> element is <a>cramped</a> or at least
                <a>SuperscriptShiftUp</a> otherwise.
              </li>
              <li>
                The top of the subscript <code>SubTop</code> with respect to
                the baseline is not above <a>SubscriptTopMax</a>.
              </li>
              <li>
                The drop <code>SuperscriptBaselineDrop</code> from the top of
                the base to the baseline of the superscript is at most
                <a>SuperscriptBaselineDropMax</a>.
              </li>
              <li>
                <code>SubShift</code> is at least
                <a>SuperscriptShiftUpCramped</a> if the
                <code>&lt;msup&gt;</code> element is
                <a>cramped</a> or at least
                <a>SuperscriptShiftUp</a> otherwise.
              </li>
              <li>
                The bottom of the superscript <code>SuperBottom</code> with
                respect to the baseline is not below
                <a>SuperscriptBottomMin</a>.
              </li>
              <li>
                The drop <code>SubscriptBaselineDrop</code> from
                the bottom of the base to the the baseline of the subscript is
                at least <a>SubscriptBaselineDropMin</a>.
              </li>
            </ol>
            <p>
              After initializing
              <code>SubShift</code> and <code>SuperShift</code>,
              the gap <code>SubSuperGap</code> between the bottom
              of the superscript and the top of the subscript is increased to
              ensure it is at least <a>SubSuperscriptGapMin</a>.
              This is first done by continuing to shift the superscript up as
              long as the <code>SuperBottom</code> does not exceed
              <a>SuperscriptBottomMaxWithSubscript</a>
              and next by continuing to shift the subscript down.
            </p>
            <p>
              When determining the logical box, a space of width
              <a>SpaceAfterScript</a> is added after each script. By default
              the inline-start edges of the scripts are aligned with the
              inline-end edge of the base
              and the superscript is shifted forward by the italic
              correction of the base. However, if the base is an
              <a>embellished operator</a> with
              the <a><code>largeop</code></a> property
              then instead the subscript is
              shifted forward by the italic correction of the base.
            </p>
            <figure id="figure-box-msubsup">
              <img src="figures/msubsupbox.svg"/>
              <figcaption>Box model for the <code>&lt;msubsup&gt;</code> element</figcaption>
            </figure>
            <div class="note" id="msubsup-with-empty-scripts">
              <p>
                Even when the subscript (respectively superscript) is an empty
                box, <code>&lt;subsup&gt;</code>
                does not generally render the same as
                <a href="#base-with-superscript"></a>
                (respectively <a href="#base-with-subscript"></a>)
                because of the additional <code>SubSuperGap</code>.
                Moreover, positioning the empty subscript
                (respectively superscript)
                may also change the total size.
              </p>
              <p>
                In order to keep the algorithm simple, no attempt is made to
                handle empty scripts in a special way.
              </p>
             </div>
          </section>
        </section>
        <section>
          <h4>Underscripts and Overscripts <code>&lt;munder&gt;</code>,
            <code>&lt;mover&gt;</code>, <code>&lt;munderover&gt;</code></h4>
          <p>
            The <dfn><code>&lt;munder&gt;</code></dfn>,
            <dfn><code>&lt;mover&gt;</code></dfn> and
            <dfn><code>&lt;munderover&gt;</code></dfn> elements are used to
            attach
            accents or limits placed under or over a MathML expression.
          </p>
          <p>
            The <code>&lt;munderover&gt;</code> element accepts the attribute
            described in <a href="#global-attributes"></a> as well as the
            following attributes:
          </p>
          <ul>
            <li><a href="#attribute-munderover-accent" class="internalDFN" data-link-type="dfn"><code>accent</code></a></li>
            <li><a href="#attribute-munderover-accentunder" class="internalDFN" data-link-type="dfn"><code>accentunder</code></a></li>
          </ul>
          <p>
            Similarly, the <code>&lt;mover&gt;</code> element
            (respectively <code>&lt;munder&gt;</code> element) accepts the
            attribute described in <a href="#global-attributes"></a>
            as well as the <a href="#attribute-munderover-accent"
                              class="internalDFN"
                              data-link-type="dfn"><code>accent</code></a>
            attribute (respectively the
            <a href="#attribute-munderover-accentunder"
               class="internalDFN"
               data-link-type="dfn"><code>accentunder</code></a> attribute).
          </p>
          <p>
            <dfn id="attribute-munderover-accent"><code>munderover@accent</code></dfn>,
            <dfn id="attribute-munderover-accentunder"><code>munderover@accentunder</code></dfn>,
            attributes, if present, must have values that are <a>booleans</a>.
            User agents must implement them as described in
            <a href="#displaystyle-and-scriptlevel-in-scripts"></a>.
          </p>
          <section>
            <h5>Children of <code>&lt;munder&gt;</code>,
            <code>&lt;mover&gt;</code>, <code>&lt;munderover&gt;</code></h5>
            <div class="issue" data-number="15">Decide how to handle invalid
              markup.</div>
            <p>
              If the <code>&lt;munder&gt;</code> element
              has less or more than two children, its layout algorithm
              is the same as the <a><code>&lt;mrow&gt;</code></a> element.
              Otherwise, the first child is called the
              <em>base</em> and the second child is called the
              <em>underscript</em>.
            </p>
            <p>
              If the <code>&lt;mover&gt;</code> element
              has less or more than two children, its layout algorithm
              is the same as the <a><code>&lt;mrow&gt;</code></a> element.
              Otherwise, the first child is called the
              <em>base</em> and the second child is called the
              <em>overscript</em>.
            </p>
            <p>
              If the <code>&lt;munderover&gt;</code> element
              has less or more than three children, its layout algorithm
              is the same as the <a><code>&lt;mrow&gt;</code></a> element.
              Otherwise, the first child is called the
              <em>base</em>, the second child is called the <em>underscript</em>
              and its third child is called
              the <em>overscript</em>.
            </p>
            <p>
              If the base is an
              <a>embellished operator</a> with the
              <a><code>movablelimits</code></a> property
              then the underscript and overscript are actually
              drawn as subscript and superscript positions.
              Then <code>&lt;mover&gt;</code>, <code>&lt;mover&gt;</code> and
              <code>&lt;munderover&gt;</code> layout algorithms are respectively
              the same as the ones described for
              <code>&lt;msub&gt;</code>, <code>&lt;msup&gt;</code> and
              <code>&lt;msubsup&gt;</code> in
              <a href="#base-with-subscript"></a>,
              <a href="#base-with-superscript"></a> and
              <a href="#base-with-subscript-and-superscript"></a>.
            </p>
            <p>
              Otherwise, the
              <code>&lt;mover&gt;</code>, <code>&lt;mover&gt;</code> and
              <code>&lt;munderover&gt;</code> layout algorithms are respectively
              described in
              <a href="#base-with-underscript"></a>,
              <a href="#base-with-overscript"></a> and
              <a href="#base-with-underscript-and-overscript"></a>
            </p>
          </section>
          <section>
            <h4>Base with underscript</h4>
            <p>
              The algorithm is the same as the one described in
              <a href="#base-with-underscript-and-overscript"></a>
              except that we only set the <code>UnderShift</code> to position
              the underscript and add <code>UnderExtraDescender</code> space
              below it. There is no need to position an overscript nor to add
              extra <code>OverExtraDescender</code> space above it.
            </p>
            <figure id="figure-box-munder">
              <img src="figures/munderbox.svg"/>
              <figcaption>Box model for the <code>&lt;munder&gt;</code> element</figcaption>
            </figure>
          </section>
          <section>
            <h4>Base with overscript</h4>
            <p>
              The algorithm is the same as the one described in
              <a href="#base-with-underscript-and-overscript"></a>
              except that we only set the <code>OverShift</code> to position
              the overscript and add <code>OverExtraDescender</code> space
              above it. There is no need to position an underscript nor to add
              extra <code>UnderExtraDescender</code> space below it.
            </p>
            <figure id="figure-box-mover">
              <img src="figures/moverbox.svg"/>
              <figcaption>Box model for the <code>&lt;mover&gt;</code> element</figcaption>
            </figure>
          </section>
          <section>
            <h4>Base with underscript and overscript</h4>
            <p>
            The general layout of <code>&lt;munderover&gt;</code> is shown on
            <a href="#figure-box-munderover"></a>.
            The overscript is placed above the base, the underscript below the
            base and by default are aligned with respect to their geometrical
            center.
            If the overscript is an accent and has a
            <a>top accent attachment</a> value, then this value may be used to
            horizontally align the accent instead of its geometrical center.
            <code>OverShift</code> is the distance between the top ink
            of the base and the baseline of the overscript,
            <code>OverGap</code> is the distance between the top ink of the
            base and the bottom ink of the overscript,
            <code>OverExtraAscender</code> is extra space to add above the
            overscript when determining the logical box.
            <code>UnderShift</code>, <code>UnderGap</code> and
            <code>UnderExtraDescender</code> are defined similarly for the
            underscript. Three cases are considered, in the following order:
          </p>
          <ol>
            <li>
              <p>
                The base is an
                <a>embellished operator</a> with the
                <a><code>largeop</code></a> property.
                <code>OverShift</code> is and <code>UnderShift</code> are set
                to the minimal values satisfying the following conditions:
              </p>
              <ul>
                <li><code>OverGap</code> is at least <a>UpperLimitGapMin</a></li>
                <li><code>OverShift</code> is at least <a>UpperLimitBaselineRiseMin</a></li>
                <li><code>UnderGap</code> is at least <a>LowerLimitGapMin</a></li>
                <li><code>UnderShift</code> is at least <a>LowerLimitBaselineDropMin</a>.</li>
              </ul>
              <p>
                <code>OverExtraAscender</code> and
                <code>UnderExtraDescender</code> are set to zero. The
                underscript is shifted backward by half the italic correction of
                the base.
                The overscript is shifted forward by half the italic correction
                of the base.
              </p>
            </li>
            <li>
              <p>
                The base is a horizontal
                <a>embellished operator</a> with the
                <a><code>stretchy</code></a> property.
                <code>OverShift</code> is and <code>UnderShift</code> are set
                to the minimal values satisfying the following conditions:
              </p>
              <ul>
                <li><code>OverGap</code> is at least
                  <a>StretchStackGapBelowMin</a></li>
                <li><code>OverShift</code> is at least
                  <a>StretchStackTopShiftUp</a>
                </li>
                <li><code>UnderGap</code> is at least
                  <a>StretchStackGapAboveMin</a></li>
                <li><code>UnderShift</code> is at least
                  <a>StretchStackBottomShiftDown</a></li>
              </ul>
              <code>OverExtraAscender</code> and
              <code>UnderExtraDescender</code> are set to zero.
            </li>
            <li>Otherwise,
              <code>OverShift</code> and <code>UnderShift</code> are set to
              values such that
              <ul>
                <li>
                  <code>UnderGap</code> is equal to <a>UnderbarVerticalGap</a>
                  if the underscript is not an accent and to zero otherwise.
                </li>
                <li>
                  <code>OverGap</code> is equal to
                  <ol>
                    <li><a>OverbarVerticalGap</a> if the overscript is not an accent.</li>
                    <li>Or <a>AccentBaseHeight</a> minus the ascent of the base if this difference is nonnegative.</li>
                    <li>Or 0 otherwise.</li>
                  </ol>
                </li>
              </ul>
              <code>OverExtraAscender</code> and
              <code>OverExtraAscender</code> are respectively set to
              <a>OverbarExtraAscender</a> and <a>UnderbarExtraDescender</a>.
            </li>
          </ol>
          <figure id="figure-box-munderover">
            <img src="figures/munderoverbox.svg"/>
            <figcaption>Box model for the <code>&lt;munderover&gt;</code> element</figcaption>
          </figure>
          <div class="note">
            For accent overscripts and bases with ascents that are at most
            <a>AccentBaseHeight</a>, the rule from
            [[OPEN-FONT-FORMAT]] [[?TEXBOOK]] is actually to align the
            baselines of the overscripts and of the bases. This assumes that
            accent glyphs are designed in such a way that their ink bottoms are
            more or less <a>AccentBaseHeight</a> above their baselines. Hence,
            the previous rule will guarantee that all the overscript bottoms
            are aligned while still avoiding collision with the bases.
            However, MathML can have arbitrary accent overscripts
            a more general and simpler rule is provided above: Ensure
            that the bottom of overscript is at least
            <a>AccentBaseHeight</a> above the baseline of the base.
          </div>
          <div class="note">
            <p>
              When the underscript (respectively overscript) is an empty
              box, the base and overscript are laid out the same as for
              <a href="#base-with-overscript"></a>
              (respectively <a href="#base-with-underscript"></a>)
              but the position of the empty underscript (respectively
              overscript) will add some extra space below the base.
            </p>
            <p>
              In order to keep the algorithm simple, no attempt is made to
              handle empty scripts in a special way.
            </p>
          </div>
          </section>
        </section>
        <section>
          <h4>Prescripts and Tensor Indices <code>&lt;mmultiscripts&gt;</code></h4>
          <p>
            Presubscripts and tensor notations are represented
            the <dfn><code>&lt;mmultiscripts&gt;</code></dfn>
            with hints given by the
            <dfn><code>&lt;mprescripts&gt;</code></dfn>
            (to distinguish postscripts and prescripts)
            and
            <dfn><code>&lt;none&gt;</code></dfn> elements
            (to indicate empty scripts).
            These element accept the attributes described in
            <a href="#global-attributes"></a>.
          </p>
          <p>
            The empty
            <code>&lt;mprescripts&gt;</code> and <code>&lt;none&gt;</code>
            elements are laid out as an <a><code>&lt;mrow&gt;</code></a>
            element.
          </p>
          <div class="issue" data-number="15">Decide how to handle invalid
            markup.</div>
          <p>
            A valid <code>&lt;mmultiscripts&gt;</code> element contains the
            following children:
          </p>
          <ul>
            <li>
              A first child, called the <em>base</em> that is not a
              an <a><code>&lt;mprescripts&gt;</code></a> element.
            </li>
            <li>
              Followed by an even number of children called
              <em>postscripts</em>, none of them being a
              <a><code>&lt;mprescripts&gt;</code></a> element.
              These scripts form a (possibly empty) list of
              <em>subscript/superscript pairs</em>.
            </li>
            <li>Optionally followed by
              an <a><code>&lt;mprescripts&gt;</code></a> element and
              an even number of children called
              <em>prescripts</em>, none of them being a
              <a><code>&lt;mprescripts&gt;</code></a> element.
              These scripts form a (possibly empty) list of
              <em>subscript/superscript pairs</em>.
            </li>
          </ul>
          <p>
            If an <code>&lt;mmultiscripts&gt;</code> element is not valid then
            it is laid out the same as the
            <a><code>&lt;mrow&gt;</code></a> element.
            Otherwise the layout algorithm is explained below.
          </p>
          <div class="note">
            The <code>&lt;none&gt;</code> element is preserved for backward
            compatibility reasons but is actually not taken into account
            in the layout algorithm.
          </div>
          <section>
            <h5>Base with prescripts and postscripts</h5>
            <p>
              The <code>&lt;mmultiscripts&gt;</code> element is laid out as
              shown on <a href="#figure-box-mmultiscripts"></a>.
            </p>
            <ul>
              <li>
                The horizontal positions are determined in the following order:
                inline-start edge of <code>&lt;mmultiscripts&gt;</code>,
                <a>SpaceAfterScript</a>,
                first prescript pair,
                <a>SpaceAfterScript</a>,
                second prescript pair,
                ...,
                <a>SpaceAfterScript</a>,
                last prescript pair,
                base,
                first postscript pair,
                <a>SpaceAfterScript</a>,
                second postscript pair,
                <a>SpaceAfterScript</a>,
                ...,
                last postscript pair,
                width <a>SpaceAfterScript</a>,
                inline-end edge of <code>&lt;mmultiscripts&gt;</code>.
              </li>
              <li>
                Each postscript pair is shift forward
                by the italic correction of the base as described in
                <a href="#base-with-subscript-and-superscript"></a>.
              </li>
              <li>
                For prescript pairs, the inline-end edges of the subscript
                and superscript are aligned.
                For postscript pairs, the inline-start edges of the subscript
                and superscript are aligned.
              </li>
              <li>
                <code>SubShift</code> (respectively <code>SuperShift</code>)
                is calculated by taking the maximum of all subshifts
                (respectively supershifts) of each
                subscript/superscript pair determined using the algorithm for
                <a href="#base-with-subscript-and-superscript"></a>.
                Then the baseline of <code>&lt;mmultiscripts&gt;</code>
                is the baseline of the base, the baselines of
                the subscripts are shifted down by <code>SubShift</code>
                and the baselines of superscripts are shifted up by
                <code>SuperShift</code>.
              </li>
              <li>
                The <code>&lt;mprescript&gt;</code> element, if any, is
                positioned at the same coordinate as the base.
              </li>
            </ul>
            <figure id="figure-box-mmultiscripts">
              <img src="figures/mmultiscriptsbox.svg"/>
              <figcaption>Box model for the <code>&lt;mmultiscripts&gt;</code> element</figcaption>
            </figure>
            <div class="note">
              <p>
                An <code>&lt;mmultiscripts&gt;</code> with only one
                postscript pair is laid out the same as a
                <code>&lt;msubsup&gt;</code> with the same children.
                However, as
                <a href="#msubsup-with-empty-scripts">noticed for
                  <code>&lt;msubsup&gt;</code></a>,
                if additionally the subscript (respectively superscript) is an
                empty box then it is not necessarily laid out the same as an
                <code>&lt;msub&gt;</code>
                (respectively <code>&lt;msup&gt;</code>) element.
              </p>
              <p>
                In order to keep the algorithm simple, no attempt is made to
                handle empty or <code>&lt;none&gt;</code> scripts in a special
                way.
              </p>
            </div>
          </section>
        </section>
        <section>
          <h4>Displaystyle and scriptlevel in scripts</h4>
          <p>
            For all MathML elements used for scripts and limits schemata,
            the first child is the base while the other children
            are scripts. In these scripts, the rule of thumb is to set
            <a><code>displaystyle</code></a> to <code>false</code>
            and to increment <a><code>scriptlevel</code></a>.
            However, when an overscript (respectively underscript)
            has an <a href="#attribute-munderover-accent" class="internalDFN" data-link-type="dfn"><code>accent</code></a>
            (respecitvely <a href="#attribute-munderover-accentunder" class="internalDFN" data-link-type="dfn"><code>accentunder</code></a>)
            attribute that is case-insensitively equal to
            to <code>"true"</code> then
            the <a><code>scriptlevel</code></a> is not incremented.
          </p>
          <p>
            The
            <a href="#user-agent-stylesheet"></a> must contain the following
            style in order to implement this behavior:
          </p>
          <pre class="css" data-include="user-agent-stylesheet/scripts.css"></pre>
          <div class="issue" data-number="76">
            In [[MathML3]] specification, the scriptlevel shouldn't be
            incremented either if the underscript/overscript is an
            <a>embellished operator</a> with the
            <a><code>accent</code></a> property.
          </div>
        </section>
      </section>
      <section>
        <h3>Tabular Math</h3>
        <p>
          Matrices, arrays and other table-like mathematical notation are marked up
          using
          <a><code>&lt;mtable&gt;</code></a>
          <a><code>&lt;mtr&gt;</code></a>
          <a><code>&lt;mtd&gt;</code></a>
          elements.  These  elements are similar to the
          <a data-cite="HTML#the-table-element"><code>&lt;table&gt;</code></a>,
          <a data-cite="HTML#the-tr-element"><code>&lt;tr&gt;</code></a>
          and
          <a data-cite="HTML#the-td-element"><code>&lt;td&gt;</code></a>
          elements of [[HTML]].
        </p>
        <div class="issue">
          This describes a very partial support for [[MathML3]] tables.
          Do we want more? Should CSS be extended to cover math table's use cases?
        </div>
        <section>
          <h4>Table or Matrix <code>&lt;mtable&gt;</code></h4>
          <p>The <dfn><code>&lt;mtable&gt;</code></dfn> is laid out as an
            <code>inline-table</code> and sets
            <code>displaystyle</code> to <code>false</code>. The
            <a href="#user-agent-stylesheet">user agent stylesheet</a> must contain
            the following rules in order to implement these properties:
          </p>
          <pre data-include="user-agent-stylesheet/mtable.css"></pre>
          <p>
            The <code>&lt;mtable&gt;</code> accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following
            attribute:
            <ul>
              <li><a>frame</a></li>
            </ul>
          <p>
            The <dfn>frame</dfn> attribute, if present, must be case-insensitively
            equal to the value <code>none</code>, <code>solid</code> or
            <code>dashed</code>. The <a href="#user-agent-stylesheet">user agent
              stylesheet</a> must contain the following rules in order to implement
            that attribute:
          </p>
          <pre data-include="user-agent-stylesheet/mtable-frame.css"></pre>
          <div class="issue">TODO: Improve description here and handle the case
            when height &lt; AxisHeight </div>
          <p>
            The size of the logical box of the <code>&lt;mtable&gt;</code>
            are provided by CSS layout. The math axis is aligned with the center of
            the table: Ascent is height plus
            <a>AxisHeight</a> and line-descent the height minus
            <a>AxisHeight</a>. The ink box is the same as the
            logical box.
          </p>
        </section>
        <section>
          <h4>Row in Table or Matrix <code>&lt;mtr&gt;</code></h4>
          <p>
            The <dfn><code>&lt;mtr&gt;</code></dfn> is laid out as
            <code>table-row</code>. The
            <a href="#user-agent-stylesheet">user agent stylesheet</a> must contain
            the following rules in order to implement that behavior:
          </p>
          <pre data-include="user-agent-stylesheet/mtr.css"></pre>
          <p>
            The <code>&lt;mtr&gt;</code> accepts the attributes described
            in <a href="#global-attributes"></a>.
          </p>
        </section>
        <section>
          <h4>Entry in Table or Matrix <code>&lt;mtd&gt;</code></h4>
          <p>
            The <dfn><code>&lt;mtd&gt;</code></dfn> is laid out as
            a <code>table-cell</code> with content centered in the cell and
            a default padding. The
            <a href="#user-agent-stylesheet">user agent stylesheet</a> must contain
            the following rules:
          </p>
          <pre data-include="user-agent-stylesheet/mtd.css"></pre>
          <p>
            The <code>&lt;mtr&gt;</code> accepts the attributes described
            in <a href="#global-attributes"></a> as well as the following attributes:
          </p>
          <ul>
            <li><a>columnspan</a></li>
            <li><a>rowspan</a></li>
          </ul>
          <p>
            The <dfn><code>columnspan</code></dfn> (respectively
            <dfn><code>rowspan</code></dfn>) attribute has the same
            syntax and semantic as the
            <a data-cite="HTML#attr-tdth-colspan"><code>&lt;colspan&gt;</code></a>
            (respectively
            <a data-cite="HTML#attr-tdth-rowspan"><code>&lt;rowspan&gt;</code></a>)
            attribute on the <code>&lt;td&gt;</code> element from [[HTML]].
          </p>
          <div class="note">
            The name for the column spanning attribute is
            <code>columnspan</code> as in [[MathML3]] and not
            <code>colspan</code> as in [[HTML]].
          </div>
        </section>
      </section>
      <section>
        <h3>Enlivening Expressions</h3>
        <p>
          Historically, the
          <dfn><code>&lt;maction&gt;</code></dfn>
          element provides a mechanism
          for binding actions to expressions.
        </p>
        <p>
          The <code>&lt;maction&gt;</code> element accepts the attributes described
          in <a href="#global-attributes"></a> as well as the following
          attributes:
        </p>
        <ul>
          <li><code>actiontype</code></li>
          <li><code>selection</code></li>
        </ul>
        <p>
          The <dfn>actiontype</dfn> and <dfn>selection</dfn> attributes are
          not taken into account in the present specification but may be used
          by authors to implement custom actions on the
          <code>&lt;maction&gt;</code> element.
        </p>
        <p>
          The layout algorithm of the <code>&lt;maction&gt;</code> element
          the same as the <code>&lt;mrow&gt;</code> element.
          The <a href="#user-agent-stylesheet">user agent stylesheet</a>
          must contain the following rules in order to hide all but
          its first child, which is the default behavior for the legacy actiontype
          values:
        </p>
        <pre class="css" data-include="user-agent-stylesheet/maction.css"></pre>
        <div class="note">
          While <code>&lt;maction&gt;</code> is preserved for backward compatibility reasons
          with legacy documents and existing tools, modern authors and tools are strongly
          encouraged to use CSS for styling.
        </div>
      </section>
      <section>
        <h3>Semantics and Presentation</h3>
        <p>
          The
          <dfn><code>&lt;semantics&gt;</code></dfn>
          element is the container element that associates
          annotations with a MathML expression. Typically, the
          <code>&lt;semantics&gt;</code> element has as its first child a
          MathML expression to be annotated while subsequent children represent
          text annotations within an <dfn><code>&lt;annotation&gt;</code></dfn>
          element, or more complex markup annotations within
          an <dfn><code>&lt;annotation-xml&gt;</code></dfn> element.
        </p>
        <p>
          The <code>&lt;semantics&gt;</code> element accepts the attributes
          described in <a href="#global-attributes"></a>. Its layout algorithm
          is the same as the <a><code>&lt;mrow&gt;</code></a> element.
          The <a href="#user-agent-stylesheet">user agent stylesheet</a>
          must contain the following rule in order to only render the annotated
          MathML expression:
        </p>
        <pre data-include="user-agent-stylesheet/semantics.css"></pre>
        <p>
          The <code>&lt;annotation-xml&gt;</code> and
          <code>&lt;annotation&gt;</code> element accepts the attributes
          described in <a href="#global-attributes"></a> as well as the
          following attribute:
        </p>
        <ul>
          <li><code>encoding</code></li>
        </ul>
        <p>
          The <dfn>encoding</dfn> attribute is not taken into account in the
          present specification but it is intended to distinguish annotations
          for <a data-cite="HTML#html-integration-point">HTML integration point</a>, clipboard copy, alternative rendering etc
        </p>
        <p>
          The layout algorithm of the <code>&lt;annotation-xml&gt;</code>
          element is the same as the <a><code>&lt;mrow&gt;</code></a> element.
          The layout algorithm of the <code>&lt;annotation&gt;</code>
          element is the same as the <a><code>&lt;mtext&gt;</code></a> element.
        </p>
        <div class="note">
          CSS can be used to render alternative annotations e.g.
          <pre class="css">
            /* Hide the annotated child. */
            semantics > :first-child { display: none; }
             /* Show all text annotations. */
            semantics > annotation { display: block; }
            /* Show all HTML annotations. */
            semantics > annotation-xml[encoding="text/html" i],
            semantics > annotation-xml[encoding="application/xhtml+xml" i] {
              display: block;
            }
          </pre>
        </div>
      </section>
    </section>
    <section class="normative">
      <h2>CSS Extensions for Math Layout</h2>
      <section>
        <h3>New <code>text-transform</code> values</h3>
        <p>The <dfn><code>text-transform</code></dfn> property
          from
          is extended with new values:
        </p>
        <code><a data-cite="CSS-TEXT-3#text-transform-property">&lt;text-transform-old&gt;</a> <a data-cite="CSS-VALUES-3#comb-one">|</a> math-auto | math-bold | math-italic | math-bold-italic | math-double-struck | math-bold-fraktur | math-script | math-bold-script | math-fraktur | math-sans-serif | math-bold-sans-serif | math-sans-serif-italic | math-sans-serif-bold-italic | math-monospace | math-initial | math-tailed | math-looped | math-stretched</code>
        <p>
          On text nodes containing a unique character, <code>math-auto</code> has
          the same effect as <code>math-italic</code>, otherwise it has no effects.
        </p>
        <p>
          For the
          <code>math-bold</code>,
          <code>math-italic</code>,
          <code>math-bold-italic</code>,
          <code>math-double-struck</code>,
          <code>math-bold-fraktur</code>,
          <code>math-script</code>,
          <code>math-bold-script</code>,
          <code>math-fraktur</code>,
          <code>math-sans-serif</code>,
          <code>math-bold-sans-serif</code>,
          <code>math-sans-serif-italic</code>,
          <code>math-sans-serif-bold-italic</code>,
          <code>math-monospace</code>,
          <code>math-initial</code>,
          <code>math-tailed</code>,
          <code>math-looped</code> and
          <code>math-stretched</code>
          values, the transformed text is
          obtained by performing conversion of each character according to
          the corresponding
          <a href="#bold-mappings">bold</a>,
          <a href="#italic-mappings">italic</a>,
          <a href="#bold-italic-mappings">bold-italic</a>,
          <a href="#double-struck-mappings">double-struck</a>,
          <a href="#bold-fraktur-mappings">bold-fraktur</a>,
          <a href="#script-mappings">script</a>,
          <a href="#bold-script-mappings">bold-script</a>,
          <a href="#fraktur-mappings">fraktur</a>,
          <a href="#sans-serif-mappings">sans-serif</a>,
          <a href="#bold-sans-serif-mappings">bold-sans-serif</a>,
          <a href="#sans-serif-italic-mappings">sans-serif-italic</a>,
          <a href="#sans-serif-bold-italic-mappings">sans-serif-bold-italic</a>,
          <a href="#monospace-mappings">monospace</a>,
          <a href="#initial-mappings">initial</a>,
          <a href="#tailed-mappings">tailed</a>,
          <a href="#looped-mappings">looped</a>,
          <a href="#stretched-mappings">stretched</a> tables.
        </p>
        <p>
          User agents may decide to rely on italic, bold and bold-italic
          font-level properties when available fonts lack the proper glyphs to
          perform <code>math-auto</code>, <code>math-italic</code>,
          <code>math-bold</code>, <code>math-bold-italic</code> character-level
          transforms.
        </p>
      </section>
      <section>
        <h3>The <code>math-style</code> property</h3>
        <table>
          <tbody>
            <tr>
              <th>Name:</th>
              <td>
                <dfn><code>math-style</code></dfn>
              </td>
            </tr>
            <tr><th>Value:</th><td><code>display | inline</code></td></tr>
            <tr><th>Initial:</th><td><code>inline</code></td></tr>
            <tr><th>Applies to:</th><td>All elements</td></tr>
            <tr><th>Inherited:</th><td>yes</td></tr>
            <tr><th>Percentages:</th><td>n/a</td></tr>
            <tr><th>Media:</th><td>visual</td></tr>
            <tr><th>Computed value:</th><td>specified keyword</td></tr>
            <tr><th>Canonical order:</th><td>n/a</td></tr>
            <tr><th>Animation type:</th><td>not animatable</td></tr>
          </tbody>
        </table>
        <p>
          If the value of <code>math-style</code> is <code>inline</code>, the math
          layout on descendants should try to minimize the
          <a data-cite="CSS-WRITING-MODES-3#extent">logical height</a>.
          This includes how
          <a data-cite="CSS-FONTS-3#font-size-prop"><code>font-size</code></a>
          is changed when <a><code>math-script-level</code></a> is
          <code>auto</code> as well
          miscelleanous layout rules described in details in
          <a href="#presentation-markup"></a>.
          If the value of <code>math-style</code> is <code>display</code>, the math
          layout should not take such constraints into consideration.
        </p>
      </section>
      <section>
        <h3>The <code>math-script-level</code> property</h3>
        <table>
          <tbody>
            <tr>
              <th>Name:</th>
              <td>
                <dfn><code>math-script-level</code></dfn>
              </td>
            </tr>
            <tr><th>Value:</th><td><code>auto | add(&lt;integer&gt;) | &lt;integer&gt;</code></td></tr>
            <tr><th>Initial:</th><td><code>0</code></td></tr>
            <tr><th>Applies to:</th><td>All elements</td></tr>
            <tr><th>Inherited:</th><td>yes</td></tr>
            <tr><th>Percentages:</th><td>n/a</td></tr>
            <tr><th>Media:</th><td>visual</td></tr>
            <tr><th>Computed value:</th><td>see individual properties</td></tr>
            <tr><th>Canonical order:</th><td>n/a</td></tr>
            <tr><th>Animation type:</th><td>not animatable</td></tr>
          </tbody>
        </table>
        <p>
          If the specified value of <code>math-script-level</code> is
          <code>auto</code> and the inherited value of <code>math-style</code> is
          <code>display</code> then the computed value of
          <code>math-script-level</code> is the inherited value.
        </p>
        <p>If the specified value of <code>math-script-level</code> is
          <code>auto</code> and the inherited value of <code>math-style</code> is
          <code>inline</code> then the computed value of
          <code>math-script-level</code> is the inherited value plus one.
        </p>
        <p>
          If the specified value of <code>math-script-level</code> is of the form
          <code>add(&lt;integer&gt;)</code> then the computed value of
          <code>math-script-level</code> is the inherited value plus the specified
          integer.
        </p>
        <p>
          If the specified value of <code>math-script-level</code> is of the form
          <code>&lt;integer&gt;</code> then the computed value of
          <code>math-script-level</code> is set to the specified integer.
        </p>
        <p>
          If
          <a data-cite="CSS-FONTS-3#font-size-prop"><code>font-size</code></a>
          is specified or if the specified value of
          <code>math-script-level</code> is <code>initial</code> then
          <code>math-script-level</code> does not affect the computed value of
          <code>font-size</code>. Otherwise, the computed value of
          <code>font-size</code> is obtained by multiplying the inherited value of
          <code>font-size</code> by a nonzero scale factor calculated by the
          following procedure:
        </p>
        <ol>
          <li>Let A be the inherited <code>math-script-level</code>, B the computed
            <code>math-script-level</code>, C be 0.71 and S be 1.0</li>
          <li>
            <ul>
              <li>If A = B then return S.</li>
              <li>If B &lt; A, swap A and B and set <code>InvertScaleFactor</code> to true.</li>
              <li>Otherwise B &gt; A and set <code>InvertScaleFactor</code> to false.</li>
            </ul>
          </li>
          <li>Let E be B - A &gt; 0.</li>
          <li>If the inherited font has an OpenType MATH table:
            <ul>
              <li>If A ≤ 0 and B ≥ 2 then multiply S by <a>scriptScriptPercentScaleDown</a> and
                decrement E by 2.</li>
              <li>Otherwise if A = 1 then multiply S by
                <a>scriptScriptPercentScaleDown</a> / <a>scriptPercentScaleDown</a> and
                decrement E by 1.</li>
              <li>Otherwise if B = 1 then multiply S by <a>scriptPercentScaleDown</a>
                and decrement E by 1.</li>
            </ul>
          </li>
          <li>Multiply S by C<sup>E</sup></li>
          <li>Return S if <code>InvertScaleFactor</code> is false and 1/S otherwise.</li>
        </ol>
      </section>
    </section>
    <section class="normative">
      <h2>OpenType <code>MATH</code> table</h2>
      <p>
        This chapter describes features provided by <code>MATH</code> table
        of an OpenType font [[OPEN-FONT-FORMAT]]. Throughout this chapter,
        a C-like notation
        <code>Table.Subtable1[index].Subtable2.Parameter</code> is used to
        denote OpenType parameters.
        Such parameters may not be available (e.g. if the font lack one of the
        subtable, has an invalid offset, etc) and so fallback options are
        provided.
      </p>
      <div class="note">
        It is strongly encouraged to render MathML with a math font with
        the proper OpenType features. There is no guarantee that the fallback
        options provided will provide good enough rendering.
      </div>
      <p>
        OpenType values expressed in design units (perhaps indirectly via a
        <code>MathValueRecord</code> entry) are scaled to appropriate values
        for layout purpose, taking into account
        <code>head.unitsPerEm</code>, CSS
        <a data-cite="CSS-FONTS-3#font-size-prop"><code>font-size</code></a>
        or zoom level.
      </p>
      <section>
        <h3>Layout constants (<code>MathConstants</code>)</h3>
        <div class="issue" data-number="69">Define fallback values</div>
        <p>These are global layout constants for a given mathematical font:</p>
        <dl>
          <dt><dfn>scriptPercentScaleDown</dfn></dt>
          <dd>
            <code>MATH.MathConstants.scriptPercentScaleDown / 100</code> or
            0.71 if <code>MATH.MathConstants.scriptPercentScaleDown</code> is
            null or not available.
          </dd>
          <dt><dfn>scriptScriptPercentScaleDown</dfn></dt>
          <dd>
            <code>MATH.MathConstants.scriptScriptPercentScaleDown / 100</code> or
            0.5041 if
            <code>MATH.MathConstants.scriptScriptPercentScaleDown</code> is
            null or not available.
          </dd>
          <dt><dfn>displayOperatorMinHeight</dfn></dt>
          <dd><code>MATH.MathConstants.displayOperatorMinHeight</code> or ?? if the constant is not available.</dd>
          <dt><dfn>axisHeight</dfn></dt>
          <dd><code>MATH.MathConstants.axisHeight</code> or ?? if the constant is not available.</dd>
          <dt><dfn>accentBaseHeight</dfn></dt>
          <dd><code>MATH.MathConstants.accentBaseHeight</code> or ?? if the constant is not available.</dd>
          <dt><dfn>subscriptShiftDown</dfn></dt>
          <dd><code>MATH.MathConstants.subscriptShiftDown</code> or ?? if the constant is not available.</dd>
          <dt><dfn>subscriptTopMax</dfn></dt>
          <dd><code>MATH.MathConstants.subscriptTopMax</code> or ?? if the constant is not available.</dd>
          <dt><dfn>subscriptBaselineDropMin</dfn></dt>
          <dd><code>MATH.MathConstants.subscriptBaselineDropMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>superscriptShiftUp</dfn></dt>
          <dd><code>MATH.MathConstants.superscriptShiftUp</code> or ?? if the constant is not available.</dd>
          <dt><dfn>superscriptShiftUpCramped</dfn></dt>
          <dd><code>MATH.MathConstants.superscriptShiftUpCramped</code> or ?? if the constant is not available.</dd>
          <dt><dfn>superscriptBottomMin</dfn></dt>
          <dd><code>MATH.MathConstants.superscriptBottomMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>superscriptBaselineDropMax</dfn></dt>
          <dd><code>MATH.MathConstants.superscriptBaselineDropMax</code> or ?? if the constant is not available.</dd>
          <dt><dfn>subSuperscriptGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.subSuperscriptGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>superscriptBottomMaxWithSubscript</dfn></dt>
          <dd><code>MATH.MathConstants.superscriptBottomMaxWithSubscript</code> or ?? if the constant is not available.</dd>
          <dt><dfn>spaceAfterScript</dfn></dt>
          <dd><code>MATH.MathConstants.spaceAfterScript</code> or ?? if the constant is not available.</dd>
          <dt><dfn>upperLimitGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.upperLimitGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>upperLimitBaselineRiseMin</dfn></dt>
          <dd><code>MATH.MathConstants.upperLimitBaselineRiseMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>lowerLimitGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.lowerLimitGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>lowerLimitBaselineDropMin</dfn></dt>
          <dd><code>MATH.MathConstants.lowerLimitBaselineDropMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stackTopShiftUp</dfn></dt>
          <dd><code>MATH.MathConstants.stackTopShiftUp</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stackTopDisplayStyleShiftUp</dfn></dt>
          <dd><code>MATH.MathConstants.stackTopDisplayStyleShiftUp</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stackBottomShiftDown</dfn></dt>
          <dd><code>MATH.MathConstants.stackBottomShiftDown</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stackBottomDisplayStyleShiftDown</dfn></dt>
          <dd><code>MATH.MathConstants.stackBottomDisplayStyleShiftDown</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stackGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.stackGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stackDisplayStyleGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.stackDisplayStyleGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stretchStackTopShiftUp</dfn></dt>
          <dd><code>MATH.MathConstants.stretchStackTopShiftUp</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stretchStackBottomShiftDown</dfn></dt>
          <dd><code>MATH.MathConstants.stretchStackBottomShiftDown</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stretchStackGapAboveMin</dfn></dt>
          <dd><code>MATH.MathConstants.stretchStackGapAboveMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>stretchStackGapBelowMin</dfn></dt>
          <dd><code>MATH.MathConstants.stretchStackGapBelowMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionNumeratorShiftUp</dfn></dt>
          <dd><code>MATH.MathConstants.fractionNumeratorShiftUp</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionNumeratorDisplayStyleShiftUp</dfn></dt>
          <dd><code>MATH.MathConstants.fractionNumeratorDisplayStyleShiftUp</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionDenominatorShiftDown</dfn></dt>
          <dd><code>MATH.MathConstants.fractionDenominatorShiftDown</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionDenominatorDisplayStyleShiftDown</dfn></dt>
          <dd><code>MATH.MathConstants.fractionDenominatorDisplayStyleShiftDown</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionNumeratorGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.fractionNumeratorGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionNumDisplayStyleGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.fractionNumDisplayStyleGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionRuleThickness</dfn></dt>
          <dd><code>MATH.MathConstants.fractionRuleThickness</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionDenominatorGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.fractionDenominatorGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>fractionDenomDisplayStyleGapMin</dfn></dt>
          <dd><code>MATH.MathConstants.fractionDenomDisplayStyleGapMin</code> or ?? if the constant is not available.</dd>
          <dt><dfn>overbarVerticalGap</dfn></dt>
          <dd><code>MATH.MathConstants.overbarVerticalGap</code> or ?? if the constant is not available.</dd>
          <dt><dfn>overbarRuleThickness</dfn></dt>
          <dd><code>MATH.MathConstants.overbarRuleThickness</code> or ?? if the constant is not available.</dd>
          <dt><dfn>overbarExtraAscender</dfn></dt>
          <dd><code>MATH.MathConstants.overbarExtraAscender</code> or ?? if the constant is not available.</dd>
          <dt><dfn>underbarVerticalGap</dfn></dt>
          <dd><code>MATH.MathConstants.underbarVerticalGap</code> or ?? if the constant is not available.</dd>
          <dt><dfn>underbarRuleThickness</dfn></dt>
          <dd><code>MATH.MathConstants.underbarRuleThickness</code> or ?? if the constant is not available.</dd>
          <dt><dfn>underbarExtraDescender</dfn></dt>
          <dd><code>MATH.MathConstants.underbarExtraDescender</code> or ?? if the constant is not available.</dd>
          <dt><dfn>radicalVerticalGap</dfn></dt>
          <dd><code>MATH.MathConstants.radicalVerticalGap</code> or ?? if the constant is not available.</dd>
          <dt><dfn>radicalDisplayStyleVerticalGap</dfn></dt>
          <dd><code>MATH.MathConstants.radicalDisplayStyleVerticalGap</code> or ?? if the constant is not available.</dd>
          <dt><dfn>radicalRuleThickness</dfn></dt>
          <dd><code>MATH.MathConstants.radicalRuleThickness</code> or ?? if the constant is not available.</dd>
          <dt><dfn>radicalExtraAscender</dfn></dt>
          <dd><code>MATH.MathConstants.radicalExtraAscender</code> or ?? if the constant is not available.</dd>
          <dt><dfn>radicalKernBeforeDegree</dfn></dt>
          <dd><code>MATH.MathConstants.radicalKernBeforeDegree</code> or 5/18em if the constant is not available.</dd>
          <dt><dfn>radicalKernAfterDegree</dfn></dt>
          <dd><code>MATH.MathConstants.radicalKernAfterDegree</code> or −10/18em if the constant is not available.</dd>
          <dt><dfn>radicalDegreeBottomRaisePercent</dfn></dt>
          <dd><code>MATH.MathConstants.radicalDegreeBottomRaisePercent / 100.0</code> or 0.6 if the constant is not available.</dd>
        </dl>
      </section>
      <section>
        <h3>Glyph information (<code>MathGlyphInfo</code>)</h3>
        <p>
          These are per-glyph tables for a given mathematical font:
        </p>
        <dl>
          <dt><dfn>MathItalicsCorrectionInfo</dfn></dt>
          <dd>
            The subtable
            <code>MATH.MathGlyphInfo.MathItalicsCorrectionInfo</code>
            of italics correction values. Use the corresponding value in
            <code>MATH.MathGlyphInfo.MathItalicsCorrectionInfo.italicsCorrection</code>
            if there is one for the requested glyph or
            or <code>0</code> otherwise.
          </dd>
          <dt><dfn>MathTopAccentAttachment</dfn></dt>
          <dd>
            The subtable
            <code>MATH.MathGlyphInfo.MathTopAccentAttachment</code>
            of horizontal positioning of top math accents.
            Use the corresponding value in
            <code>MATH.MathGlyphInfo.MathTopAccentAttachment.topAccentAttachment</code>
            if there is one for the requested glyph or
            or half the advance width of the glyph otherwise.
          </dd>
        </dl>
      </section>
      <section>
        <h3>Size variants for operators (<code>MathVariants</code>)</h3>
        <p>
          This section describes how to handle stretchy glyphs of arbitrary
          size using the <code>MATH.MathVariants</code> table.
        </p>
        <section>
          <h4>The <code>GlyphAssembly</code> table</h4>
          <p>
            This section is based on [[?OPEN-TYPE-MATH-IN-HARFBUZZ]].
            For convenience, the following definitions are used:
          </p>
          <ul>
            <li>
              o<sub>min</sub> is
              <code>MATH.MathVariant.minConnectorOverlap</code>.
            </li>
            <li>
              A <code>GlyphPartRecord</code> is an <em>extender</em>
              if and only if
              <code>GlyphPartRecord.partFlags</code> has the
              <code>fExtender</code> flag set.
            </li>
            <li>
              A <code>GlyphAssembly</code> is <em>horizontal</em>
              if it is obtained from
              <code>MathVariant.horizGlyphConstructionOffsets</code>.
              Otherwise it is <em>vertical</em> (and obtained from
              <code>MathVariant.vertGlyphConstructionOffsets</code>).
            <li>
              For a given <code>GlyphAssembly</code> table,
              N<sub>Ext</sub> (respectively
              N<sub>NonExt</sub>) is the number of extenders
              (respectively non-extenders) in
              <code>GlyphAssembly.partRecords</code>.
            </li>
            <li>
              For a given <code>GlyphAssembly</code> table,
              S<sub>Ext</sub> (respectively
              S<sub>NonExt</sub>) is the sum of
              <code>GlyphPartRecord.fullAdvance</code>
              for all extenders (respectively non-extenders) in
              <code>GlyphAssembly.partRecords</code>.
            </li>
          </ul>
          <p>
            User agents must treat the <code>GlyphAssembly</code> as invalid
            if the following conditions are not satisfied:
          </p>
          <ul>
            <li>
              S<sub>Ext</sub> − o<sub>min</sub> N<sub>Ext</sub> > 0.
              Otherwise, the overlap takes at least the full advance of each
              extender.
            </li>
            <li>
              For each <code>GlyphPartRecord</code>
              in <code>GlyphAssembly.partRecords</code>,
              the values of
              <code>GlyphPartRecord.startConnectorLength</code> and
              <code>GlyphPartRecord.endConnectorLength</code>
              must be at least o<sub>min</sub>.
              Otherwise, it is not possible to satisfy the condition of
              <code>MathVariant.minConnectorOverlap</code>.
            </li>
          </ul>
          <p>
            AssembySize(o, r) is the stretch size of a glyph assembly
            built by repeating each extender r times and using the same overlap
            value o between each glyph.
            It is equal to
            S<sub>NonExt</sub> − o (N<sub>NonExt</sub> − 1)
            + r (S<sub>Ext</sub> − o N<sub>Ext</sub>) or, equivalently,
            AssembySize(o, r) =
            S<sub>NonExt</sub> + r S<sub>Ext</sub>
            − o (N<sub>NonExt</sub> + r N<sub>Ext</sub> − 1).
          </p>
          <p>
            <dfn>r<sub>min</sub></dfn> is the minimal number of repetitions
            needed to obtain an assembly size of
            size at least T. It is the maximum between 0 and the ceiling of
            (T − S<sub>NonExt</sub> − o<sub>min</sub> (N<sub>NonExt</sub> − 1)) / (S<sub>Ext</sub> − o<sub>min</sub> N<sub>Ext</sub>).
          </p>
	  <p>
            <dfn>o<sub>max</sub></dfn> is the
            maximum overlap possible to build an assembly of size at least
            T by repeating each extender r<sub>min</sub> times.
            N = N<sub>NonExt</sub> + r<sub>min</sub> N<sub>Ext</sub> is
            the number of glyphs in such an assembly.
            If N ≤ 1, then the overlap is irrelevant, so
            o<sub>max</sub> is defined to be o<sub>min</sub>.
            Otherwise, o<sub>max</sub> is defined to be the minimum of:
          </p>
          <ul>
            <li>o<sub>max,theorical</sub> = (S<sub>NonExt</sub> + r<sub>min</sub> S<sub>Ext</sub> − T) / (N − 1)</li>
            <li>
              <code>GlyphPartRecord.startConnectorLength</code> for all
              the entries in
              <code>GlyphAssembly.partRecords</code>, excluding the
              last one if it is not an extender.
            </li>
            <li>
              <code>GlyphPartRecord.endConnectorLength</code> for all
              the entries in
              <code>GlyphAssembly.partRecords</code>, excluding the
              first one if it is not an extender.
            </li>
            </ul>
	  <p>
            The <dfn>glyph assembly stretch size</dfn>
            for a target size T is
            AssembySize(o<sub>max</sub>, r<sub>min</sub>).
          </p>
          <p>
            The
            <dfn>glyph assembly width</dfn>,
            <dfn>glyph assembly ascent</dfn>
            and <dfn>glyph assembly descent</dfn>
            are defined as follows:
          </p>
          <ul>
            <li>If <code>GlyphAssembly</code> is horizontal,
              the width is the maximum advance width of the glyphs of id
              <code>GlyphPartRecord.glyphID</code> for all the
              <code>GlyphPartRecord</code> in
              <code>GlyphAssembly.partRecords</code>,
              the ascent is the
              <a>glyph assembly stretch size</a>
              for a given target size <code>T</code>
              and the descent is 0.
            </li>
            <li>Otherwise, the <code>GlyphAssembly</code> is vertical,
              the width is <a>glyph assembly stretch size</a>
              for a given target size <code>T</code> while
              the ascent (respectively descent) is the
              the maximum ascent (respectively descent) of the glyphs of id
              <code>GlyphPartRecord.glyphID</code> for all the
              <code>GlyphPartRecord</code> in
              <code>GlyphAssembly.partRecords</code>.
            </li>
          </ul>
          <p>
            The <dfn>glyph assembly height</dfn> is the sum
            of the <a>glyph assembly ascent</a> and
            <a>glyph assembly descent</a>.
          </p>
          <div class="note">
            The horizontal (respectively vertical) metrics for a vertical
            (respectively horizontal) glyph assembly do not depend
            on the target size <code>T</code>.
          </div>
          <p>The <dfn>shaping of the glyph assembly</dfn>
            at position <code>P</code> is performed with the following
            algorithm:
          </p>
          <ol>
            <li>Calculate <a>r<sub>min</sub></a> and
              <a>o<sub>max</sub></a>.</li>
            <li>
              Set <code>(x, y)</code> to <code>P</code> if
              <code>RepetitionCounter</code> to 0 and
              <code>PartIndex</code> to -1.
            </li>
            <li>
              Repeat the following steps:
              <ol>
                <li>
                  If <code>RepetitionCounter</code> is 0, then
                  <ol>
                    <li>Increment <code>PartIndex</code>.</li>
                    <li>If <code>PartIndex</code> is
                      <code>GlyphAssembly.partCount</code>
                      then stop.</li>
                    <li>Otherwise, set
                      <code>Part</code> to
                      <code>GlyphAssembly.partRecords[PartIndex]</code>.
                      Set <code>RepetitionCounter</code> to
                      r<sub>min</sub> if
                      <code>Part</code> is an extender and to 1 otherwise.
                    </li>
                  </ol>
                </li>
                <li>
                  <ul>
                    <li>If the glyph assembly is horizontal then
                      draw the glyph of id
                      <code>Part.glyphID</code>
                      so that its (left, baseline) coordinates
                      are at position <code>(x, y)</code>.
                      Set <code>x</code> to
                      <code>x + Part.fullAdvance −
                        o<sub>max</sub></code>
                    </li>
                    <li>Otherwise (if the glyph assembly is vertical),
                      then
                      draw the glyph of id
                      <code>Part.glyphID</code>
                      so that its (left, bottom) coordinates
                      are at position <code>(x, y)</code>.
                      Set <code>y</code> to
                      <code>y − Part.fullAdvance +
                        o<sub>max</sub></code>
                    </li>
                  </ul>
                </li>
                <li>Decrement <code>RepetitionCounter</code>.</li>
              </ol>
            </li>
          </ol>
        </section>
        <section>
          <h4>Algorithms for glyph stretching</h4>
          <p>
            The <dfn>preferred inline-size of a stretchy glyph in inline
            direction</dfn> for a given target size <code>T</code>
            is calculated using the following algorithm:
          </p>
          <ol>
            <li>
              Set <code>S</code> to the glyph's advance width.
            </li>
            <li>
              If <code>S ≥ T</code>, return <code>S</code>.
            </li>
            <li>
              If there is a <code>MathGlyphConstruction</code> table
              in the <code>MathVariants.horizGlyphConstructionOffsets</code>
              table for the given glyph:
              <ol>
                <li>
                  For each <code>MathGlyphVariantRecord</code> in
                  <code>MathGlyphConstruction.mathGlyphVariantRecord</code> do:
                  <ol>
                    <li>
                      Ensure that <code>S</code> is at least
                      <code>MathGlyphVariantRecord.advanceMeasurement</code>.
                    </li>
                    <li>
                      If <code>S ≥ T</code>, return <code>S</code>.
                    </li>
                  </ol>
                <li>
                  If there is valid <code>GlyphAssembly</code> subtable, ensure
                  that <code>S</code> is at least
                  the <a>glyph assembly stretch size</a>
                  <code>GlyphAssembly</code> for
                  the target size <code>T</code>.
                </li>
              </ol>
            </li>
            <li>Return <code>S</code>.</li>
          </ol>
          <p>
            The <dfn>preferred inline-size of a stretchy glyph in block
            direction</dfn>
            is calculated using the following algorithm:
          </p>
          <ol>
            <li>
              Set <code>S</code> to the glyph's advance width.
            </li>
            <li>
              If there is a <code>MathGlyphConstruction</code> table
              in the <code>MathVariants.vertGlyphConstructionOffsets</code>
              table for the given glyph:
              <ol>
                <li>
                  For each <code>MathGlyphVariantRecord</code> in
                  <code>MathGlyphConstruction.mathGlyphVariantRecord</code>,
                  ensure that <code>S</code> is at least
                  the advance width of the glyph of id
                  <code>MathGlyphVariantRecord.variantGlyph</code>.
                </li>
                <li>
                  If there is valid <code>GlyphAssembly</code> subtable,
                  then ensure
                  that <code>S</code> is at least the
                  <a>glyph assembly width</a>.
                </li>
              </ol>
            </li>
            <li>Return <code>S</code>.</li>
          </ol>
          <div class="note">
            The <a>preferred inline-size of a stretchy glyph in block
            direction</a> will return the maximum width of all possible
            vertical constructions for that glyph.
            In practice, math fonts are designed so that
            vertical constructions almost constant width so possible
            over-estimation of the actual width is small.
          </div>
          <p>
            The algorithm to calculate the
            <dfn>box metrics of a stretchy glyph</dfn>
            in inline direction (respectively block direction)
            for a given target size <code>T</code>
            is the following:
          </p>
          <ol>
            <li>
              Set <code>B</code> to glyph's advanced width, ascent and
              descent.
              If the glyph's advance width
              (respectively height) is at least <code>T</code>
              then return <code>B</code>.
            </li>
            <li>
              If there is a <code>MathGlyphConstruction</code> table
              in the <code>MathVariants.horizGlyphConstructionOffsets</code>
              table  (respectively
              <code>MathVariants.vertGlyphConstructionOffsets</code> table)
              for the given glyph:
              <ol>
                <li>
                  For each <code>MathGlyphVariantRecord</code> in
                  <code>MathGlyphConstruction.mathGlyphVariantRecord</code>:
                  <ol>
                    <li>
                      Set <code>B</code>
                      to the advanced width, ascent and
                      descent of the glyph of id
                      <code>MathGlyphVariantRecord.variantGlyph</code>.
                    </li>
                    <li>
                      If
                      <code>MathGlyphVariantRecord.advanceMeasurement</code>
                      is at least <code>T</code> then return
                      <code>B</code>.
                    </li>
                  </ol>
                <li>
                  If there is valid <code>GlyphAssembly</code> subtable
                  then set <code>B</code> to the
                  <a>glyph assembly width</a>,
                  <a>glyph assembly ascent</a>
                  and <a>glyph assembly descent</a>
                  for the target size <code>T</code>.
                </li>
              </ol>
            </li>
            <li>Return <code>B</code>.</li>
          </ol>
          <div class="issue">Apply a rotation matrix
            in vertical writing mode?</div>
          <p>The algorithm to
            <dfn>shape a stretchy glyph</dfn> in inline direction
            (respectively block direction)
            for a given target size <code>T</code> at a position
            <code>P</code> is the following:
          </p>
          <ol>
            <li>
              If the glyph's advance width (respectively height)
              is at least <code>T</code>
              then draw the glyph so that its (left, baseline) coordinates
              are at position <code>P</code> and exit.
            </li>
            <li>
              If there is a <code>MathGlyphConstruction</code> table
              in the <code>MathVariants.horizGlyphConstructionOffsets</code>
              table (respectively
              <code>MathVariants.vertGlyphConstructionOffsets</code> table)
              for the given glyph:
              <ol>
                <li>
                  For each <code>MathGlyphVariantRecord</code> in
                  <code>MathGlyphConstruction.mathGlyphVariantRecord</code>,
                  if
                  <code>MathGlyphVariantRecord.advanceMeasurement</code>
                  is at least <code>T</code> then draw the glyph
                  so that its (left, baseline) coordinates
                  are at position <code>P</code> and exit.
                </li>
                <li>
                  If there is valid <code>GlyphAssembly</code> subtable
                  then perform
                  <a>shaping of the glyph assembly</a>
                  at position <code>P</code> and exit.
                </li>
              </ol>
            </li>
            <li>Otherwise, exit with a failure.</li>
          </ol>
        </section>
      </section>
    </section>
    <section class="appendix informative">
      <h2>RelaxNG</h2>
      <p>
        This section displays a non-normative Relax NG Schema which
        details the elements and attributes defined by this specification.
        Note that MathML does not need to be expressed in XML syntax, in
        particular the syntax defined by HTML may be used. However this
        schema may be taken as an informal specification of the structure,
        whatever syntax is used.
      </p>
      <pre data-include="mathml-core.rnc"></pre>
    </section>
    <section class="appendix normative">
      <h2>User Agent Stylesheet</h2>
      <pre class="css">@namespace url(http://www.w3.org/1998/Math/MathML);

/* Links */
<span data-include-replace="true" data-include="user-agent-stylesheet/links.css"></span>
/* The &lt;math&gt; element */
<span data-include-replace="true" data-include="user-agent-stylesheet/math.css"></span>
/* &lt;mrow&gt;-like elements */
<span data-include-replace="true" data-include="user-agent-stylesheet/semantics.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/maction.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/merror.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mphantom.css"></span>
/* Tables */
<span data-include-replace="true" data-include="user-agent-stylesheet/mtable.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mtable-frame.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mtr.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mtd.css"></span>
/* Other rules for scriptlevel and displastyle */
<span data-include-replace="true" data-include="user-agent-stylesheet/displaystyle.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mfrac.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/mroot.css"></span><span data-include-replace="true" data-include="user-agent-stylesheet/scripts.css"></span>
      </pre>
    </section>
    <section class="normative">
      <h2>Operator Dictionary</h2>
      <section>
        <h3>Description</h3>
        <p>
          Users agent must use a dictionary of rendering properties for MathML
          operators. The dictionary must include at least the entries of the
          table provided in <a href="#operator-dictionary-entries"></a>.
        </p>
        <p>
          The dictionary is indexed by 'Content' and 'Form' columns together.
          <a href="#operator-fence-separator-or-accent-mo"></a>
          describes how to determine these values for a given operator.
          The 'Rendering' and 'Unicode' columns are provided for convenience,
          but they are just alternative to the 'Content' column.
        </p>
        <p>
          The 'Priority' column is significant for the proper grouping of
          sub-expressions using <code>&lt;mrow&gt;</code>. This is especially
          relevant to the automatic generation of MathML by conversion from
          other formats for displayed mathematics, such as T<sub>E</sub>X,
          which do not always specify how sub-expressions nest.
          However, it does not affect the rendering described in this
          specification and so is not needed for implementing it in user agents.
        </p>
        <p>
          The length valued attributes <a><code>lspace</code></a> and
          <a><code>rspace</code></a> are given here as numeric values ranging
          from 0 to 7 in order to save space in the table. They must be
          interpreted as multiples of 1/18em i.e.
          <code>0</code>,
          <code>0.05555555555555555em</code>,
          <code>0.1111111111111111em</code>,
          <code>0.16666666666666666em</code>,
          <code>0.2222222222222222em</code>,
          <code>0.2777777777777778em</code>,
          <code>0.3333333333333333em</code>,
          <code>0.3888888888888889em</code> respectively.
        </p>
        <p>
          Boolean valued attributes
          <a><code>fence</code></a>,
          <a><code>separator</code></a>,
          <a><code>stretchy</code></a>,
          <a><code>symmetric</code></a>,
          <a><code>largeop</code></a>,
          <a><code>movablelimits</code></a>,
          <a><code>accent</code></a> are
          specified together in the final 'Properties' column by listing the
          attribute name if its value should be set to true by the dictionary.
        </p>
      </section>
      <section>
        <h3>Operator dictionary entries</h3>
        <div data-include="tables/operator-dictionary.html"></div>
      </section>
    </section>
    <section>
      <h2>MathML Combining Character Equivalences</h2>
      <p>
        The following table gives mappings between spacing and non spacing
        characters when used in MathML accent constructs.
      </p>
      <div data-include="tables/combining-operators.html"></div>
    </section>
    <section>
      <h2>Unicode-based Glyph Assemblies</h2>
      <p>
        The following table provide fallback that user agents must use for
        stretching given unicode character when the font does not provide a
        <code>MATH.MathVariants</code> table.
        The algorithms of
        <a href="#size-variants-for-operators-mathvariants"></a>
        works the same except with some adjustments:
      </p>
      <ul>
        <li>
          All the glyph IDs and metrics have to be deduced from unicode
          code points
        </li>
        <li>
          The <code>MathGlyphConstruction.mathGlyphVariantRecord</code> is
          always empty.
        </li>
        <li>
          The
          <code>MathVariants.minConnectorOverlap</code>,
          <code>GlyphPartRecord.startConnectorLength</code> and
          <code>GlyphPartRecord.endConnectorLength</code>
          are treated as 0.
        </li>
      </ul>
      <p>
        The array of
        <code>MathGlyphConstruction.GlyphAssembly.partRecords</code> is built
        from each table row as follows:
      </p>
        <ul>
          <li>A (non-extender) bottom/left character</li>
          <li>Followed by an extender character.</li>
          <li>Optionally followed by this:
            <ul>
              <li>Optionally, an (non-extender) middle character
                and the same extender character previously mentioned.</li>
              <li>A (non-extender) Top/Right character.
            </ul>
          </li>
        </ul>
      <div data-include="tables/unicode-assembly.html"></div>
    </section>
    <section>
      <h3>New <code>text-transform</code> Mappings</h3>
      <section>
        <h4><code>bold-script</code> mappings</h4>
        <div data-include="tables/mathvariants-bold-script.html"></div>
      </section>
      <section>
        <h4><code>bold-italic</code> mappings</h4>
        <div data-include="tables/mathvariants-bold-italic.html"></div>
      </section>
(      <section>
        <h4><code>tailed</code> mappings</h4>
        <div data-include="tables/mathvariants-tailed.html"></div>
      </section>
      <section>
        <h4><code>bold</code> mappings</h4>
        <div data-include="tables/mathvariants-bold.html"></div>
      </section>
      <section>
        <h4><code>fraktur</code> mappings</h4>
        <div data-include="tables/mathvariants-fraktur.html"></div>
      </section>
      <section>
        <h4><code>script</code> mappings</h4>
        <div data-include="tables/mathvariants-script.html"></div>
      </section>
      <section>
        <h4><code>monospace</code> mappings</h4>
        <div data-include="tables/mathvariants-monospace.html"></div>
      </section>
      <section>
        <h4><code>initial</code> mappings</h4>
        <div data-include="tables/mathvariants-initial.html"></div>
      </section>
      <section>
        <h4><code>sans-serif</code> mappings</h4>
        <div data-include="tables/mathvariants-sans-serif.html"></div>
      </section>
      <section>
        <h4><code>double-struck</code> mappings</h4>
        <div data-include="tables/mathvariants-double-struck.html"></div>
      </section>
      <section>
        <h4><code>looped</code> mappings</h4>
        <div data-include="tables/mathvariants-looped.html"></div>
      </section>
      <section>
        <h4><code>stretched</code> mappings</h4>
        <div data-include="tables/mathvariants-stretched.html"></div>
      </section>
      <section>
        <h4><code>italic</code> mappings</h4>
        <div data-include="tables/mathvariants-italic.html"></div>
      </section>
      <section>
        <h4><code>bold-fraktur</code> mappings</h4>
        <div data-include="tables/mathvariants-bold-fraktur.html"></div>
      </section>
      <section>
        <h4><code>sans-serif-bold-italic</code> mappings</h4>
        <div data-include="tables/mathvariants-sans-serif-bold-italic.html"></div>
      </section>
      <section>
        <h4><code>sans-serif-italic</code> mappings</h4>
        <div data-include="tables/mathvariants-sans-serif-italic.html"></div>
      </section>
      <section>
        <h4><code>bold-sans-serif</code> mappings</h4>
        <div data-include="tables/mathvariants-bold-sans-serif.html"></div>
      </section>
    </section>
    <section class="appendix normative">
      <h2>Conformance</h2>
      <section>
        <h3>Document conventions</h3>
        <p>
          Conformance requirements are expressed with a combination of
          descriptive assertions and RFC 2119 terminology. The key words “MUST”,
          “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
          “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
          document are to be interpreted as described in RFC 2119.
          However, for readability, these words do not appear in all uppercase
          letters in this specification.
        </p>
        <p>
          All of the text of this specification is normative except sections
          explicitly marked as non-normative, examples, and notes.
          [[RFC2119]].
        </p>
        <p>
          Examples in this specification are introduced with the words
          “for example” or are set apart from the normative text with
          <code>class="example"</code>, like this:
        </p>
        <div class="example">
          <p>
            This is an example of an informative example.
          </p>
        </div>
        <p>
          Informative notes begin with the word “Note” and are set apart from
          the normative text with <code>class="note"</code>, like this:
        </p>
        <p class="note">
          Note, this is an informative note.
        </p>
        <p>
          Advisements are normative sections styled to evoke special attention
          and are set apart from other normative text with
          <code>&lt;strong class="advisement"&gt;</code>, like this:
          <strong class="advisement">UAs MUST provide an accessible alternative. </strong>
        </p>
      </section>
    </section>
  </body>
</html>
