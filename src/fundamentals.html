<!DOCTYPE html>
<html>
  <head>
    <title>2 MathML Fundamentals</title>
    <meta charset="utf-8"/>
  </head>
  <body>
<section id="fundamentals">
<h1>MathML Fundamentals</h1>
<div></div>

<section id="html5tree">
<h2>MathML Syntax and Grammar</h2>

<section id="othertech">
<h3>DOM, HTML, SVG, CSS and Javascript</h3>

<div id="dom.p1">
  <p>User agents must use a HTML5
    <cite><a href="references.html#html5">auto</a></cite> parser to build a DOM tree
    <cite><a href="references.html#dom1">auto</a></cite> from the source code of
    web pages. In particular, they must follow the rules describing when
    elements must be in the MathML namespace
    <code>http://www.w3.org/1998/Math/MathML</code> and must
    recognize the Named character references from
    <cite><a href="references.html#html5">auto</a></cite>.
    They must also take into
    account the following integration points between SVG, MathML and HTML as
    allowed by <cite><a href="references.html#validator-schemas">auto</a></cite>:</p>
</div>
<div id="dom.p2">
  <ol>
    <li>
      The <code>&lt;math&gt;</code> element can be used at any position
      permitted for phrasing content or inside SVG
      <code>&lt;foreignObject&gt;</code> elements.
    </li>
    <li>
      The <code>&lt;svg&gt;</code> element can be used inside
      <code>&lt;annotation-xml&gt;</code> elements with encoding
      <code>SVG1.1</code> or <code>image/svg+xml</code>.
    </li>
    <li>
      The <code>&lt;html&gt;</code> element and flow content can be used inside
      <code>&lt;annotation-xml&gt;</code> elements with encoding
      <code>application/xhtml+xml</code> or <code>text/html</code>.
    </li>
    <li>
      Any phrasing element can be used inside <code>&lt;mtext&gt;</code>
      elements.
    </li>
  </ol>
</div>
<div id="dom.p3">
  <p>From this DOM tree, user agents must provide a visual representation of the
    document. The DOM tree may be dynamically modified using Javascript
    <cite><a href="references.html#ecma262">auto</a></cite> and the user agents must
    keep the visual representation in synchronization with the DOM tree.</p>
</div>
<div id="dom.p4">
  <p>When evaluating the SVG <code>requiredExtensions</code> attribute
    <cite><a href="references.html#svg">auto</a></cite>, user agents must claim
    support for the extension of name
    <code>http://www.w3.org/1998/Math/MathML</code>.
    An algorithm to decide the visible child of the
    <code>&lt;semantics&gt;</code> element is proposed in section
    <a href="presentation.html#sematicsandpresentation">auto</a>.</p>
</div>

<div id="cssproperties.p1">
  <p>
    User agents must support several CSS modules and use the user agent
    stylesheet described in <a href="#user-agent-stylesheet">Appendix B</a>.
    Details are given in the respective sections.
  </p>
</div>

</section>

<section id="att-syntax">
  <h3>MathML Attribute Values</h3>
  <dl>
    <dt id="unsigned-integer">&lt;non-negative-integer&gt;</dt>
    <dd>A <code>&lt;non-negative-integer&gt;</code> value as defined in
      <cite><a href="references.html#html5">auto</a></cite>
    </dd>
  </dl>
  <dl>
    <dt id="length-percentage">&lt;length-percentage&gt;</dt>
    <dd>A <code>&lt;length-percentage&gt;</code> value as defined in
      <cite><a href="references.html#css-values">auto</a></cite>
    </dd>
  </dl>
  <dl>
    <dt id="color">&lt;color&gt;</dt>
    <dd>A <code>&lt;color&gt;</code> value as defined in
      <cite><a href="references.html#css-color">auto</a></cite>
    </dd>
  </dl>
</section>

<section id="global-attributes">
  <h3>Attributes Shared by all MathML Elements</h3>
  <p id="global-attributes.p1">
    The following attributes are common to and may be specified on all MathML
    elements:
  </p>
  <ul>
    <li><a href="#id-class-style-attributes"><code>id</code></a></li>
    <li><a href="#id-class-style-attributes"><code>class</code></a></li>
    <li><a href="#id-class-style-attributes"><code>style</code></a></li>
    <li><a href="#href-class-style-attributes"><code>href</code></a></li>
    <li><a href="#dir-attribute"><code>dir</code></a></li>
    <li><a href="#mathcolor-and-mathbackground-attributes"><code>mathbackground</code></a></li>
    <li><a href="#mathcolor-and-mathbackground-attributes"><code>mathcolor</code></a></li>
    <li><a href="#mathsize-attribute"><code>mathsize</code></a></li>
    <li><a href="#mathvariant-attribute"><code>mathvariant</code></a></li>
    <li><a href="#displaystyle-script-level-attributes"><code>displaystyle</code></a></li>
    <li><a href="#displaystyle-script-level-attributes"><code>scriptlevel</code></a></li>
  </ul>

  <p id="id-class-style-attributes">
    The <code>id</code>, <code>class</code>,
    <code>style</code> attributes have the syntax and semantic described
    in <cite><a href="references.html#html5">auto</a></cite>. In particular,
    they are used to identify elements in links and scripting, affect
    CSS selectors, affect <span>getElementsByClassName()</span> and enable
    authors to do inline styling.
  </p>

  <div id="href-attribute">
    <p>
      The <code>href</code> has the syntax and semantic described
      in <cite><a href="references.html#html5">auto</a></cite>
      for the <code>&lt;a&gt;</code> element.
      This attribute represents a hyperlink labeled by its contents.
      To fully implement this attribute, additional CSS properties for links
      must be specified in the user agent stylesheet
      as described in <a href="#user-agent-stylesheet">Appendix B</a>.
    </p>
  </div>

  <p id="dir-attribute">
    The <code>dir</code> attribute, if specified and not
    empty, must have value <code>ltr</code> or <code>ltr</code>.
    It is mapped to the CSS property <code>direction</code> defined in
    <cite><a href="references.html#css-writing-mode">auto</a></cite>.
    This attribute is used to set the directionality of math formulas, which is
    often <code>rtl</code> in Arabic speaking world.
  </p>

  <p id="mathcolor-and-mathbackground-attributes">The <code>mathcolor</code> and
    <code>mathbackground</code> attributes, if specified and not empty, must
    have a value that is a <a href="#color">&lt;color&gt;</a>.
    The <code>mathcolor</code> property describes the foreground fill color of
    an MathML text, bars etc and the background color of an element.
    They are mapped to the CSS properties <code>color</code> and
    <code>background-color</code> defined in
    <cite><a href="references.html#css-color">auto</a></cite>
    and <cite><a href="references.html#css-backgrounds">auto</a></cite>.
  </p>

  <p id="mathsize-attribute">The <code>mathsize</code>
    attribute, if specified and not empty, must
    have a value that is a valid
    <a href="#length-percentage">&lt;length-percentage&gt;</a>.
    The <code>mathsize</code> property indicates indicates the desired height
    of glyphs in math formulas but also scale other parts (spacing, shifts,
    line thickness of bars etc) accordingly.
    Is is mapped to the CSS property <code>font-size</code>
    from <a href="references.html#css-font">auto</a>.
  </p>

  <div class="note">
    Many of the above attributes are not useful in CSS-aware
    environments, but are preserved for backward compatibility reasons.
  </div>

  <div id="mathvariant-attribute">
    <p>
      The <code>mathvariant</code> attribute,
      if specified and not empty, must have a value that is one of:
    </p>
    <ul>
      <li><code>normal</code></li>
      <li><code>bold</code></li>
      <li><code>italic</code></li>
      <li><code>bold-italic</code></li>
      <li><code>double-struck</code></li>
      <li><code>bold-fraktur</code></li>
      <li><code>script</code></li>
      <li><code>bold-script</code></li>
      <li><code>fraktur</code></li>
      <li><code>sans-serif</code></li>
      <li><code>bold-sans-serif</code></li>
      <li><code>sans-serif-italic</code></li>
      <li><code>sans-serif-bold-italic</code></li>
      <li><code>monospace</code></li>
      <li><code>initial</code></li>
      <li><code>tailed</code></li>
      <li><code>looped</code></li>
      <li><code>stretched</code></li>
    </ul>
    <p>
      The <code>mathvariant</code> attribute defines logical classes of token
      elements. Each class provides a collection of typographically-related
      symbolic tokens with specific meaning within a given mathematical
      expression.
      For <code>mathvariant</code> values other than <code>normal</code>,
      this is done by using glyphs of
      Unicode's Mathematical Alphanumeric Symbols. 
    </p>
    <p>
      Hence, the <code>mathvariant</code> attribute
      is mapped to new values of the CSS property <code>text-transform</code>
      defined in <a href="references.html#math-variant">auto</a>.
      More precisely, <code>normal</code> is mapped to <code>none</code>
      while all the other values the corresponding CSS value with the extra
      <code>math-</code> prefix.
    </p>
  </div>

  <div class="note">
    For <code>mathvariant</code> values other than <code>normal</code>,
    one can just directly use the corresponding Unicode
    characters. However, they are preserved for backward compatibility reasons.
    The <code>normal</code> value is still important to cancel automatic
    italic of the <a href="presentation.html#tokenmi"><code>&lt;mi&gt;</code></a> element.
  </div>

  <div id="displaystyle-script-level-attributes">
    <p>
      The <code>displaystyle</code> attribute, if specified and not
      empty, must have value <code>true</code> or <code>false</code>.
      It is mapped to the CSS property <code>math-style</code>
      defined in <a href="references.html#math-style-and-script-level">auto</a>.
      More precisely,  <code>true</code> is mapped to <code>display</code> and
      <code>false</code> to  <code>inline</code>.
      This attribute indicate whether formulas should try to minimize
      the logical height (value is <code>false</code>) or not
      (value is <code>true</code>) e.g. by changing the size of content or
      the layout of scripts.
    </p>
    <p>
      The <code>scriptlevel</code> attribute, if specified and not
      empty, must have value
      <code>+&lt;U&gt;</code>, <code>-&lt;U&gt;</code> or <code>&lt;U&gt;</code>
      where <code>&lt;U&gt;</code> is a
      <a href="#non-negative-integer">&lt;non-negative-integer&gt;</a>.
      It is mapped to the <code>math-script-level</code> property
      defined in <a href="references.html#math-style-and-script-level">auto</a>.
      More precisely,
      <code>+&lt;U&gt;</code>, <code>-&lt;U&gt;</code> and
      <code>&lt;U&gt;</code>
      are respectively mapped to
      <code>add(&lt;U&gt;)</code>
      <code>add(&lt;-U&gt;)</code>
      and <code>&lt;U&gt;</code>.
    </p>

    <p>
      <code>displaystyle</code> and <code>scriptlevel</code> values
      are automatically adjusted within MathML elements.
      To fully implement these attributes, additional CSS properties must be
      specified in the user agent stylesheet
      as described in <a href="#user-agent-stylesheet">Appendix B</a>.
    </p>
    
    <div class="note">
      T<sub>E</sub>X's <code>\displaystyle</code>, <code>\textstyle</code>,
      <code>\scriptstyle</code>, and <code>\scriptscriptstyle</code> correspond
      to <code>displaystyle</code> and <code>scriptlevel</code> as
      <code>true</code> and <code>0</code>,
      <code>false</code> and <code>0</code>,
      <code>false</code> and <code>1</code>,
      and <code>false</code> and 2, respectively.
    </div>
  </div>
  
</section>

</section>

<section id="fund.toplevel">
  <h2>The Top-Level <code>&lt;math&gt;</code> Element</h2>
  <p id="fund.toplevel.p1">
    The <code>&lt;math&gt;</code> element accepts the attributes described
    in section <a href="#global-attributes">auto</a> as well as the
    <code>display</code> attribute.
  </p>
  <p id="display-attribute">
    The <code>display</code> attribute, if specified and not
    empty, must have value <code>block</code> or <code>inline</code>.
    To fully implement this attribute, additional CSS properties must be
    specified in the user agent stylesheet
    as described in <a href="#user-agent-stylesheet">Appendix B</a>.
  </p>

  <div class="note">
    T<sub>E</sub>X's display mode <code>$...$</code>
    and inline mode <code>$...$</code> correspond to
    <code>display="block"</code> and <code>display="inline"</code>
    respectively.
  </div>

</section>

<section id="textandmath">
<h2>Text and Math layout</h2>

<section id="openfontformat">
<h3>Open Font Format</h3>

<div id="openfontformat.p1">
<p>Because math fonts generally contain very tall glyphs such as big integrals,
using typographic metrics is important to avoid excessive line spacing of text.
This behavior is specified in math fonts using the USE_TYPO_METRICS flag from
the OS/2 table <cite><a href="references.html#open-font-format">auto</a></cite> and user agents must honor that flag.</p>
</div>
<div id="openfontformat.p2">
<p>Mathematical formulas can be viewed as an extension of standard text layout
and thus user agents must be able to perfom
complex text layout <cite><a href="references.html#ctl">auto</a></cite> using fonts under the Open Font Format
<cite><a href="references.html#open-font-format">auto</a></cite>. In particular, they must implement bidirectional
rendering and shaping of Arabic scripts.</p>
</div>
<div id="openfontformat.p3">
<p>Mathematical formulas may mix standard text with other graphical outlines
(e.g. fraction or top radical bars). For consistency, these outlines should
be rendered the same way as normal text. In particular, user agents must be
able to apply <code>visibility</code> and <code>color</code> CSS properties to them. They may
also support similar CSS properties for text such as <code>text-shadow</code> or
<code>opacity</code>.</p>
</div>
<div id="openfontformat.p4">
<p>Good mathematical rendering requires use of non-Unicode glyphs. Mathematical
fonts may only provide these glyphs when the <code class="MATH">math</code>
script tag is enabled and so user agents must ensure that the text within
MathML token elements is rendered with that script tag. Some characters like
primes already have script size by default and hence would be too small when
used in a script position.
Hence user agents must support glyph selections via the OpenType font feature
<code class="MATH">ssty</code> (Script Style) in order to display such
“prescripted” characters with the appropriate size.
For bidirectional layout, Unicode defines character-level mirroring
to transform a character into its mirrored form,
for example U+0028 LEFT PARENTHESIS into U+0029 RIGHT PARENTHESIS.
User agents must also support the OpenType font feature
<code>rtlm</code> (Right-to-left mirrored forms)
to allow glyph-level mirroring in cases where character-level is not enough
<cite><a href="references.html#open-font-format">auto</a></cite>.
At the time of writing, Unicode does not distinguish between Chancery and
Spencerian style for the Unicode MATHEMATICAL SCRIPT characters. Some
mathematical fonts rely on <code class="MATH">salt</code> or <code>ssXY</code> properties to provide
both styles. User agents may support the CSS <code>font-variant-alternates</code>
property and corresponding OpenType font features to enable page authors
to get access to these styles <cite><a href="references.html#css-font">auto</a></cite> <cite><a href="references.html#open-font-format">auto</a></cite>.</p>
</div>
<div id="openfontformat.p5">
<p>User agents must be able to read information from the
OpenType MATH table <cite><a href="references.html#open-font-format">auto</a></cite>.
In particular they must be able to read the values from the
<code class="MATH">MathConstants</code> subtable.
They must also be able to use the <code class="MATH">MathVariants</code> subtable
to solve the following problem: given a particular default glyph shape and a
certain width or height, find a variant shape glyph (or a construct created by
putting several glyphs together) that has the required measurement.
More information are provided in see section <a href="presentation.html#tokenmo">auto</a>.</p>
</div>
</section>
<section id="latex">
<h3>LaTeX</h3>

<div id="latex.p1">
<p>Mathematical rendering rules in this document are implicitly based on
MathML, OpenType MATH table and the TeXBook
<cite><a href="references.html#mathml3">auto</a></cite> <cite><a href="references.html#open-font-format">auto</a></cite> <cite><a href="references.html#texbook">auto</a></cite>. In this section, we
describe more precisely some rules from the TeXBook.</p>
</div>
<div id="latex.p2">
<p>In addition to concepts similar to MathML’s <code>displaystyle</code> and
<code>scriptlevel</code>, LaTeX has
a “cramped” property, which is involved in the determination of script shifts.
It is initially unset on the <code>math</code> element and in general
all the children inherits the “cramped” property from their parent.
However, it is set to true in the following children:</p>
</div>
<div id="latex.p3">
<ol id="I3">
<li id="I3.i1">
<div id="I3.i1.p1">
<p>The denominator of an <code>mfrac</code> element. See section <a href="presentation.html#mfrac">auto</a>.</p>
</div>
</li>
<li id="I3.i2">
<div id="I3.i2.p1">
<p>The subscripts of the <code>msub</code>, <code>msubsup</code>,
<code>munder</code> and <code>munderover</code> elements.
See section <a href="presentation.html#scriptsandlimits">auto</a>.</p>
</div>
</li>
<li id="I3.i3">
<div id="I3.i3.p1">
<p>The overscript of the
<code>mover</code> and <code>munderover</code> elements when it is an <code>accent</code> per
the MathML specification. See section <a href="presentation.html#scriptsandlimits">auto</a>.</p>
</div>
</li>
<li id="I3.i4">
<div id="I3.i4.p1">
<p>The children of the <code>msqrt</code> and <code>mroot</code> elements.</p>
</div>
</li>
</ol>
</div>
<div id="latex.p4">
<p>To implement math spacing, the TeXBook defines eight basic types
(<code>Ord</code> for ordinary atoms, <code>Op</code> for large operators,
<code>Bin</code> for binary operations, <code>Rel</code> for relations,
<code>Open</code> for opening fences, <code>Close</code> for closing fences,
<code>Punct</code> for punctuations and <code>Inner</code> for a delimited subformula) and
define an inter space for each pair of such types. In the present document,
we only follow the spacing algorithm of MathML 3: by default the inter space
is always zero and the spacing is produced by spacing elements like
<code>mspace</code>, <code>mphantom</code> or <code>mpadded</code> or by the leading and trailing
space around embellished operators.</p>
</div>
</section>

</section>
</section>

  </body>
</html>
