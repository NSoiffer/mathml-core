<!DOCTYPE html>
<html>
<head>
<title>2 MathML Fundamentals</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

</head>
<body>
<section id="fundamentals">
<h1>MathML Fundamentals</h1>
<div></div>

<section id="html5tree">
<h2>HTML5 Tree</h2>

<section id="dom">
<h3>DOM, HTML, SVG and Javascript</h3>

<div id="dom.p1">
<p>User agents must use a HTML5 <cite>[<a href="bib.html#bibx9">auto</a>]</cite> parser to build a DOM tree
<cite>[<a href="bib.html#bibx6">auto</a>]</cite> from the source code of web pages. In particular, they must follow
the rules describing when elements must be in the MathML namespace
<code>http://www.w3.org/1998/Math/MathML</code> and must
recognize the entity definitions from the HTML MathML entity set of
<cite>[<a href="bib.html#bibx18">auto</a>]</cite>. They must also take into account the following integration
points between SVG, MathML and HTML as allowed by <cite>[<a href="bib.html#bibx17">auto</a>]</cite>:</p>
</div>
<div id="dom.p2">
<ol id="I2">
<li id="I2.i1">
<div id="I2.i1.p1">
<p>The <code>&lt;math&gt;</code> element can be used at any position permitted for
phrasing content or inside SVG <code>&lt;foreignObject&gt;</code> elements.</p>
</div>
</li>
<li id="I2.i2">
<div id="I2.i2.p1">
<p>The <code>&lt;svg&gt;</code> element can be used inside <code>&lt;annotation-xml&gt;</code>
elements with encoding <code>SVG1.1</code> or <code>image/svg+xml</code>.</p>
</div>
</li>
<li id="I2.i3">
<div id="I2.i3.p1">
<p>The <code>&lt;html&gt;</code> element and flow content can be used inside
<code>&lt;annotation-xml&gt;</code> elements with encoding <code>application/xhtml+xml</code>
or <code>text/html</code>.</p>
</div>
</li>
<li id="I2.i4">
<div id="I2.i4.p1">
<p>Any phrasing element can be used inside <code>&lt;mtext&gt;</code> elements.</p>
</div>
</li>
</ol>
</div>
<div id="dom.p3">
<p>From this DOM tree, user agents must provide a visual representation of the
document. The DOM tree may be dynamically modified using Javascript
<cite>[<a href="bib.html#bibx7">auto</a>]</cite> and the user agents must keep the visual representation in
synchronization with the DOM tree.</p>
</div>
<div id="dom.p4">
<p>When evaluating the SVG <code>requiredExtensions</code> attribute <cite>[<a href="bib.html#bibx15">auto</a>]</cite>,
user agents must claim support for the extension of name
<code>http://www.w3.org/1998/Math/MathML</code>.
An algorithm to decide the visible child of the <code>&lt;semantics&gt;</code> element is
proposed in section <a href="presentation.html#sematicsandpresentation">auto</a>.</p>
</div>
</section>

<section id="mathmltree">
  <h3>MathML</h3>
  <div id="mathmltree.p1">
    <p>
      All MathML elements accept the <code>id</code>, <code>class</code> and
      <code>style</code> attributes with the semantic described in section 3.2.5
      of <cite>[<a href="bib.html#bibx9">auto</a>]</cite>. In particular,
      they specify a unique identifier for links and scripting, affect CSS
      selectors, affect <code>getElementsByClassName()</code> and enable
      authors to do inline styling.</p>
  </div>
  <div id="mathmltree.p2">
    <p>
      All MathML elements accept the <code>href</code> attribute, with the
      semantic described in section 4.8 of
      <cite>[<a href="bib.html#bibx9">auto</a>]</cite> for the
      <code>a</code> element. The default User Agent stylesheet must contain
      the following CSS selector:
    </p>
<pre>:any-link {
  color: blue;
  text-decoration: none;
}</pre>
  </div>
<div id="mathmltree.p4">
<p>The toplevel <code>math</code> element also accepts the <code>display</code> attribute,
<code>mathcolor</code>, <code>mathbackground</code> attributes as well as other attributes
from the <code>mstyle</code> element. These attributes must be supported and this
may be achieved using specific rules in the user agent stylesheet
as described in section <a href="#cssuseragent">auto</a>.</p>
</div>
<div id="mathmltree.p5">
<p>In general MathML elements or attributes that are not mentioned in this
document may just be ignored. This includes deprecated attributes or
Content Markup described in chapter 4 of the MathML 3 specification
<cite>[<a href="bib.html#bibx11">auto</a>]</cite>.
</p>
</div>
<div id="mathmltree.p6">
<p>User agents must contain an operator dictionary describing the default
properties of operators. For interoperability, it is recommended to use the one
proposed in the non-normative Appendix C of <cite>[<a href="bib.html#bibx11">auto</a>]</cite>.</p>
</div>
</section>
</section>
<section id="textandmath">
<h2>Text and Math layout</h2>

<section id="openfontformat">
<h3>Open Font Format</h3>

<div id="openfontformat.p1">
<p>Because math fonts generally contain very tall glyphs such as big integrals,
using typographic metrics is important to avoid excessive line spacing of text.
This behavior is specified in math fonts using the USE_TYPO_METRICS flag from
the OS/2 table <cite>[<a href="bib.html#bibx13">auto</a>]</cite> and user agents must honor that flag.</p>
</div>
<div id="openfontformat.p2">
<p>Mathematical formulas can be viewed as an extension of standard text layout
and thus user agents must be able to perfom
complex text layout <cite>[<a href="bib.html#bibx4">auto</a>]</cite> using fonts under the Open Font Format
<cite>[<a href="bib.html#bibx13">auto</a>]</cite>. In particular, they must implement bidirectional
rendering and shaping of Arabic scripts.</p>
</div>
<div id="openfontformat.p3">
<p>Mathematical formulas may mix standard text with other graphical outlines
(e.g. fraction or top radical bars). For consistency, these outlines should
be rendered the same way as normal text. In particular, user agents must be
able to apply <code>visibility</code> and <code>color</code> CSS properties to them. They may
also support similar CSS properties for text such as <code>text-shadow</code> or
<code>opacity</code>.</p>
</div>
<div id="openfontformat.p4">
<p>Good mathematical rendering requires use of non-Unicode glyphs. Mathematical
fonts may only provide these glyphs when the <code class="MATH">math</code>
script tag is enabled and so user agents must ensure that the text within
MathML token elements is rendered with that script tag. Some characters like
primes already have script size by default and hence would be too small when
used in a script position.
Hence user agents must support glyph selections via the OpenType font feature
<code class="MATH">ssty</code> (Script Style) in order to display such
“prescripted” characters with the appropriate size.
For bidirectional layout, Unicode defines character-level mirroring
to transform a character into its mirrored form,
for example U+0028 LEFT PARENTHESIS into U+0029 RIGHT PARENTHESIS.
User agents must also support the OpenType font feature
<code>rtlm</code> (Right-to-left mirrored forms)
to allow glyph-level mirroring in cases where character-level is not enough
<cite>[<a href="bib.html#bibx13">auto</a>]</cite>.
At the time of writing, Unicode does not distinguish between Chancery and
Spencerian style for the Unicode MATHEMATICAL SCRIPT characters. Some
mathematical fonts rely on <code class="MATH">salt</code> or <code>ssXY</code> properties to provide
both styles. User agents may support the CSS <code>font-variant-alternates</code>
property and corresponding OpenType font features to enable page authors
to get access to these styles <cite>[<a href="bib.html#bibx2">auto</a>]</cite> <cite>[<a href="bib.html#bibx13">auto</a>]</cite>.</p>
</div>
<div id="openfontformat.p5">
<p>User agents must be able to read information from the
OpenType MATH table <cite>[<a href="bib.html#bibx13">auto</a>]</cite>.
In particular they must be able to read the values from the
<code class="MATH">MathConstants</code> subtable.
They must also be able to use the <code class="MATH">MathVariants</code> subtable
to solve the following problem: given a particular default glyph shape and a
certain width or height, find a variant shape glyph (or a construct created by
putting several glyphs together) that has the required measurement.
More information are provided in see section <a href="presentation.html#tokenmo">auto</a>.</p>
</div>
</section>
<section id="latex">
<h3>LaTeX</h3>

<div id="latex.p1">
<p>Mathematical rendering rules in this document are implicitly based on
MathML, OpenType MATH table and the TeXBook
<cite>[<a href="bib.html#bibx11">auto</a>]</cite> <cite>[<a href="bib.html#bibx13">auto</a>]</cite> <cite>[<a href="bib.html#bibx16">auto</a>]</cite>. In this section, we
describe more precisely some rules from the TeXBook.</p>
</div>
<div id="latex.p2">
<p>In addition to concepts similar to MathML’s <code>displaystyle</code> and
<code>scriptlevel</code>, LaTeX has
a “cramped” property, which is involved in the determination of script shifts.
It is initially unset on the <code>math</code> element and in general
all the children inherits the “cramped” property from their parent.
However, it is set to true in the following children:</p>
</div>
<div id="latex.p3">
<ol id="I3">
<li id="I3.i1">
<div id="I3.i1.p1">
<p>The denominator of an <code>mfrac</code> element. See section <a href="presentation.html#mfrac">auto</a>.</p>
</div>
</li>
<li id="I3.i2">
<div id="I3.i2.p1">
<p>The subscripts of the <code>msub</code>, <code>msubsup</code>,
<code>munder</code> and <code>munderover</code> elements.
See section <a href="presentation.html#scriptsandlimits">auto</a>.</p>
</div>
</li>
<li id="I3.i3">
<div id="I3.i3.p1">
<p>The overscript of the
<code>mover</code> and <code>munderover</code> elements when it is an <code>accent</code> per
the MathML specification. See section <a href="presentation.html#scriptsandlimits">auto</a>.</p>
</div>
</li>
<li id="I3.i4">
<div id="I3.i4.p1">
<p>The children of the <code>msqrt</code> and <code>mroot</code> elements.</p>
</div>
</li>
</ol>
</div>
<div id="latex.p4">
<p>To implement math spacing, the TeXBook defines eight basic types
(<code>Ord</code> for ordinary atoms, <code>Op</code> for large operators,
<code>Bin</code> for binary operations, <code>Rel</code> for relations,
<code>Open</code> for opening fences, <code>Close</code> for closing fences,
<code>Punct</code> for punctuations and <code>Inner</code> for a delimited subformula) and
define an inter space for each pair of such types. In the present document,
we only follow the spacing algorithm of MathML 3: by default the inter space
is always zero and the spacing is produced by spacing elements like
<code>mspace</code>, <code>mphantom</code> or <code>mpadded</code> or by the leading and trailing
space around embellished operators.</p>
</div>
</section>
</section>
<section id="cssstyling">
<h2>CSS Styling</h2>

<section id="cssproperties">
  <h3>Properties</h3>
  <div id="cssproperties.p1">
    <p>
      User agents must support the CSS language
      <cite>[<a href="bib.html#bibx1">auto</a>]</cite> and must take special
      styling into account when building the visual representation of the
      document.
    </p>
  </div>
  <div id="cssproperties.p2">
    <p>User agents must support at least the following properties:</p>
    <ol>
      <li><code>display</code>: at least <code>inline</code>,
        <code>block</code>, <code>inline-table</code>,
        <code>table-row</code>, <code>table-cell</code>, <code>none</code> and
        <code>contents</code>.
        It is used for the <code>math</code> and tabular elements.
        Appropriate values must be specified in the user agent stylesheet
        as described in section <a href="#cssuseragent">auto</a>.
        For all MathML elements, <code>display: contents</code> computes to
        <code>display: none</code>
        <cite>[<a href="bib.html#bib-css-display">auto</a>]</cite>.
      </li>
      <li><code>direction</code>. The <code>dir</code> attribute on any
        MathML element must be mapped to that property.</li>
      <li>The <code>font</code> property and its shorthands. The
        <code>mathsize</code> attribute on any MathML element must mapped to
        that property.</li>
      <li><code>background</code> and <code>color</code>. The
        <code>mathbackground</code> and <code>mathcolor</code> attributes on
        any MathML elements must be mapped to these properties.</li>
      <li><code>visibility</code>. It is is used for the <code>mphantom</code>
        element and must be specified in the user agent stylesheet as described
        in section <a href="#cssuseragent">auto</a>.</li>
      <li><code>text-transform</code>. It is used to implement the
        <code>mathvariant</code> attribute on any MathML element.
        Values <code>normal</code>
        <code>bold</code>,
        <code>italic</code>,
        <code>bold-italic</code>,
        <code>double-struck</code>,
        <code>bold-fraktur</code>,
        <code>script</code>,
        <code>bold-script</code>,
        <code>fraktur</code>,
        <code>sans-serif</code>,
        <code>bold-sans-serif</code>,
        <code>sans-serif-italic</code>,
        <code>sans-serif-bold-italic</code>,
        <code>monospace</code>,
        <code>initial</code>,
        <code>tailed</code>,
        <code>looped</code>,
        <code>stretched</code> are respectively mapped to
        <code>text-transform: none</code>,
        <code>text-transform: math-bold</code>
        <code>text-transform: math-italic</code>
        <code>text-transform: math-bold-italic</code>
        <code>text-transform: math-double-struck</code>
        <code>text-transform: math-bold-fraktur</code>
        <code>text-transform: math-script</code>
        <code>text-transform: math-bold-script</code>
        <code>text-transform: math-fraktur</code>
        <code>text-transform: math-sans-serif</code>
        <code>text-transform: math-bold-sans-serif</code>
        <code>text-transform: math-sans-serif-italic</code>
        <code>text-transform: math-sans-serif-bold-italic</code>
        <code>text-transform: math-monospace</code>
        <code>text-transform: math-initial</code>
        <code>text-transform: math-tailed</code>
        <code>text-transform: math-looped</code>
        <code>text-transform: math-stretched</code>.
        Additional value for <code>mi</code> in the user agent stylesheet
        is described in section <a href="#cssuseragent">auto</a>.
      </li>
      <li><code>math-style</code>.
        It is used for the <code>displaystyle</code> attribute on any
        MathML element.
        Appropriate values must be specified in the user agent stylesheet
        as described in section <a href="#cssuseragent">auto</a>.
      </li>
      <li><code>math-script-level</code>.
        It is used for the <code>scriptlevel</code> attribute on any
        MathML element. For any unsigned integer U,
        <code>+U</code>, <code>-U</code> and <code>U</code>
        is respectively mapped to <code>math-script-level: add(U)</code>
         <code>math-script-level: add(-U)</code>
        and <code>math-script-level: U</code>.
        Additional values must be specified in the user agent stylesheet
        as described in section <a href="#cssuseragent">auto</a>.
      </li>
    </ol>
  </div>
</section>
<section id="cssuseragent">
<h3>User Agent Stylesheet for MathML</h3>

<div id="cssuseragent.p1">
<p>Because mathematical formulas are generally written with special fonts, the
default user agent stylesheet must reset the CSS <code>font-family</code> on the
<code>math</code> element to <code>serif</code>. User agents should then use their own
mechanism to try and interpret this <code>serif</code> value on the <code>math</code> element
as a font with an OpenType MATH table.</p>
</div>
<div id="cssuseragent.p2">
<p>Below is an example on a stylesheet to style MathML elements on which the
User Agents may rely. Unfortunately, some rendering engines do not allow
universal selectors in their user agent stylesheets and so rules must be
expanded to list all possible MathML elements described in the present
document. For example <code>mfrac &gt; *</code> can be converted into
<code>mfrac &gt; mi, mfrac &gt; mn, mfrac &gt; mo, mfrac &gt; mtext, mfrac &gt; mspace,
mfrac &gt; ms, mfrac &gt; mrow, mfrac &gt; mfrac, mfrac &gt; msqrt, mfrac &gt; mroot,
mfrac &gt; mstyle, mfrac &gt; merror, mfrac &gt; mpadded, mfrac &gt; mphantom,
mfrac &gt; menclose, mfrac &gt; msub, mfrac &gt; msubsup, mfrac &gt; munder, mfrac &gt; mover,
mfrac &gt; munderover, mfrac &gt; mmultiscripts, mfrac &gt; mtable, mfrac &gt; maction</code>.</p>
</div>
<div id="cssuseragent.p3">
<div>
  <pre>@namespace url(http://www.w3.org/1998/Math/MathML);
/* The &lt;math&gt; element */
math {
  direction: ltr;
  display: inline;
  font-size: inherit;
  font-style: normal;
  font-family: serif;
  mathml-math-style: inline;
}
math[display="block"] {
  display: block;
  text-align: center;
  mathml-math-style: display;
}
math[display="inline"] {
  display: inline;
  mathml-math-style: inline;
}
math[displaystyle="false"] {
  mathml-math-style: inline;
}
math[displaystyle="true"] {
  mathml-math-style: display;
}
/* Links */
:any-link {
    color: blue;
    text-decoration: none;
}
/* Tabular elements */
mtable {
  display: inline-table;
  mathml-math-style: inline;
}
mtable[displaystyle="true"] {
  mathml-math-style: display;
}
mtable[frame="none"] {
  border: none;
}
mtable[frame="solid"] {
  border: solid thin;
}
mtable[frame="dashed"] {
  border: dashed thin;
}
mtr, mlabeledtr {
  display: table-row;
  vertical-align: baseline;
}
mlabeledtr > mtd:first-child {
  display: none;
}
mtd {
  display: table-cell;
  vertical-align: inherit;
  text-align: center;
  padding: 0.5ex 0.4em;
}
/* The &lt;ms&gt; element */
ms {
  display: inline;
}
ms:before, ms:after {
  content: "\0022"
}
ms[lquote]:before {
  content: attr(lquote)
}
ms[rquote]:after {
  content: attr(rquote)
}
/*  The &lt;merror&gt; element */
merror {
 outline: solid thin red;
 background-color: lightYellow;
}
/* The &lt;mphantom&gt; element */
mphantom {
  visibility: hidden;
}
/* Scriptlevel and displaystyle for other elements */
mstyle[displaystyle="false"] {
  mathml-math-style: inline;
}
mstyle[displaystyle="true"] {
  mathml-math-style: display;
}
mfrac > * {
  mathml-script-level: auto;
  mathml-math-style: inline;
}
mroot > :not(:first-child) {
  mathml-script-level: increment-by 2;
  mathml-math-style: inline;
}
msub > :not(:first-child),
msup > :not(:first-child),
msubsup > :not(:first-child),
mmultiscripts > :not(:first-child) {
  mathml-script-level: increment-by 1;
  mathml-math-style: inline;
}
munder > :not(:first-child),
mover > :not(:first-child),
munderover > :not(:first-child) {
  mathml-math-style: inline;
}</pre>
</div>
</div>
</section>
</section>

<section id="att-syntax">
 <h1>MathML Core Attribute Syntax</h1>
 <p>Several MathML elements have attributes sharing common syntax for constructs such as <a href="#length">auto</a> or
 <a href="#length">color</a>. the syntax for these attributes is defined below.</p>

 <section id="length">
  <h2>Length</h2>
  <p>MathML Core attributes of type <i>length</i> must have value
  consisting of an optional U+002D HYPHEN-MINUS (-) followed by a
  string of characters representing a length or percentage as specifed
  by
  <a
      href="https://www.w3.org/TR/html5/infrastructure.html#percentages-and-dimensions">HTML5
  percentages and lengths</a>.</p>
  <aside data-gh="63"/>
 </section>
 <section id="color">
  <h2>Color</h2>
  <p>MathML Core attributes of type <i>color</i> must have value
  consisting of a string of characters representing a color as specified
  by
  <a
      href="https://www.w3.org/TR/html5/infrastructure.html#colors">HTML5
  color</a>.</p>
  
   <aside data-gh="62"/>
 </section>
</section>

</section>
</body>
</html>
